import{jsx as t,jsxs as S,Fragment as K}from"react/jsx-runtime";import{u as k,a as L,b as N,d as U,$ as _,aj as $,C as q,B as H,p as l,bq as z,x as G,D as J,P as f,br as w,bs as Q,bt as W,o as X}from"./main-C047jAp3.js";import{useState as T}from"react";import{c as Y,C as v,A as Z}from"./ClientScopeTypes-Cr5mTApE.js";import{u as ee}from"./ConfirmDialog-d09hGFUk.js";import{R as te}from"./AddRoleMappingModal-BqwO7G2x.js";import{R as ae,u as oe}from"./RoutableTabs-BpMBzAU0.js";import{V as ie}from"./ViewHeader-Y2Z8ln-o.js";import{u as se}from"./useParams-6mfeCu18.js";import{M as ne}from"./MapperList-Br017ple.js";import{S as re}from"./ScopeForm-Bd97A7DI.js";import{a as g,b as h}from"./Tabs-Dt-AxIu8.js";import"react-dom";import"./translationFormatter-CkqjPJdy.js";import"./useLocaleSort-O4LGWO8i.js";import"./filter-icon-BeqpAxqe.js";import"./PageHandler-BsZt2gxJ.js";import"./DynamicComponents-CCNvrlYx.js";import"./ClientSelect-mboGti-R.js";import"./FileUpload-2t3HfN2b.js";import"./CodeEditor--AHMF_Ho.js";import"./copy-icon-D1BxihC2.js";import"./GroupPickerDialog-CRtxj-P-.js";import"./DataListItemRow-BUcm7LGX.js";import"./KeySelect-DvFB2tXI.js";import"./useToggle-K3Kx99tM.js";import"./MultiLineInput-lQlb7SN3.js";import"./constants-BclHbWtx.js";import"./utils-C-TUnOch.js";import"./SwitchControl-87mhceN2.js";import"./FormAccess-CEFqBG2E.js";function Ue(){const{adminClient:n}=k(),{t:o}=L(),C=N(),{realm:d}=U(),{id:r}=se(),{addAlert:c,addError:p}=_(),{enabled:D}=$(),[i,M]=T(),[y,R]=T(0),b=()=>R(y+1);q(async()=>{const e=await n.clientScopes.findOne({id:r});if(!e)throw new Error(o("notFound"));return{...e,type:await A(e)}},e=>{M(e)},[y,r]);async function A(e){return(await n.clientScopes.listDefaultClientScopes()).find(u=>u.name===e.name)?v.default:(await n.clientScopes.listDefaultOptionalClientScopes()).find(u=>u.name===e.name)?v.optional:Z.none}const m=e=>oe(W({realm:d,id:r,tab:e})),x=m("settings"),E=m("mappers"),I=m("scope"),P=async e=>{const a=X({...e,name:e.name?.trim().replace(/ /g,"_")});try{await n.clientScopes.update({id:r},a),await Y(n,{...a,id:r},a.type),c(o("updateSuccessClientScope"),l.success)}catch(s){p("updateErrorClientScope",s)}},[V,B]=ee({titleKey:o("deleteClientScope",{count:1,name:i?.name}),messageKey:"deleteConfirmClientScopes",continueButtonLabel:"delete",continueButtonVariant:H.danger,onConfirm:async()=>{try{await n.clientScopes.del({id:r}),c(o("deletedSuccessClientScope"),l.success),C(z({realm:d}))}catch(e){p("deleteErrorClientScope",e)}}}),O=async e=>{try{const a=e.filter(s=>s.client===void 0).map(s=>s.role).flat();await n.clientScopes.addRealmScopeMappings({id:r},a),await Promise.all(e.filter(s=>s.client!==void 0).map(s=>n.clientScopes.addClientScopeMappings({id:r,client:s.client.id},[s.role]))),c(o("roleMappingUpdatedSuccess"),l.success)}catch(a){p("roleMappingUpdatedError",a)}},j=async e=>{if(Array.isArray(e))try{await n.clientScopes.addMultipleProtocolMappers({id:i.id},e),b(),c(o("mappingCreatedSuccess"),l.success)}catch(a){p("mappingCreatedError",a)}else{const a=e;C(w({realm:d,id:i.id,mapperId:a.id}))}},F=async e=>{try{await n.clientScopes.delProtocolMapper({id:i.id,mapperId:e.id}),c(o("mappingDeletedSuccess"),l.success),b()}catch(a){p("mappingDeletedError",a)}return!0};return i?S(K,{children:[t(B,{}),t(ie,{titleKey:i.name,dropdownItems:[t(J,{onClick:V,children:o("delete")},"delete")],badges:[{text:i.protocol}],divider:!1}),t(f,{variant:"light",className:"pf-v5-u-p-0",children:S(ae,{isBox:!0,children:[t(g,{id:"settings","data-testid":"settings",title:t(h,{children:o("settings")}),...x,children:t(f,{variant:"light",children:t(re,{save:P,clientScope:i})})}),t(g,{id:"mappers","data-testid":"mappers",title:t(h,{children:o("mappers")}),...E,children:t(ne,{model:i,onAdd:j,onDelete:F,detailLink:e=>w({realm:d,id:i.id,mapperId:e})})}),S(g,{id:"scope","data-testid":"scopeTab",title:t(h,{children:o("scope")}),...I,children:[D&&t(f,{children:t(Q,{variant:"info",isInline:!0,title:o("clientScopesRolesScope"),component:"h2"})}),t(te,{id:i.id,name:i.name,type:"clientScopes",save:O})]})]})})]}):t(G,{})}export{Ue as default};
//# sourceMappingURL=EditClientScope-BM-n7Ox3.js.map
