import{jsxs as y,jsx as e,Fragment as A}from"react/jsx-runtime";import{at as Ke,bH as U,cX as ge,aq as ct,cY as dt,cZ as ut,c_ as pt,c$ as ht,d0 as mt,a0 as ft,ar as Ce,cd as gt,ce as Ct,d1 as yt,d2 as St,d3 as vt,u as te,a as $,Y as K,d4 as Tt,C as ne,J as L,K as F,N as V,af as It,ag as re,d5 as bt,d6 as xt,U as je,V as Be,d7 as Ot,f as w,d8 as kt,ah as Pt,a4 as ee,ai as ie,R as ce,d as $t,b as We,B as se,cl as Rt,c6 as Ye,c7 as Me,L as Je,ca as Qe,cp as Dt,M as Xe,l as Ze,bl as ye,bm as Se,S as Mt,bI as Ae,D as xe,k as At,c0 as pe,c1 as he,c2 as J,c3 as G,c4 as me,c5 as z,cW as ke,a3 as Pe,Q as de,bn as Et,X as _t,av as wt,aw as Ee,Z as et,_ as oe,a2 as Vt,j as Nt,$ as Ht,x as Lt,P as Ft,m as qt,A as Ut,cE as _e,p as we,E as Gt,G as Ve,H as zt}from"./main-C047jAp3.js";import*as O from"react";import{useState as k,useRef as Kt,useCallback as jt,useMemo as tt}from"react";import{u as nt}from"./ConfirmDialog-d09hGFUk.js";import{F as Bt}from"./FormAccess-CEFqBG2E.js";import{V as Wt}from"./ViewHeader-Y2Z8ln-o.js";import{u as it}from"./useParams-6mfeCu18.js";import{u as ue}from"./useToggle-K3Kx99tM.js";import{u as st,m as ot}from"./useLocaleSort-O4LGWO8i.js";import{C as Yt}from"./ClientSelect-mboGti-R.js";import{h as Jt}from"./ClientScopeTypes-Cr5mTApE.js";import{g as Qt}from"./utils-C-TUnOch.js";import{F as Ne}from"./filter-icon-BeqpAxqe.js";import{G as Xt}from"./GroupPickerDialog-CRtxj-P-.js";import{C as Zt,L as en}from"./CodeEditor--AHMF_Ho.js";import{D as tn}from"./SwitchControl-87mhceN2.js";import{A as nn,S as sn}from"./AddRoleMappingModal-BqwO7G2x.js";import{d as ve,D as on}from"./DatePicker-BkDn_m8-.js";const B=" AM",W=" PM",an=(t,s,a,u,d,c)=>{const l=[],p=new Date(new Date().setHours(0,0,0,0)),f=p.getDay();for(;p.getDay()===f;){let m=p.getHours(),n=B;s&&(m===0?m=12:m>=12&&(n=W),m>12&&(m%=12)),m=s?m.toString():m.toString().padStart(2,"0");const i=p.getMinutes().toString().padStart(2,"0"),r=`${m}${a}${i}${s?n:""}`;lt(u,d,r,a,c)&&l.push(r),p.setMinutes(p.getMinutes()+t)}return l},j=(t,s,a,u,d)=>{const c=new Date(t);if(!isNaN(c.getDate())&&(t instanceof Date||t.includes("T"))){const l=u?`${c.getHours()>12?c.getHours()-12:c.getHours()}`:`${c.getHours()}`.padStart(2,"0"),p=`${c.getMinutes()}`.padStart(2,"0"),f=d?`${c.getSeconds()}`.padStart(2,"0"):"",m=f?`${a}${f}`:"";let n="";return u&&c.getHours()>11?n=W:u&&(n=B),`${l}${a}${p}${m}${n}`}else if(typeof t=="string"&&(t=t.trim(),t!==""&&at(t,s,a,u))){const[,l,p,f,m=""]=s.exec(t),n=d?`${a}${f??"00"}`:"";let i="";if(u){const r=m.toUpperCase();r===B.toUpperCase().trim()?i=B:r===W.toUpperCase().trim()?i=W:i=new Date().getHours()>11?W:B}return`${l}${a}${p}${n}${i}`}return t.toString()},at=(t,s,a,u)=>{const d=new Date(t);if(!isNaN(d.getDate())&&t.includes("T"))return!0;const c=parseInt(t.split(a)[0]),l=c>=(u?1:0)&&c<=(u?12:23);return t===""||s.test(t)&&l},He=(t,s)=>{const a=t.match(s);return a&&a.length?/pm/i.test(a[4])?parseInt(a[1])===12?parseInt(a[1]):parseInt(a[1])+12:/am/i.test(a[4])&&parseInt(a[1])===12?0:parseInt(a[1]):null},Le=(t,s)=>{const a=t.match(s);return a&&a.length?parseInt(a[2]):null},Fe=(t,s)=>{var a;const u=(a=t.match(s))===null||a===void 0?void 0:a[3];return u?parseInt(u):null},lt=(t,s,a,u,d)=>{if(a.trim()==="")return!0;const c=Te(t,u,d),l=Te(a,u,d),p=Te(s,u,d);return c<=l&&l<=p},Te=(t,s,a)=>{const d=new RegExp(`^\\s*(\\d\\d?)${s}([0-5]\\d)${s}?([0-5]\\d)?\\s*([AaPp][Mm])?\\s*$`).exec(t);if(!d||!d.length)return;let c=d[1].padStart(2,"0");const l=d[2];let p=d[3]?`${s}${d[3]}`:"";!p&&a&&(p=`${s}00`);const f=d[4]||"";return f.toUpperCase()==="PM"&&c!=="12"?c=`${parseInt(c)+12}`:f.toUpperCase()==="AM"&&c==="12"&&(c="00"),`${c}${s}${l}${p}`},ln={name:"OutlinedClockIcon",height:512,width:512,svgPath:"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z",yOffset:0,xOffset:0},rn=Ke(ln),cn={name:"--pf-v5-c-date-picker__input--c-form-control--Width",value:"calc(10 * 1ch + calc(2rem + 0.5rem))",var:"var(--pf-v5-c-date-picker__input--c-form-control--Width)"};class $e extends O.Component{constructor(s){super(s),this.baseComponentRef=O.createRef(),this.toggleRef=O.createRef(),this.inputRef=O.createRef(),this.menuRef=O.createRef(),this.onDocClick=n=>{var i,r,o,g;const C=(r=(i=this.toggleRef)===null||i===void 0?void 0:i.current)===null||r===void 0?void 0:r.contains(n.target),v=(g=(o=this.menuRef)===null||o===void 0?void 0:o.current)===null||g===void 0?void 0:g.contains(n.target);this.state.isTimeOptionsOpen&&!(C||v)&&this.onToggle(!1)},this.handleGlobalKeys=n=>{var i,r,o,g;const{isTimeOptionsOpen:C,focusedIndex:v,scrollIndex:R}=this.state;!((r=(i=this.inputRef)===null||i===void 0?void 0:i.current)===null||r===void 0)&&r.contains(n.target)?!C&&n.key!==U.Tab&&n.key!==U.Escape?this.onToggle(!0):C&&(n.key===U.Escape||n.key===U.Tab?this.onToggle(!1):n.key===U.Enter?v!==null?(this.focusSelection(v),n.stopPropagation()):this.onToggle(!1):(n.key===U.ArrowDown||n.key===U.ArrowUp)&&(this.focusSelection(R),this.updateFocusedIndex(0),n.preventDefault())):!((g=(o=this.menuRef)===null||o===void 0?void 0:o.current)===null||g===void 0)&&g.contains(n.target)&&(n.key===U.ArrowDown?(this.updateFocusedIndex(1),n.preventDefault()):n.key===U.ArrowUp?(this.updateFocusedIndex(-1),n.preventDefault()):(n.key===U.Escape||n.key===U.Tab)&&(this.inputRef.current.focus(),this.onToggle(!1)))},this.updateFocusedIndex=n=>{this.setState(i=>{const r=this.getOptions().length-1;let o=i.focusedIndex!==null?i.focusedIndex+n:i.scrollIndex+n;return o<0?o=r:o>r&&(o=0),this.scrollToIndex(o),{focusedIndex:o}})},this.getIndexToScroll=n=>this.props.menuAppendTo==="inline"?n>0?n-1:0:n,this.scrollToIndex=n=>{this.getOptions()[n].closest(`.${ge.menuContent}`).scrollTop=this.getOptions()[this.getIndexToScroll(n)].offsetTop},this.focusSelection=n=>{var i;const r=n!==-1?n:0;!((i=this.menuRef)===null||i===void 0)&&i.current&&this.getOptions()[r].querySelector(`.${ge.menuItem}`).focus()},this.scrollToSelection=n=>{const{delimiter:i,is24Hour:r}=this.props;let o=n.split(this.props.delimiter),g=null;if(o.length<2?(n=`${n}${i}00`,o=n.split(i)):o.length>2&&(n=j(n,this.state.timeRegex,i,!r,!1),o=n.split(i)),!r&&o.length>1&&o[1].length<2){const v=o[1].length===0?"00":o[1]+"0";n=`${o[0]}${i}${v}${new Date().getHours()>11?W:B}`}else!r&&o.length>1&&o[1].length===2&&!n.toUpperCase().includes(B.toUpperCase().trim())&&!n.toUpperCase().includes(W.toUpperCase().trim())&&(n=`${n}${new Date().getHours()>11?W:B}`);let C=this.getOptions().findIndex(v=>v.textContent===n);if(C!==-1)this.scrollToIndex(C),g=C;else if(o.length===2){let v="";r||(o[1].toUpperCase().includes("P")?v=W:o[1].toUpperCase().includes("A")&&(v=B)),n=`${o[0]}${i}00${v}`,C=this.getOptions().findIndex(R=>R.textContent===n),C!==-1&&this.scrollToIndex(C)}this.setState({focusedIndex:g,scrollIndex:C})},this.getRegExp=(n=!0)=>{const{is24Hour:i,delimiter:r}=this.props;let o=`\\s*(\\d\\d?)${r}([0-5]\\d)`;return n&&(o+=`${r}?([0-5]\\d)?`),new RegExp(`^${o}${i?"":"\\s*([AaPp][Mm])?"}\\s*$`)},this.getOptions=()=>{var n;return!((n=this.menuRef)===null||n===void 0)&&n.current?Array.from(this.menuRef.current.querySelectorAll(`.${ge.menuListItem}`)):[]},this.isValidFormat=n=>{if(this.props.validateTime)return this.props.validateTime(n);const{delimiter:i,is24Hour:r,includeSeconds:o}=this.props;return at(n,this.getRegExp(o),i,!r)},this.isValidTime=n=>{const{delimiter:i,includeSeconds:r}=this.props,{minTimeState:o,maxTimeState:g}=this.state;return lt(o,g,n,i,r)},this.isValid=n=>this.isValidFormat(n)&&this.isValidTime(n),this.onToggle=n=>{this.setState(i=>{const{timeRegex:r,isInvalid:o,timeState:g}=i,{delimiter:C,is24Hour:v,includeSeconds:R,onChange:M}=this.props,b=j(g,r,C,!v,R);return M&&!n&&b!==g&&M(null,b,He(b,r),Le(b,r),Fe(b,r),this.isValid(b)),{isTimeOptionsOpen:n,timeState:b,isInvalid:n?o:!this.isValid(b)}}),this.props.setIsOpen(n),n||this.inputRef.current.focus()},this.onSelect=n=>{const{timeRegex:i,timeState:r}=this.state,{delimiter:o,is24Hour:g,includeSeconds:C,setIsOpen:v}=this.props,R=j(n.target.textContent,i,o,!g,C);R!==r&&this.onInputChange(n,R),this.inputRef.current.focus(),this.setState({isTimeOptionsOpen:!1,isInvalid:!1}),v(!1)},this.onInputClick=n=>{this.state.isTimeOptionsOpen||this.onToggle(!0),n.stopPropagation()},this.onInputChange=(n,i)=>{const{onChange:r}=this.props,{timeRegex:o}=this.state;r&&r(n,i,He(i,o),Le(i,o),Fe(i,o),this.isValid(i)),this.scrollToSelection(i),this.setState({timeState:i})};const{is24Hour:a,delimiter:u,time:d,includeSeconds:c,isOpen:l}=this.props;let{minTime:p,maxTime:f}=this.props;if(p===""){const n=c?`${u}00`:"";p=a?`00${u}00${n}`:`12${u}00${n} AM`}if(f===""){const n=c?`${u}59`:"";f=a?`23${u}59${n}`:`11${u}59${n} PM`}const m=this.getRegExp();this.state={isInvalid:!1,isTimeOptionsOpen:l,timeState:j(d,m,u,!a,c),focusedIndex:null,scrollIndex:0,timeRegex:m,minTimeState:j(p,m,u,!a,c),maxTimeState:j(f,m,u,!a,c)}}componentDidMount(){document.addEventListener("mousedown",this.onDocClick),document.addEventListener("touchstart",this.onDocClick),document.addEventListener("keydown",this.handleGlobalKeys),this.setState({isInvalid:!this.isValid(this.state.timeState)})}componentWillUnmount(){document.removeEventListener("mousedown",this.onDocClick),document.removeEventListener("touchstart",this.onDocClick),document.removeEventListener("keydown",this.handleGlobalKeys)}componentDidUpdate(s,a){const{timeState:u,isTimeOptionsOpen:d,isInvalid:c,timeRegex:l}=this.state,{time:p,is24Hour:f,delimiter:m,includeSeconds:n,isOpen:i,minTime:r,maxTime:o}=this.props;if(s.isOpen!==i&&this.onToggle(i),d&&!a.isTimeOptionsOpen&&u&&!c&&this.scrollToSelection(u),m!==s.delimiter&&this.setState({timeRegex:this.getRegExp()}),p!==""&&p!==s.time){const g=j(p,l,m,!f,n);this.setState({timeState:g,isInvalid:!this.isValid(g)})}r!==""&&r!==s.minTime&&this.setState({minTimeState:j(r,l,m,!f,n)}),o!==""&&o!==s.maxTime&&this.setState({maxTimeState:j(o,l,m,!f,n)})}render(){const s=this.props,{"aria-label":a,isDisabled:u,className:d,placeholder:c,id:l,menuAppendTo:p,is24Hour:f,invalidFormatErrorMessage:m,invalidMinMaxErrorMessage:n,stepMinutes:i,width:r,delimiter:o,inputProps:g,onChange:C,setIsOpen:v,isOpen:R,time:M,validateTime:b,minTime:T,maxTime:I,includeSeconds:Q,zIndex:X}=s,h=ct(s,["aria-label","isDisabled","className","placeholder","id","menuAppendTo","is24Hour","invalidFormatErrorMessage","invalidMinMaxErrorMessage","stepMinutes","width","delimiter","inputProps","onChange","setIsOpen","isOpen","time","validateTime","minTime","maxTime","includeSeconds","zIndex"]),{timeState:x,isTimeOptionsOpen:N,isInvalid:D,minTimeState:H,maxTimeState:q}=this.state,ae={[cn.name]:r},fe=an(i,!f,o,H,q,Q),S=this.isValidFormat(x),E=l||dt("time-picker"),P=()=>this.baseComponentRef&&this.baseComponentRef.current?this.baseComponentRef.current.parentElement:null,Y=O.createElement(ut,{ref:this.menuRef,isScrollable:!0},O.createElement(pt,{maxMenuHeight:"200px"},O.createElement(ht,{"aria-label":a},fe.map((De,rt)=>O.createElement(mt,{onClick:this.onSelect,key:De,id:`${E}-option-${rt}`},De))))),_=O.createElement(ft,Object.assign({"aria-haspopup":"menu",id:`${E}-input`,"aria-label":a,validated:D?"error":"default",placeholder:c,value:x||"",type:"text",customIcon:O.createElement(rn,null),onClick:this.onInputClick,onChange:this.onInputChange,autoComplete:"off",isDisabled:u,isExpanded:N,ref:this.inputRef},g));let Z;switch(p){case"inline":Z=()=>this.toggleRef.current;break;case"parent":Z=P;break;default:Z=p}return O.createElement("div",{ref:this.baseComponentRef,className:Ce(ve.datePicker,d)},O.createElement("div",Object.assign({className:Ce(ve.datePickerInput),style:ae},h),O.createElement(gt,null,O.createElement(Ct,null,O.createElement("div",{id:E},O.createElement("div",{ref:this.toggleRef,style:{paddingLeft:"0"}},O.createElement(yt,{appendTo:Z,trigger:_,triggerRef:this.toggleRef,popper:Y,popperRef:this.menuRef,isVisible:N,zIndex:X}))))),D&&O.createElement("div",{className:Ce(ve.datePickerHelperText)},O.createElement(St,null,O.createElement(vt,{variant:"error"},S?n:m)))))}}$e.displayName="TimePicker";$e.defaultProps={className:"",isDisabled:!1,time:"",is24Hour:!1,invalidFormatErrorMessage:"Invalid time format",invalidMinMaxErrorMessage:"Invalid time entered",placeholder:"hh:mm",delimiter:":","aria-label":"Time picker",width:"150px",menuAppendTo:"inline",stepMinutes:30,inputProps:{},minTime:"",maxTime:"",isOpen:!1,setIsOpen:()=>{},zIndex:9999};const dn={name:"CaretUpIcon",height:512,width:320,svgPath:"M288.662 352H31.338c-17.818 0-26.741-21.543-14.142-34.142l128.662-128.662c7.81-7.81 20.474-7.81 28.284 0l128.662 128.662c12.6 12.599 3.676 34.142-14.142 34.142z",yOffset:0,xOffset:0},un=Ke(dn),pn=({name:t,label:s,helpText:a,defaultValue:u,isRequired:d,variant:c="typeaheadMulti"})=>{const{adminClient:l}=te(),{t:p}=$(),{control:f,getValues:m,formState:{errors:n}}=K(),i=m(t),[r,o,g]=ue(),[C,v]=k([]),[R,M]=k(""),[b,T]=k(""),I=Kt(),Q=jt(Tt(T,1e3),[]);ne(()=>{const h={max:20};return b&&(h.username=b),i?.length&&!b?Promise.all(i.map(x=>l.users.findOne({id:x}))):l.users.find(h)},v,[b]);const X=h=>h.filter(x=>x!==void 0).map(x=>e(ie,{value:x.id,selected:i?.includes(x.id),children:x.username},x.id));return y(L,{label:p(s),isRequired:d,labelIcon:e(F,{helpText:a,fieldLabelId:s}),fieldId:t,children:[e(V,{name:t,defaultValue:u,control:f,rules:d&&c==="typeaheadMulti"?{validate:h=>h.length>0}:{required:d},render:({field:h})=>e(It,{id:t,onOpenChange:o,toggle:x=>e(re,{"data-testid":t,ref:x,variant:"typeahead",onClick:o,isExpanded:r,isFullWidth:!0,status:n[t]?"danger":void 0,children:y(bt,{isPlain:!0,children:[e(xt,{value:R,onClick:o,onChange:(N,D)=>{g(!0),M(D),Q(D)},autoComplete:"off",innerRef:I,placeholderText:p("selectAUser"),...h.value&&{"aria-activedescendant":h.value},role:"combobox",isExpanded:r,"aria-controls":"select-create-typeahead-listbox",children:c==="typeaheadMulti"&&Array.isArray(h.value)&&e(je,{"aria-label":"Current selections",children:h.value.map((N,D)=>e(Be,{onClick:H=>{H.stopPropagation(),h.onChange(h.value.filter(q=>q!==N))},children:C.find(H=>H?.id===N)?.username},D))})}),e(Ot,{children:!!b&&e(w,{variant:"plain",onClick:()=>{M(""),T(""),h.onChange([]),I?.current?.focus()},"aria-label":"Clear input value",children:e(kt,{"aria-hidden":!0})})})]})}),isOpen:r,selected:h.value,onSelect:(x,N)=>{const D=N?.toString();if(c!=="typeaheadMulti"){const H=h.value.includes(D);H?h.onChange([]):h.onChange([D]),M(H?"":C.find(q=>q?.id===D)?.username||""),g(!1)}else{const H=h.value.find(q=>q===D)?h.value.filter(q=>q!==D):[...h.value,D];h.onChange(H)}},"aria-label":p(t),children:e(Pt,{children:X(C)})})}),n[t]&&e(ee,{message:p("required")})]})},Ie=["UNANIMOUS","AFFIRMATIVE","CONSENSUS"],hn=({helpLabel:t,isDisabled:s=!1,isLimited:a=!1})=>{const{t:u}=$(),{control:d}=K();return e(L,{label:u("decisionStrategy"),labelIcon:e(F,{helpText:u(t||"decisionStrategyHelp"),fieldLabelId:"decisionStrategy"}),fieldId:"decisionStrategy",hasNoPaddingTop:!0,children:e(V,{name:"decisionStrategy","data-testid":"decisionStrategy",defaultValue:Ie[0],control:d,render:({field:c})=>e(A,{children:(a?Ie.slice(0,2):Ie).map(l=>e(ce,{id:l,"data-testid":l,isChecked:c.value===l,isDisabled:s,name:"decisionStrategy",onChange:()=>c.onChange(l),label:u(`decisionStrategies.${l}`),className:"pf-v5-u-mb-md"},l))})})})},mn={resources:{searchFunction:"listResources",fetchFunction:"getAssociatedResources"},policies:{searchFunction:"listPolicies",fetchFunction:"getAssociatedPolicies"}},fn=({name:t,clientId:s,permissionId:a,variant:u=Me.typeaheadMulti,preSelected:d,isRequired:c=!1})=>{const{adminClient:l}=te(),{realm:p}=$t(),{t:f}=$(),m=We(),{control:n,formState:{errors:i,isDirty:r}}=K(),[o,g]=k([]),[C,v]=k(""),[R,M]=k(!1),[b,T]=ue(),[I,Q]=k(),[X,h]=k(),x=mn[t],N=S=>({id:"_id"in S?S._id:"id"in S?S.id:void 0,name:S.name,type:S.type});ne(async()=>{const S=Object.assign({id:s,first:0,max:10,permission:"false"},C===""?null:{name:C});return await Promise.all([l.clients.listPolicyProviders({id:s}),l.clients[x.searchFunction](S),a?l.clients[x.fetchFunction]({id:s,permissionId:a}):Promise.resolve([])])},([S,...E])=>{Q(S.filter(P=>P.type!=="resource"&&P.type!=="scope")),g(E.flat().filter(P=>typeof P!="string").map(N).filter(({id:P},Y,_)=>Y===_.findIndex(({id:Z})=>P===Z)))},[C]);const[D,H]=nt({titleKey:f("unsavedChangesTitle"),messageKey:f("unsavedChangesConfirm"),continueButtonLabel:f("continue"),continueButtonVariant:se.danger,onConfirm:()=>X?.()}),q=S=>t==="policies"?Qe({realm:p,id:s,policyId:S.id,policyType:S.type}):Dt({realm:p,id:s,resourceId:S.id}),ae=()=>o.map(S=>e(ie,{value:S.id,children:S.name},S.id)),fe=S=>e(je,{children:S.value?.map(E=>{const P=o.find(_=>_.id===E);if(!P)return;const Y=q(P);return e(Be,{onClick:()=>{S.onChange(S.value?.filter(_=>_!==P.id))},children:e(Je,{to:Y,onClick:_=>{r&&(_.preventDefault(),h(()=>()=>m(Y)),D())},children:P.name})},P.id)})});return y(A,{children:[e(H,{}),b&&e(Rn,{policyProviders:I,onSelect:S=>{m(Rt({id:s,realm:p,policyType:S.type}))},toggleDialog:T}),e(V,{name:t,defaultValue:d?[d]:[],control:n,rules:{validate:S=>!c||S.length>0},render:({field:S})=>e(Ye,{toggleId:t,variant:u,onToggle:E=>M(E),onFilter:E=>(v(E),ae()),onClear:()=>{S.onChange([]),v("")},selections:S.value,onSelect:E=>{const P=E.toString();if(u===Me.typeaheadMulti){const Y=S.value?.find(_=>_===P)?S.value.filter(_=>_!==P):[...S.value,P];S.onChange(Y)}else S.onChange([P]);v("")},isOpen:R,"aria-label":f(t),isDisabled:!!d,validated:i[t]?"error":"default",typeAheadAriaLabel:f(t),chipGroupComponent:fe(S),footer:t==="policies"?e(w,{variant:"link",isInline:!0,onClick:()=>{r?(M(!1),h(()=>T),D()):T()},children:f("createPolicy")}):void 0,children:ae()})})]})},gn=()=>{const{t}=$(),{id:s}=it();return y(A,{children:[e(L,{label:t("applyPolicy"),fieldId:"policies",labelIcon:e(F,{helpText:t("applyPolicyHelp"),fieldLabelId:"policies"}),children:e(fn,{name:"policies",clientId:s})}),e(hn,{helpLabel:"policyDecisionStagey"})]})},Cn=()=>{const{t}=$();return e(Yt,{name:"clients",label:t("clients"),helpText:t("policyClientHelp"),required:!0,defaultValue:[],variant:"typeaheadMulti"})},yn=({clientScopes:t,clientName:s,open:a,toggleDialog:u,onAdd:d,isClientScopesConditionType:c})=>{const{t:l}=$(),[p,f]=k(!1),[m,n]=k([]),[i,r]=k("Name"),[o,g]=k("All"),[C,v]=ue(),[R,M]=ue(!1),b=tt(()=>o==="OpenID Connect"?t.filter(h=>h.protocol==="openid-connect"):o==="SAML"?t.filter(h=>h.protocol==="saml"):t,[t,i,o]),T=h=>{const x=m.map(N=>({scope:N,type:h}));d(x),f(!1),u()},I=h=>{h==="Name"?r("Protocol"):h==="Protocol"&&(r("Name"),g("All")),v()},Q=h=>{h==="SAML"?g("SAML"):h==="OpenID Connect"?g("OpenID Connect"):h==="All"&&g("All"),M()},X=[e(ie,{value:"SAML",children:l("protocolTypes.saml")},1),e(ie,{value:"OpenID Connect",children:l("protocolTypes.openid-connect")},2),e(ie,{value:"All",children:l("protocolTypes.all")},3)];return e(Xe,{variant:Ze.medium,title:c?l("addClientScope"):l("addClientScopesTo",{clientName:s}),isOpen:a,onClose:u,actions:c?[e(w,{id:"modal-add","data-testid":"confirm",variant:se.primary,onClick:()=>{const h=m.map(x=>({scope:x}));d(h),u()},isDisabled:m.length===0,children:l("add")},"add"),e(w,{id:"modal-cancel","data-testid":"cancel",variant:se.link,onClick:()=>{n([]),u()},children:l("cancel")},"cancel")]:[e(ye,{popperProps:{direction:"up"},onOpenChange:h=>f(h),className:"keycloak__client-scopes-add__add-dropdown",isOpen:p,toggle:h=>e(re,{ref:h,isDisabled:m.length===0,onClick:()=>f(!p),variant:"primary",id:"add-dropdown",statusIcon:e(un,{}),children:l("add")}),children:e(Se,{children:Jt(l,T)})},"add-dropdown"),e(w,{id:"modal-cancel",variant:se.link,onClick:()=>{n([]),u()},children:l("cancel")},"cancel")],children:e(Mt,{loader:b,ariaLabelKey:"chooseAMapperType",searchPlaceholderKey:i==="Name"?"searchForClientScope":void 0,isSearching:i!=="Name",searchTypeComponent:e(ye,{onSelect:()=>{I(i)},onOpenChange:v,toggle:h=>e(re,{ref:h,"data-testid":"filter-type-dropdown",id:"toggle-id-9",onClick:v,icon:e(Ne,{}),statusIcon:e(Ae,{}),children:i}),isOpen:C,children:e(Se,{children:e(xe,{"data-testid":"filter-type-dropdown-item",children:l(i==="Name"?"protocol":"name")},"filter-type")})}),toolbarItem:i==="Protocol"&&y(A,{children:[e(ye,{onSelect:()=>{I(i)},onOpenChange:v,"data-testid":"filter-type-dropdown",toggle:h=>e(re,{ref:h,id:"toggle-id-9",onClick:v,statusIcon:e(Ae,{}),icon:e(Ne,{}),children:i}),isOpen:C,children:e(Se,{children:e(xe,{"data-testid":"filter-type-dropdown-item",children:l("name")},"filter-type")})}),e(Ye,{className:"kc-protocolType-select","aria-label":l("selectOne"),onToggle:M,onSelect:h=>Q(h.toString()),selections:o,isOpen:R,children:X})]}),canSelectAll:!0,onSelect:h=>n(h),columns:[{name:"name"},{name:"protocol",displayKey:"protocol",cellRenderer:h=>Qt(l,h.protocol??"openid-connect")},{name:"description"}],emptyState:e(At,{message:l("emptyAddClientScopes"),instructions:l("emptyAddClientScopesInstructions")})})})},Sn=()=>{const{adminClient:t}=te(),{t:s}=$(),{control:a,getValues:u,setValue:d,formState:{errors:c}}=K(),[l,p]=k(!1),[f,m]=k([]),[n,i]=k([]),r=st();return ne(()=>t.clientScopes.find(),o=>{i(u("clientScopes").map(g=>o.find(C=>C.id===g.id))),m(r(o,ot("name")))},[]),y(L,{label:s("clientScopes"),labelIcon:e(F,{helpText:s("clientsClientScopesHelp"),fieldLabelId:"clientScopes"}),fieldId:"clientScopes",isRequired:!0,children:[e(V,{name:"clientScopes",control:a,defaultValue:[],rules:{validate:o=>o.filter(g=>g.id).length>0},render:({field:o})=>y(A,{children:[l&&e(yn,{clientScopes:f.filter(g=>!o.value.map(C=>C.id).includes(g.id)),isClientScopesConditionType:!0,open:l,toggleDialog:()=>p(!l),onAdd:g=>{i([...n,...g.map(C=>C.scope)]),o.onChange([...o.value,...g.map(C=>C.scope).map(C=>({id:C.id,required:!1}))])}}),e(w,{"data-testid":"select-scope-button",variant:"secondary",onClick:()=>{p(!0)},children:s("addClientScopes")})]})}),n.length>0&&y(pe,{variant:"compact",children:[e(he,{children:y(J,{children:[e(G,{children:s("clientScopeTitle")}),e(G,{children:s("required")}),e(G,{"aria-hidden":"true"})]})}),e(me,{children:n.map((o,g)=>y(J,{children:[e(z,{children:o.name}),e(z,{children:e(V,{name:`clientScopes.${g}.required`,defaultValue:!1,control:a,render:({field:C})=>e(ke,{id:"required","data-testid":"standard",name:"required",isChecked:C.value,onChange:C.onChange})})}),e(z,{children:e(w,{variant:"link",className:"keycloak__client-authorization__policy-row-remove",icon:e(Pe,{}),onClick:()=>{d("clientScopes",[...u("clientScopes").filter(C=>C.id!==o.id)]),i([...n.filter(C=>C.id!==o.id)])}})})]},o.id))})]}),c.clientScopes&&e(ee,{message:s("requiredClientScope")})]})},vn=()=>{const{adminClient:t}=te(),{t:s}=$(),{control:a,getValues:u,setValue:d,formState:{errors:c}}=K(),l=u("groups"),[p,f]=k(!1),[m,n]=k([]);return ne(()=>l&&l.length>0?Promise.all(l.map(i=>t.groups.findOne({id:i.id}))):Promise.resolve([]),i=>{const r=i.filter(o=>o);n(r)},[]),y(A,{children:[e(de,{name:"groupsClaim",label:s("groupsClaim"),labelIcon:s("groupsClaimHelp")}),y(L,{label:s("groups"),labelIcon:e(F,{helpText:s("policyGroupsHelp"),fieldLabelId:"groups"}),fieldId:"groups",isRequired:!0,children:[e(V,{name:"groups",control:a,defaultValue:[],rules:{validate:i=>i&&i.filter(({id:r})=>r).length>0},render:({field:i})=>y(A,{children:[p&&e(Xt,{type:"selectMany",text:{title:"addGroupsToGroupPolicy",ok:"add"},onConfirm:r=>{i.onChange([...i.value||[],...(r||[]).map(({id:o})=>({id:o}))]),n([...m,...r||[]]),f(!1)},onClose:()=>{f(!1)},filterGroups:m}),e(w,{"data-testid":"select-group-button",variant:"secondary",onClick:()=>{f(!0)},children:s("addGroups")})]})}),m.length>0&&y(pe,{variant:"compact",children:[e(he,{children:y(J,{children:[e(G,{children:s("groups")}),e(G,{children:s("extendToChildren")}),e(G,{"aria-hidden":"true"})]})}),e(me,{children:m.map((i,r)=>y(J,{children:[e(z,{children:i.path}),e(z,{children:e(V,{name:`groups.${r}.extendChildren`,defaultValue:!1,control:a,render:({field:o})=>e(ke,{id:"extendChildren","data-testid":"standard",name:"extendChildren",isChecked:o.value,onChange:o.onChange,isDisabled:i.subGroupCount===0})})}),e(z,{children:e(w,{variant:"link",className:"keycloak__client-authorization__policy-row-remove",icon:e(Pe,{}),onClick:()=>{d("groups",[...(l||[]).filter(({id:o})=>o!==i.id)]),n([...m.filter(({id:o})=>o!==i.id)])}})})]},i.id))})]}),c.groups&&e(ee,{message:s("requiredGroups")})]})]})},Tn=()=>{const{t}=$(),{control:s}=K();return e(L,{label:t("code"),labelIcon:e(F,{helpText:t("policyCodeHelp"),fieldLabelId:"code"}),fieldId:"code",isRequired:!0,children:e(V,{name:"code",defaultValue:"",control:s,render:({field:a})=>e(Zt,{id:"code","data-testid":"code",onChange:a.onChange,code:a.value,height:"600px",language:en.javascript,isReadOnly:!0})})})},qe=["POSITIVE","NEGATIVE"],In=({isDisabled:t})=>{const{t:s}=$(),{control:a}=K();return e(L,{label:s("logic"),labelIcon:e(F,{helpText:s("logicHelp"),fieldLabelId:"logic"}),fieldId:"logic",hasNoPaddingTop:!0,children:e(V,{name:"logic","data-testid":"logic",defaultValue:qe[0],control:a,render:({field:u})=>e(A,{children:qe.map(d=>e(ce,{id:d,"data-testid":d,isChecked:u.value===d,name:"logic",onChange:()=>u.onChange(d),label:s(`logicType.${d.toLowerCase()}`),className:"pf-v5-u-mb-md",isDisabled:t},d))})})})},bn=({isDisabled:t})=>{const{t:s}=$();return y(A,{children:[e(de,{name:"name",label:s("name"),rules:{required:s("required")},isDisabled:t}),e(Et,{name:"description",label:s("description"),rules:{maxLength:{message:s("maxLength",{length:255}),value:255}},isDisabled:t})]})},xn=()=>{const{t}=$();return y(A,{children:[e(de,{name:"targetClaim",label:t("targetClaim"),labelIcon:t("targetClaimHelp"),rules:{required:t("required")}}),e(de,{name:"pattern",label:t("regexPattern"),labelIcon:t("regexPatternHelp"),rules:{required:t("required")}}),e(_t,{name:"targetContextAttributes",label:t("targetContextAttributes"),labelIcon:t("targetContextAttributesHelp"),labelOn:t("yes"),labelOff:t("no")})]})},On=()=>{const{adminClient:t}=te(),{t:s}=$(),{control:a,getValues:u,setValue:d,formState:{errors:c}}=K(),l=u("roles"),[p,f]=k(!1),[m,n]=k([]);return ne(async()=>{if(l&&l.length>0){const i=await Promise.all(l.map(r=>t.roles.findOneById({id:r.id})));return Promise.all(i.map(async r=>({role:r,client:r.clientRole?await t.clients.findOne({id:r?.containerId}):void 0})))}return Promise.resolve([])},n,[]),y(A,{children:[y(L,{label:s("roles"),labelIcon:e(F,{helpText:s("policyRolesHelp"),fieldLabelId:"roles"}),fieldId:"roles",isRequired:!0,children:[e(V,{name:"roles",control:a,defaultValue:[],rules:{validate:i=>i&&i.filter(r=>r.id).length>0},render:({field:i})=>y(A,{children:[p&&e(nn,{id:"role",type:"roles",onAssign:r=>{i.onChange([...i.value||[],...r.map(o=>({id:o.role.id}))]),n([...m,...r]),f(!1)},onClose:()=>{f(!1)},isLDAPmapper:!0}),e(w,{"data-testid":"select-role-button",variant:"secondary",onClick:()=>{f(!0)},children:s("addRoles")})]})}),m.length>0&&y(pe,{variant:"compact",children:[e(he,{children:y(J,{children:[e(G,{children:s("roles")}),e(G,{children:s("required")}),e(G,{"aria-hidden":"true"})]})}),e(me,{children:m.map((i,r)=>y(J,{children:[e(z,{children:e(sn,{role:i.role,client:i.client})}),e(z,{children:e(V,{name:`roles.${r}.required`,defaultValue:!1,control:a,render:({field:o})=>e(ke,{id:"required","data-testid":"standard",name:"required",isChecked:o.value,onChange:o.onChange})})}),e(z,{children:e(w,{variant:"link",className:"keycloak__client-authorization__policy-row-remove",icon:e(Pe,{}),onClick:()=>{d("roles",[...(l||[]).filter(o=>o.id!==i.role.id)]),n([...m.filter(o=>o.role.id!==i.role.id)])}})})]},i.role.id))})]}),c.roles&&e(ee,{message:s("requiredRoles")})]}),e(tn,{name:"fetchRoles",label:s("fetchRoles"),labelIcon:s("fetchRolesHelp")})]})},be=/(\d\d\d\d-\d\d-\d\d)? (\d\d?):(\d\d?)/,Ue=t=>t.toString().padStart(2,"0"),Ge=({name:t})=>{const{control:s}=K(),a=(d,c)=>{if(!c)return d;const l=be.exec(d);return`${[c.getFullYear(),Ue(c.getMonth()+1),Ue(c.getDate())].join("-")} ${l?l[2]:"00"}:${l?l[3]:"00"}:00`},u=(d,c,l)=>{const p=be.exec(d);return l!=null?`${p?p[1]:""} ${c}:${l<10?`0${l}`:l}:00`:d};return e(V,{name:t,defaultValue:"",control:s,rules:{required:!0},render:({field:d})=>{const c=d.value.match(be)||["","","0","00"];return y(et,{hasGutter:!0,id:t,children:[e(oe,{children:e(on,{value:c[1],onChange:(l,p,f)=>{d.onChange(a(d.value,f))}})}),e(oe,{children:e($e,{time:`${c[2]}:${c[3]}`,onChange:(l,p,f,m)=>d.onChange(u(d.value,f,m)),is24Hour:!0})})]})}})},ze=({name:t,min:s,max:a})=>{const{control:u}=K(),d=c=>Math.min(c,a);return e(V,{name:t,defaultValue:"",control:u,render:({field:c})=>e(Vt,{id:t,value:c.value,min:s,max:a,onPlus:()=>c.onChange(Number(c.value)+1),onMinus:()=>c.onChange(Number(c.value)-1),onChange:l=>{const p=Number(l.currentTarget.value);c.onChange(d(isNaN(p)?0:p))}})})},le=({name:t,...s})=>{const{t:a}=$();return e(L,{label:a(t),fieldId:t,labelIcon:e(F,{helpText:a(`${t}Help`),fieldLabelId:t}),children:y(et,{hasGutter:!0,children:[e(oe,{children:e(ze,{name:t,...s})}),e(oe,{children:a("to")}),e(oe,{children:e(ze,{name:`${t}End`,...s})})]})})},kn=()=>{const{t}=$(),{getValues:s,formState:{errors:a}}=K(),[u,d]=k(s("month"));return y(A,{children:[e(L,{label:t("repeat"),fieldId:"repeat",labelIcon:e(F,{helpText:t("repeatHelp"),fieldLabelId:"repeat"}),children:y(wt,{children:[e(Ee,{children:e(ce,{id:"notRepeat","data-testid":"notRepeat",isChecked:!u,name:"repeat",onChange:()=>d(!1),label:t("notRepeat"),className:"pf-v5-u-mb-md"})}),e(Ee,{children:e(ce,{id:"repeat","data-testid":"repeat",isChecked:u,name:"repeat",onChange:()=>d(!0),label:t("repeat"),className:"pf-v5-u-mb-md"})})]})}),u&&y(A,{children:[e(le,{name:"month",min:1,max:12}),e(le,{name:"dayMonth",min:1,max:31}),e(le,{name:"hour",min:0,max:23}),e(le,{name:"minute",min:0,max:59})]}),y(L,{label:t("startTime"),fieldId:"notBefore",labelIcon:e(F,{helpText:t("startTimeHelp"),fieldLabelId:"startTime"}),isRequired:!0,children:[e(Ge,{name:"notBefore"}),a.notBefore&&e(ee,{message:t("required")})]}),y(L,{label:t("expireTime"),fieldId:"notOnOrAfter",labelIcon:e(F,{helpText:t("expireTimeHelp"),fieldLabelId:"expireTime"}),isRequired:!0,children:[e(Ge,{name:"notOnOrAfter"}),a.notOnOrAfter&&e(ee,{message:t("required")})]})]})},Pn=()=>{const{t}=$();return e(pn,{name:"users",label:"users",helpText:t("policyUsers"),defaultValue:[],variant:"typeaheadMulti",isRequired:!0})},Oe={aggregate:gn,client:Cn,user:Pn,"client-scope":Sn,group:vn,regex:xn,role:On,time:kn,js:Tn},Re=t=>t in Oe;function $n(){const{adminClient:t}=te(),{t:s}=$(),{id:a,realm:u,policyId:d,policyType:c}=it(),l=We(),p=Nt(),{reset:f,handleSubmit:m}=p,{addAlert:n,addError:i}=Ht(),[r,o]=k(),g=c==="js";ne(async()=>{if(d){const T=await Promise.all([t.clients.findOnePolicy({id:a,type:c,policyId:d}),t.clients.getAssociatedPolicies({id:a,permissionId:d})]);if(!T[0])throw new Error(s("notFound"));return{policy:T[0],policies:T[1].map(I=>I.id)}}return{}},({policy:T,policies:I})=>{f({...T,policies:I}),o(T)},[a,c,d]);const C=async T=>{T.groups=T.groups?.filter(I=>I.id),T.clientScopes=T.clientScopes?.filter(I=>I.id),T.roles=T.roles?.filter(I=>I.id).map(I=>({...I,required:I.required||!1}));try{if(d)await t.clients.updatePolicy({id:a,type:c,policyId:d},T);else{const I=await t.clients.createPolicy({id:a,type:c},T);l(Qe({realm:u,id:a,policyType:c,policyId:I.id}))}n(s((d?"update":"create")+"PolicySuccess"),we.success)}catch(I){i("policySaveError",I)}},[v,R]=nt({titleKey:"deletePolicy",messageKey:"deletePolicyConfirm",continueButtonLabel:"confirm",onConfirm:async()=>{try{await t.clients.delPolicy({id:a,policyId:d}),n(s("policyDeletedSuccess"),we.success),l(_e({realm:u,clientId:a,tab:"policies"}))}catch(T){i("policyDeletedError",T)}}});if(d&&!r)return e(Lt,{});function M(){return Re(c)?Oe[c]:Oe.js}const b=M();return y(A,{children:[e(R,{}),e(Wt,{titleKey:d?r?.name:s("createPolicyOfType",{policyType:c}),dropdownItems:d?[e(xe,{"data-testid":"delete-policy",onClick:()=>v(),children:s("delete")},"delete")]:void 0}),e(Ft,{variant:"light",children:y(Bt,{isHorizontal:!0,onSubmit:m(C),role:"anyone",children:[y(qt,{...p,children:[e(bn,{isDisabled:g}),e(b,{}),e(In,{isDisabled:g})]}),e(Ut,{children:y("div",{className:"pf-v5-u-mt-md",children:[e(w,{isDisabled:g,variant:se.primary,className:"pf-v5-u-mr-md",type:"submit","data-testid":"save",children:s("save")}),e(w,{variant:"link","data-testid":"cancel",component:T=>e(Je,{...T,to:_e({realm:u,clientId:a,tab:"policies"})}),children:s("cancel")})]})})]})})]})}const Wn=Object.freeze(Object.defineProperty({__proto__:null,default:$n,isValidComponentType:Re},Symbol.toStringTag,{value:"Module"})),Rn=({policyProviders:t,onSelect:s,toggleDialog:a})=>{const{t:u}=$(),d=st(),c=tt(()=>t?d(t,ot("name")):[],[t]);return e(Xe,{"aria-label":u("createPolicy"),variant:Ze.medium,header:y(Gt,{children:[e(Ve,{component:zt.h1,children:u("chooseAPolicyType")}),e(Ve,{children:u("chooseAPolicyTypeInstructions")})]}),isOpen:!0,onClose:a,children:y(pe,{"aria-label":u("policies"),variant:"compact",children:[e(he,{children:y(J,{children:[e(G,{children:u("name")}),e(G,{children:u("description")})]})}),e(me,{children:c.map(l=>y(J,{"data-testid":l.type,onRowClick:()=>s(l),isClickable:!0,children:[e(z,{children:l.name}),e(z,{children:Re(l.type)&&u(`policyProvider.${l.type}`)})]},l.type))})]})})};export{yn as A,hn as D,Rn as N,Wn as P,fn as R,pn as U};
//# sourceMappingURL=NewPolicyDialog-BHUMDPD9.js.map
