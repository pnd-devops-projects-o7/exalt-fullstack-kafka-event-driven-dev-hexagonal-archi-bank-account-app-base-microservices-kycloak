{"version":3,"file":"PageList-CMYdIP7r.js","sources":["../../../../../../../src/page/PageList.tsx"],"sourcesContent":["import ComponentRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/componentRepresentation\";\nimport type { ComponentQuery } from \"@keycloak/keycloak-admin-client/lib/resources/components\";\nimport {\n  KeycloakDataTable,\n  ListEmptyState,\n  useAlerts,\n} from \"@keycloak/keycloak-ui-shared\";\nimport {\n  Button,\n  ButtonVariant,\n  PageSection,\n  ToolbarItem,\n} from \"@patternfly/react-core\";\nimport { IRowData } from \"@patternfly/react-table\";\nimport { get } from \"lodash-es\";\nimport { useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { Link, useNavigate, useParams } from \"react-router-dom\";\nimport { useAdminClient } from \"../admin-client\";\nimport { useConfirmDialog } from \"../components/confirm-dialog/ConfirmDialog\";\nimport { ViewHeader } from \"../components/view-header/ViewHeader\";\nimport { useRealm } from \"../context/realm-context/RealmContext\";\nimport { useServerInfo } from \"../context/server-info/ServerInfoProvider\";\nimport { PAGE_PROVIDER } from \"./constants\";\nimport { addDetailPage, PageListParams, toDetailPage } from \"./routes\";\n\ntype DetailLinkProps = {\n  obj: ComponentRepresentation;\n  field: string;\n};\n\nconst DetailLink = ({ obj, field }: DetailLinkProps) => {\n  const { realm } = useRealm();\n  const value = get(obj, field);\n  return (\n    <Link\n      key={value}\n      to={toDetailPage({ realm, providerId: obj.providerId!, id: obj.id! })}\n    >\n      {value}\n    </Link>\n  );\n};\nexport default function PageList() {\n  const { adminClient } = useAdminClient();\n\n  const { t } = useTranslation();\n  const { addAlert, addError } = useAlerts();\n  const navigate = useNavigate();\n  const { providerId } = useParams<PageListParams>();\n  const [key, setKey] = useState(0);\n  const refresh = () => setKey(key + 1);\n\n  const { realm: realmName, realmRepresentation: realm } = useRealm();\n  const [selectedItem, setSelectedItem] = useState<ComponentRepresentation>();\n  const { componentTypes } = useServerInfo();\n  const pages = componentTypes?.[PAGE_PROVIDER];\n\n  const page = pages?.find((p) => p.id === providerId)!;\n\n  const loader = async () => {\n    const params: ComponentQuery = {\n      parent: realm?.id,\n      type: PAGE_PROVIDER,\n    };\n    return await adminClient.components.find({ ...params });\n  };\n\n  const [toggleDeleteDialog, DeleteConfirm] = useConfirmDialog({\n    titleKey: \"itemDeleteConfirmTitle\",\n    messageKey: \"itemDeleteConfirm\",\n    continueButtonLabel: \"delete\",\n    continueButtonVariant: ButtonVariant.danger,\n    onConfirm: async () => {\n      try {\n        await adminClient.components.del({\n          id: selectedItem!.id!,\n        });\n        addAlert(t(\"itemDeletedSuccess\"));\n        refresh();\n      } catch (error) {\n        addError(\"itemSaveError\", error);\n      }\n    },\n  });\n\n  return (\n    <PageSection variant=\"light\" className=\"pf-v5-u-p-0\">\n      <DeleteConfirm />\n      <ViewHeader titleKey={page.id} subKey={page.helpText} divider={false} />\n      <KeycloakDataTable\n        key={key}\n        toolbarItem={\n          <ToolbarItem>\n            <Button\n              component={(props) => (\n                <Link\n                  {...props}\n                  to={addDetailPage({ realm: realmName, providerId: page.id })}\n                />\n              )}\n            >\n              {t(\"createItem\")}\n            </Button>\n          </ToolbarItem>\n        }\n        actionResolver={(item: IRowData) => [\n          {\n            title: t(\"delete\"),\n            onClick() {\n              setSelectedItem(item.data);\n              toggleDeleteDialog();\n            },\n          },\n        ]}\n        searchPlaceholderKey=\"searchItem\"\n        loader={loader}\n        columns={[\n          ...(\n            page.metadata.displayFields ||\n            page.properties.slice(0, 3).map((p) => p.name)\n          ).map((name: string, index: number) => ({\n            name: `config.${name}[0]`,\n            displayKey: page.properties.find((p) => p.name === name)!.label,\n            cellRenderer:\n              index === 0\n                ? (obj: ComponentRepresentation) => (\n                    <DetailLink obj={obj} field={`config.${name}`} />\n                  )\n                : undefined,\n          })),\n        ]}\n        ariaLabelKey=\"list\"\n        emptyState={\n          <ListEmptyState\n            hasIcon\n            message={t(\"noItems\")}\n            instructions={t(\"noItemsInstructions\")}\n            primaryActionText={t(\"createItem\")}\n            onPrimaryAction={() =>\n              navigate(addDetailPage({ realm: realmName, providerId: page.id }))\n            }\n          />\n        }\n      />\n    </PageSection>\n  );\n}\n"],"names":["DetailLink","obj","field","realm","useRealm","value","get","jsx","Link","toDetailPage","PageList","adminClient","useAdminClient","t","useTranslation","addAlert","addError","useAlerts","navigate","useNavigate","providerId","useParams","key","setKey","useState","refresh","realmName","selectedItem","setSelectedItem","componentTypes","useServerInfo","page","PAGE_PROVIDER","p","loader","params","toggleDeleteDialog","DeleteConfirm","useConfirmDialog","ButtonVariant","error","jsxs","PageSection","ViewHeader","KeycloakDataTable","ToolbarItem","Button","props","addDetailPage","item","name","index","ListEmptyState"],"mappings":"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"}