import{jsxs as b,Fragment as N,jsx as e}from"react/jsx-runtime";import{a as M,Y as A,I as E,bC as fe,bD as ge,N as P,q as ie,J as w,K as D,a0 as oe,a1 as G,a4 as re,W as Ne,u as X,C as ee,c6 as te,c7 as ae,ai as J,F as be,a2 as Le,j as Me,e as Ve,$ as ye,b as Ke,d as Ce,B as se,p as L,dK as Ee,dL as le,x as Ae,a7 as he,m as Be,P as Ue,bY as He,S as qe,k as Ge,dM as de,T as Je,f as je,L as ve,bZ as ze,D as z,dN as $e}from"./main-C047jAp3.js";import{useState as I,useMemo as We}from"react";import{u as Y}from"./ConfirmDialog-d09hGFUk.js";import{D as _e}from"./DynamicComponents-CCNvrlYx.js";import{F as $,a as Ye}from"./FormAccess-CEFqBG2E.js";import{P as Ze}from"./PermissionTab-D1RTtpaA.js";import{R as Qe,u as Xe}from"./RoutableTabs-BpMBzAU0.js";import{V as et}from"./ViewHeader-Y2Z8ln-o.js";import{u as ne}from"./useParams-6mfeCu18.js";import{T as Z,S as p,F as Q,O as tt,D as at,a as nt}from"./OIDCGeneralSettings-DAzW3JuL.js";import{S as it,D as ot}from"./SamlGeneralSettings-CEo24cKw.js";import{E as rt}from"./ExpandableSection-CzJlltxl.js";import{G as st}from"./GeneralSettings-DbJ5HSez.js";import{M as ce}from"./MultiLineInput-lQlb7SN3.js";import{a as W,b as _}from"./Tabs-Dt-AxIu8.js";import"react-dom";import"./ClientSelect-mboGti-R.js";import"./FileUpload-2t3HfN2b.js";import"./CodeEditor--AHMF_Ho.js";import"./copy-icon-D1BxihC2.js";import"./GroupPickerDialog-CRtxj-P-.js";import"./DataListItemRow-BUcm7LGX.js";import"./KeySelect-DvFB2tXI.js";import"./useToggle-K3Kx99tM.js";import"./AddRoleMappingModal-BqwO7G2x.js";import"./translationFormatter-CkqjPJdy.js";import"./useLocaleSort-O4LGWO8i.js";import"./filter-icon-BeqpAxqe.js";import"./Trans-C8a1WrTl.js";import"./PageHandler-BsZt2gxJ.js";import"./constants-BclHbWtx.js";import"./SwitchControl-87mhceN2.js";/* empty css                           */import"./ClientIdSecret-D8YFRWLH.js";import"./RedirectUrl-BKPgDV71.js";const pe=({field:n,label:t,defaultValue:a,labelForEmpty:r="none"})=>{const{adminClient:d}=X(),{t:i}=M(),{control:s}=A(),[l,g]=I(),[c,v]=I(!1);return ee(()=>d.authenticationManagement.getFlows(),y=>g(y.filter(u=>u.providerId==="basic-flow")),[]),e(w,{label:i(t),labelIcon:e(D,{helpText:i(`${t}Help`),fieldLabelId:t}),fieldId:t,children:e(P,{name:n,defaultValue:a,control:s,render:({field:y})=>e(te,{toggleId:t,onToggle:()=>v(!c),onSelect:u=>{y.onChange(u),v(!1)},selections:y.value||i(r),variant:ae.single,"aria-label":i(t),isOpen:c,children:[...a===""?[e(J,{value:"",children:i(r)},"empty")]:[],...l?.map(u=>e(J,{selected:u.alias===y.value,value:u.alias,children:u.alias},u.id))||[]]})})})},me=["IMPORT","LEGACY","FORCE"],lt=({isOIDC:n,isSAML:t})=>{const{t:a}=M(),{control:r,register:d,setValue:i,formState:{errors:s}}=A(),g=E({control:r,name:"config.filteredByClaim",defaultValue:"false"})==="true",v=fe()(ge.TransientUsers),u=E({control:r,name:"config.doNotStoreUsers",defaultValue:"false"})==="false";return b(N,{children:[!n&&!t&&e(Z,{field:"config.defaultScope",label:"scopes"}),e(p,{field:"storeToken",label:"storeTokens",fieldType:"boolean"}),(t||n)&&e(p,{field:"addReadTokenRoleOnCreate",label:"storedTokensReadable",fieldType:"boolean"}),!n&&!t&&b(N,{children:[e(p,{field:"config.acceptsPromptNoneForwardFromClient",label:"acceptsPromptNone"}),e(p,{field:"config.disableUserInfo",label:"disableUserInfo"})]}),n&&e(p,{field:"config.isAccessTokenJWT",label:"isAccessTokenJWT"}),e(p,{field:"trustEmail",label:"trustEmail",fieldType:"boolean"}),e(p,{field:"linkOnly",label:"accountLinkingOnly",fieldType:"boolean"}),e(p,{field:"hideOnLogin",label:"hideOnLoginPage",fieldType:"boolean"}),(!t||n)&&e(Q,{label:"filteredByClaim",children:e(P,{name:"config.filteredByClaim",defaultValue:"false",control:r,render:({field:f})=>e(ie,{id:"filteredByClaim",label:a("on"),labelOff:a("off"),isChecked:f.value==="true",onChange:(T,C)=>{f.onChange(C.toString())}})})}),(!t||n)&&g&&b(N,{children:[b(w,{label:a("claimFilterName"),labelIcon:e(D,{helpText:a("claimFilterNameHelp"),fieldLabelId:"claimFilterName"}),fieldId:"kc-claim-filter-name",isRequired:!0,children:[e(oe,{isRequired:!0,id:"kc-claim-filter-name","data-testid":"claimFilterName",validated:s.config?.claimFilterName?G.error:G.default,...d("config.claimFilterName",{required:!0})}),s.config?.claimFilterName&&e(re,{message:a("required")})]}),b(w,{label:a("claimFilterValue"),labelIcon:e(D,{helpText:a("claimFilterValueHelp"),fieldLabelId:"claimFilterName"}),fieldId:"kc-claim-filter-value",isRequired:!0,children:[e(oe,{isRequired:!0,id:"kc-claim-filter-value","data-testid":"claimFilterValue",validated:s.config?.claimFilterValue?G.error:G.default,...d("config.claimFilterValue",{required:!0})}),s.config?.claimFilterValue&&e(re,{message:a("required")})]})]}),e(pe,{field:"firstBrokerLoginFlowAlias",label:"firstBrokerLoginFlowAliasOverride",defaultValue:"",labelForEmpty:""}),e(pe,{field:"postBrokerLoginFlowAlias",label:"postBrokerLoginFlowAlias",defaultValue:""}),v&&e(Q,{label:"doNotStoreUsers",children:e(P,{name:"config.doNotStoreUsers",defaultValue:"false",control:r,render:({field:f})=>e(ie,{id:"doNotStoreUsers",label:a("on"),labelOff:a("off"),isChecked:f.value==="true",onChange:(T,C)=>{f.onChange(C.toString()),C&&i("config.syncMode","IMPORT")}})})}),u&&e(Ne,{name:"config.syncMode",label:a("syncMode"),labelIcon:a("syncModeHelp"),options:me.map(f=>({key:f,value:a(`syncModes.${f.toLocaleLowerCase()}`)})),controller:{defaultValue:me[0],rules:{required:a("required")}}}),e(p,{field:"config.caseSensitiveOriginalUsername",label:"caseSensitiveOriginalUsername"})]})},dt={unspecified:"",none:"none",consent:"consent",login:"login",select_account:"select_account"},ct=()=>{const{t:n}=M(),{control:t}=A(),[a,r]=I(!1),[d,i]=I(!1);return e(rt,{toggleText:n("advanced"),onToggle:()=>r(!a),isExpanded:a,children:b(be,{isHorizontal:!0,children:[e(p,{label:"passLoginHint",field:"config.loginHint"}),e(p,{label:"passMaxAge",field:"config.passMaxAge"}),e(p,{label:"passCurrentLocale",field:"config.uiLocales"}),e(p,{field:"config.backchannelSupported",label:"backchannelLogout"}),e(p,{field:"config.sendIdTokenOnLogout",label:"sendIdTokenOnLogout",defaultValue:"true"}),e(p,{field:"config.sendClientIdOnLogout",label:"sendClientIdOnLogout"}),e(p,{field:"config.disableUserInfo",label:"disableUserInfo"}),e(p,{field:"config.disableNonce",label:"disableNonce"}),e(Z,{field:"config.defaultScope",label:"scopes"}),e(Q,{label:"prompt",children:e(P,{name:"config.prompt",defaultValue:"",control:t,render:({field:s})=>e(te,{toggleId:"prompt",onToggle:()=>i(!d),onSelect:l=>{s.onChange(l),i(!1)},selections:s.value||n("prompts.unspecified"),variant:ae.single,"aria-label":n("prompt"),isOpen:d,children:Object.entries(dt).map(([l,g])=>e(J,{selected:g===s.value,value:g,children:n(`prompts.${l}`)},l))})})}),e(p,{field:"config.acceptsPromptNoneForwardFromClient",label:"acceptsPromptNone"}),e(w,{label:n("allowedClockSkew"),labelIcon:e(D,{helpText:n("allowedClockSkewHelp"),fieldLabelId:"allowedClockSkew"}),fieldId:"allowedClockSkew",children:e(P,{name:"config.allowedClockSkew",defaultValue:0,control:t,render:({field:s})=>{const l=Number(s.value);return e(Le,{"data-testid":"allowedClockSkew",inputName:"allowedClockSkew",min:0,max:2147483,value:l,readOnly:!0,onPlus:()=>s.onChange(l+1),onMinus:()=>s.onChange(l-1),onChange:g=>{const c=Number(g.target.value);s.onChange(c<0?0:c)}})}})}),e(Z,{field:"config.forwardParameters",label:"forwardParameters"})]})})},ue=["exact","minimum","maximum","better"],pt=()=>{const{t:n}=M(),{control:t}=A(),[a,r]=I(!1);return b(N,{children:[e(w,{label:n("comparison"),labelIcon:e(D,{helpText:n("comparisonHelp"),fieldLabelId:"comparison"}),fieldId:"comparison",children:e(P,{name:"config.authnContextComparisonType",defaultValue:ue[0],control:t,render:({field:d})=>e(te,{toggleId:"comparison",direction:"up",onToggle:i=>r(i),onSelect:i=>{d.onChange(i.toString()),r(!1)},selections:d.value,variant:ae.single,"aria-label":n("comparison"),isOpen:a,children:ue.map(i=>e(J,{selected:i===d.value,value:i,children:n(i)},i))})})}),e(w,{label:n("authnContextClassRefs"),fieldId:"kc-authnContextClassRefs",labelIcon:e(D,{helpText:n("authnContextClassRefsHelp"),fieldLabelId:"authnContextClassRefs"}),children:e(ce,{name:"config.authnContextClassRefs","aria-label":n("identify-providers:authnContextClassRefs"),addButtonLabel:"addAuthnContextClassRef","data-testid":"classref-field"})}),e(w,{label:n("authnContextDeclRefs"),fieldId:"kc-authnContextDeclRefs",labelIcon:e(D,{helpText:n("authnContextDeclRefsHelp"),fieldLabelId:"authnContextDeclRefs"}),children:e(ce,{name:"config.authnContextDeclRefs","aria-label":n("identify-providers:authnContextDeclRefs"),addButtonLabel:"addAuthnContextDeclRef","data-testid":"declref-field"})})]})},mt=({onChange:n,value:t,save:a,toggleDeleteDialog:r})=>{const{adminClient:d}=X(),{t:i}=M(),{alias:s}=ne(),[l,g]=I(),{addAlert:c,addError:v}=ye(),{setValue:y,formState:u,control:f}=A(),T=E({control:f,name:"config.validateSignature"}),C=E({control:f,name:"config.useMetadataDescriptorUrl"}),k=E({control:f,name:"config.metadataDescriptorUrl"});ee(()=>d.identityProviders.findOne({alias:s}),h=>{if(!h)throw new Error(i("notFound"));g(h)},[]);const[V,F]=Y({titleKey:"disableProvider",messageKey:i("disableConfirmIdentityProvider",{provider:s}),continueButtonLabel:"disable",onConfirm:()=>{n(!t),a()}}),B=async(h,R)=>{try{const S=await d.identityProviders.importFromUrl({providerId:h,fromUrl:R});S.signingCertificate?(y("config.signingCertificate",S.signingCertificate),c(i("importKeysSuccess"),L.success)):v("importKeysError",i("importKeysErrorNoSigningCertificate"))}catch(S){v("importKeysError",S)}},j=async h=>{try{await d.identityProviders.reloadKeys({alias:h})?c(i("reloadKeysSuccess"),L.success):c(i("reloadKeysSuccessButFalse"),L.warning)}catch(R){v("reloadKeysError",R)}};return b(N,{children:[e(F,{}),e(et,{titleKey:ze(l?l.displayName?l.displayName:l.providerId:""),divider:!1,dropdownItems:[...l?.providerId?.includes("saml")&&T==="true"&&C==="true"&&k&&!u.isDirty&&t?[e(z,{onClick:()=>j(l.alias),children:i("reloadKeys")},"reloadKeys")]:l?.providerId?.includes("saml")&&T==="true"&&C!=="true"&&k&&!u.isDirty?[e(z,{onClick:()=>B(l.providerId,k),children:i("importKeys")},"importKeys")]:[],e(he,{},"separator"),e(z,{onClick:()=>r(),children:i("delete")},"delete")],isEnabled:t,onToggle:h=>{h?(n(h),a()):V()}})]})},ut=({name:n,mapperId:t,provider:a})=>{const{realm:r}=Ce(),{alias:d}=ne();return e(ve,{to:$e({realm:r,alias:d,providerId:a?.providerId,id:t}),children:n})};function Zt(){const{adminClient:n}=X(),{t}=M(),{alias:a,providerId:r}=ne(),d=fe(),i=Me(),{handleSubmit:s,getValues:l,reset:g}=i,[c,v]=I(),[y,u]=I(),f=Ve(),T=We(()=>{const o=["org.keycloak.broker.social.SocialIdentityProvider","org.keycloak.broker.provider.IdentityProvider"];for(const m of o){const O=f.componentTypes?.[m]?.find(({id:x})=>x===r);if(O)return O}},[f,r]),{addAlert:C,addError:k}=ye(),V=Ke(),{realm:F}=Ce(),[B,j]=I(0),h=()=>j(B+1);ee(()=>n.identityProviders.findOne({alias:a}),o=>{if(!o)throw new Error(t("notFound"));g(o),v(o),o.config.authnContextClassRefs&&i.setValue("config.authnContextClassRefs",JSON.parse(o.config?.authnContextClassRefs)),o.config.authnContextDeclRefs&&i.setValue("config.authnContextDeclRefs",JSON.parse(o.config?.authnContextDeclRefs))},[]);const R=o=>le({realm:F,alias:a,providerId:r,tab:o}),S=o=>Xe(R(o)),Ie=S("settings"),Se=S("mappers"),xe=S("permissions"),U=async o=>{const m=o||l(),O=m.config?.authnContextClassRefs;m.config?.authnContextClassRefs&&(m.config.authnContextClassRefs=JSON.stringify(m.config.authnContextClassRefs));const x=m.config?.authnContextDeclRefs;m.config?.authnContextDeclRefs&&(m.config.authnContextDeclRefs=JSON.stringify(m.config.authnContextDeclRefs));try{await n.identityProviders.update({alias:a},{...m,config:{...c?.config,...m.config},alias:a,providerId:r}),O&&(m.config.authnContextClassRefs=O),x&&(m.config.authnContextDeclRefs=x),g(m),C(t("updateSuccessIdentityProvider"),L.success)}catch(q){k("updateErrorIdentityProvider",q)}},[Te,ke]=Y({titleKey:"deleteProvider",messageKey:t("deleteConfirmIdentityProvider",{provider:a}),continueButtonLabel:"delete",continueButtonVariant:se.danger,onConfirm:async()=>{try{await n.identityProviders.del({alias:a}),C(t("deletedSuccessIdentityProvider"),L.success),V(Ee({realm:F}))}catch(o){k("deleteErrorIdentityProvider",o)}}}),[Fe,Re]=Y({titleKey:"deleteProviderMapper",messageKey:t("deleteMapperConfirm",{mapper:y?.name}),continueButtonLabel:"delete",continueButtonVariant:se.danger,onConfirm:async()=>{try{await n.identityProviders.delMapper({alias:a,id:y?.mapperId}),C(t("deleteMapperSuccess"),L.success),h(),V(le({providerId:r,alias:a,tab:"mappers",realm:F}))}catch(o){k("deleteErrorIdentityProvider",o)}}});if(!c)return e(Ae,{});const H=c.providerId.includes("oidc"),K=c.providerId.includes("saml"),we=!H&&!K,De=async()=>{const[o,m]=await Promise.all([n.identityProviders.findMappers({alias:a}),n.identityProviders.findMapperTypes({alias:a})]);return o.map(x=>{const q=Object.values(m).find(Oe=>x.identityProviderMapper===Oe.id);return{...q,name:x.name,type:q?.name,mapperId:x.id}})},Pe=[{title:t("generalSettings"),panel:b($,{role:"manage-identity-providers",isHorizontal:!0,onSubmit:s(U),children:[we&&e(st,{create:!1,id:r}),H&&e(tt,{}),K&&e(it,{isAliasReadonly:!0}),T&&e(_e,{stringify:!0,properties:T.properties})]})},{title:t("oidcSettings"),isHidden:!H,panel:b(N,{children:[e(at,{readOnly:!1}),b(be,{isHorizontal:!0,className:"pf-v5-u-py-lg",children:[e(he,{}),e(nt,{create:!1})]}),e(ct,{})]})},{title:t("samlSettings"),isHidden:!K,panel:e(ot,{readOnly:!1})},{title:t("reqAuthnConstraints"),isHidden:!K,panel:e($,{role:"manage-identity-providers",isHorizontal:!0,onSubmit:s(U),children:e(pt,{})})},{title:t("advancedSettings"),panel:b($,{role:"manage-identity-providers",isHorizontal:!0,onSubmit:s(U),children:[e(lt,{isOIDC:H,isSAML:K}),e(Ye,{name:"idp-details",isSubmit:!0,reset:g})]})}];return b(Be,{...i,children:[e(ke,{}),e(Re,{}),e(P,{name:"enabled",control:i.control,defaultValue:!0,render:({field:o})=>e(mt,{value:o.value||!1,onChange:o.onChange,save:U,toggleDeleteDialog:Te})}),e(Ue,{variant:"light",className:"pf-v5-u-p-0",children:b(Qe,{isBox:!0,defaultLocation:R("settings"),children:[e(W,{id:"settings",title:e(_,{children:t("settings")}),...Ie,children:e(He,{label:t("jumpToSection"),className:"pf-v5-u-px-lg",sections:Pe})}),e(W,{id:"mappers","data-testid":"mappers-tab",title:e(_,{children:t("mappers")}),...Se,children:e(qe,{emptyState:e(Ge,{message:t("noMappers"),instructions:t("noMappersInstructions"),primaryActionText:t("addMapper"),onPrimaryAction:()=>V(de({realm:F,alias:a,providerId:c.providerId,tab:"mappers"}))}),loader:De,ariaLabelKey:"mappersList",searchPlaceholderKey:"searchForMapper",toolbarItem:e(Je,{children:e(je,{id:"add-mapper-button",component:o=>e(ve,{...o,to:de({realm:F,alias:a,providerId:c.providerId,tab:"mappers"})}),"data-testid":"addMapper",children:t("addMapper")})}),columns:[{name:"name",displayKey:"name",cellRenderer:o=>e(ut,{...o,provider:c})},{name:"category",displayKey:"category"},{name:"type",displayKey:"type"}],actions:[{title:t("delete"),onRowClick:o=>{u(o),Fe()}}]},B)}),d(ge.AdminFineGrainedAuthz)&&e(W,{id:"permissions","data-testid":"permissionsTab",title:e(_,{children:t("permissions")}),...xe,children:e(Ze,{id:a,type:"identityProviders"})})]})})]})}export{Zt as default};
//# sourceMappingURL=DetailSettings-2SCsv_HB.js.map
