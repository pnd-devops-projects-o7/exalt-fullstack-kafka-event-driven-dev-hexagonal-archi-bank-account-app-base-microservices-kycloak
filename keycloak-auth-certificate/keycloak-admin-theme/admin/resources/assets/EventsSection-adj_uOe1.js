import{jsx as e,jsxs as o,Fragment as ie}from"react/jsx-runtime";import{d as B,L as oe,bk as ve,bM as Le,dd as Ue,bt as Ve,cA as _e,an as xe,cT as Ge,de as le,u as fe,a as W,e as Ke,j as ge,bV as Me,c0 as He,df as je,c1 as Be,c2 as P,c3 as ce,c4 as We,c5 as T,S as Ce,m as ke,av as Ae,aw as x,F as Ie,J as _,N as f,c6 as re,c7 as se,U as w,V as g,ai as ne,Q as b,A as Ee,f as G,bw as Re,k as Fe,M as ze,l as $e,C as Ze,dg as Je,ak as Qe,P as Xe,dh as de,di as ue,z as qe}from"./main-C047jAp3.js";import{useState as m,useMemo as Ye}from"react";import{D as Oe}from"./DropdownPanel-BZ5vtrQT.js";import{R as et,u as tt}from"./RoutableTabs-BpMBzAU0.js";import{V as at}from"./ViewHeader-Y2Z8ln-o.js";import{u as Ne,F as Se}from"./useFormatDate-Bn-bRoLD.js";import{p as De}from"./pickBy-Crd9G7N4.js";import{C as rt,L as st}from"./CodeEditor--AHMF_Ho.js";import{D as K}from"./DatePicker-BkDn_m8-.js";import{D as Pe,a as M,b as H,c as j}from"./DescriptionListTerm-pFw6GB12.js";import{T as nt}from"./Trans-C8a1WrTl.js";import{a as pe,b as me}from"./Tabs-Dt-AxIu8.js";import{W as it}from"./warning-triangle-icon-CIFXPQ_1.js";import"react-dom";import"./PageHandler-BsZt2gxJ.js";import"./DynamicComponents-CCNvrlYx.js";import"./ClientSelect-mboGti-R.js";import"./FileUpload-2t3HfN2b.js";import"./GroupPickerDialog-CRtxj-P-.js";import"./DataListItemRow-BUcm7LGX.js";import"./KeySelect-DvFB2tXI.js";import"./useToggle-K3Kx99tM.js";import"./MultiLineInput-lQlb7SN3.js";import"./AddRoleMappingModal-BqwO7G2x.js";import"./translationFormatter-CkqjPJdy.js";import"./useLocaleSort-O4LGWO8i.js";import"./ConfirmDialog-d09hGFUk.js";import"./filter-icon-BeqpAxqe.js";import"./useParams-6mfeCu18.js";import"./constants-BclHbWtx.js";import"./copy-icon-D1BxihC2.js";const he=38,ot=({text:a,children:t})=>{const l=a||"",u=l.length>he,C=l.substring(0,he);return u?e(ve,{content:a,children:t(C+"â€¦")}):t(l)},lt=a=>a.operationType==="DELETE"?!1:a.resourceType==="USER"||a.resourceType==="GROUP_MEMBERSHIP"||a.resourceType==="GROUP"||a.resourceType==="CLIENT"||a.resourceType==="ORGANIZATION"||a.resourceType==="ORGANIZATION_MEMBERSHIP"||a.resourceType?.startsWith("AUTHORIZATION_RESOURCE")||a.resourceType==="CLIENT_SCOPE"||a.resourceType==="AUTH_FLOW"||a.resourcePath?.startsWith("roles-by-id"),ct=new RegExp(/([0-9a-fA-F]{8}-([0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12})/),dt=(a,t)=>{const l=ct.exec(t.resourcePath);if(!l)return console.warn("event didn't contain a valid link",t),"";const u=l[1];return t.resourceType==="CLIENT"||t.resourceType?.startsWith("AUTHORIZATION_RESOURCE")?Le({realm:a,clientId:u,tab:t.resourceType==="CLIENT"?"settings":"authorization"}):t.resourceType==="GROUP"?Ue({realm:a,id:u}):t.resourceType==="CLIENT_SCOPE"?Ve({realm:a,id:u,tab:"settings"}):t.resourceType==="USER"||t.resourceType==="GROUP_MEMBERSHIP"?_e({realm:a,id:u,tab:"settings"}):t.resourceType==="AUTH_FLOW"?xe({realm:a,id:u,usedBy:"-"}):t.resourcePath?.startsWith("roles-by-id")?Ge({realm:a,id:u,tab:"details"}):t.resourceType==="ORGANIZATION"?le({realm:a,id:u,tab:"settings"}):t.resourceType==="ORGANIZATION_MEMBERSHIP"?le({realm:a,id:u,tab:"members"}):""},ut=({event:a})=>{const{realm:t}=B();return e(ot,{text:a.resourcePath,children:l=>lt(a)?e(oe,{to:dt(t,a),children:l}):e("span",{children:l})})},pt=a=>e(ut,{event:a}),ye={resourceTypes:[],operationTypes:[],resourcePath:"",dateFrom:"",dateTo:"",authClient:"",authUser:"",authRealm:"",authIpAddress:""},Te=({titleKey:a,onClose:t,children:l})=>{const{t:u}=W();return e(ze,{variant:$e.medium,title:u(a),isOpen:!0,onClose:t,children:l})},mt=a=>o(Pe,{isHorizontal:!0,className:"keycloak_eventsection_details",children:[a.details&&Object.entries(a.details).map(([t,l])=>o(M,{children:[e(H,{children:t}),e(j,{children:l})]},t)),a.error&&o(M,{children:[e(H,{children:"error"}),e(j,{children:a.error})]},"error")]}),ht=()=>{const{adminClient:a}=fe(),{t}=W(),{realm:l}=B(),u=Ke(),C=Ne(),z=u.enums?.resourceType,$=u.enums?.operationType,[E,Z]=m(0),[J,L]=m(!1),[Q,k]=m(!1),[X,q]=m(!1),[v,R]=m({}),[h,F]=m(),[y,U]=m(),Y={resourceTypes:t("resourceTypes"),operationTypes:t("operationTypes"),resourcePath:t("resourcePath"),dateFrom:t("dateFrom"),dateTo:t("dateTo"),authClient:t("client"),authUser:t("userId"),authRealm:t("realm"),authIpAddress:t("ipAddress")},O=ge({mode:"onChange",defaultValues:ye}),{getValues:N,reset:S,formState:{isDirty:V},control:A}=O;function ee(r,s){return a.realms.findAdminEvents({...v,realm:l,first:r,max:s})}function te(){L(!1),i()}function I(){S(),i()}function ae(r){const s={...N()};delete s[r],S({...ye,...s}),i()}function n(r,s){const c=N(),p=c[r],D=Array.isArray(p)?p.filter(we=>we!==s):p;S({...c,[r]:D}),i()}function i(){const r=De(N(),s=>s!==""||Array.isArray(s)&&s.length>0);R(r),Z(E+1)}const d=Ye(()=>y?.representation?Me(JSON.parse(y.representation)):"",[y?.representation]);return o(ie,{children:[h&&e(Te,{titleKey:"auth",onClose:()=>F(void 0),children:o(He,{"aria-label":"authData","data-testid":"auth-dialog",variant:je.compact,children:[e(Be,{children:o(P,{children:[e(ce,{children:t("attribute")}),e(ce,{children:t("value")})]})}),o(We,{children:[o(P,{children:[e(T,{children:t("realm")}),e(T,{children:h.authDetails?.realmId})]}),o(P,{children:[e(T,{children:t("client")}),e(T,{children:h.authDetails?.clientId})]}),o(P,{children:[e(T,{children:t("user")}),e(T,{children:h.authDetails?.userId})]}),o(P,{children:[e(T,{children:t("ipAddress")}),e(T,{children:h.authDetails?.ipAddress})]})]})]})}),y&&e(Te,{titleKey:"representation","data-testid":"representation-dialog",onClose:()=>U(void 0),children:e(rt,{isLineNumbersVisible:!0,isReadOnly:!0,code:d,language:st.json,height:"8rem"})}),e(Ce,{className:"keycloak__events_table",loader:ee,detailColumns:[{name:"details",enabled:r=>r.details!==void 0,cellRenderer:mt}],isPaginated:!0,ariaLabelKey:"adminEvents",toolbarItem:e(ke,{...O,children:o(Ae,{direction:{default:"column"},spaceItems:{default:"spaceItemsNone"},children:[e(x,{children:e(Oe,{buttonText:t("searchForAdminEvent"),setSearchDropdownOpen:L,searchDropdownOpen:J,marginRight:"2.5rem",width:"15vw",children:o(Ie,{isHorizontal:!0,className:"keycloak__events_search__form","data-testid":"searchForm",children:[e(_,{label:t("resourceTypes"),fieldId:"kc-resourceTypes",className:"keycloak__events_search__form_label",children:e(f,{name:"resourceTypes",control:A,render:({field:r})=>e(re,{className:"keycloak__events_search__type_select","data-testid":"resource-types-searchField",chipGroupProps:{numChips:1,expandedText:t("hide"),collapsedText:t("showRemaining")},variant:se.typeaheadMulti,typeAheadAriaLabel:"Select",onToggle:s=>k(s),selections:r.value,onSelect:s=>{const c=s.toString(),p=r.value.includes(c)?r.value.filter(D=>D!==c):[...r.value,c];r.onChange(p)},onClear:()=>{r.onChange([])},isOpen:Q,"aria-labelledby":"resourceTypes",chipGroupComponent:e(w,{children:r.value.map(s=>e(g,{onClick:c=>{c.stopPropagation(),r.onChange(r.value.filter(p=>p!==s))},children:s},s))}),children:z?.map(s=>e(ne,{value:s,children:s},s))})})}),e(_,{label:t("operationTypes"),fieldId:"kc-operationTypes",className:"keycloak__events_search__form_label",children:e(f,{name:"operationTypes",control:A,render:({field:r})=>e(re,{className:"keycloak__events_search__type_select","data-testid":"operation-types-searchField",chipGroupProps:{numChips:1,expandedText:t("hide"),collapsedText:t("showRemaining")},variant:se.typeaheadMulti,typeAheadAriaLabel:"Select",onToggle:s=>q(s),selections:r.value,onSelect:s=>{const c=s.toString(),p=r.value.includes(c)?r.value.filter(D=>D!==c):[...r.value,c];r.onChange(p)},onClear:()=>{r.onChange([])},isOpen:X,"aria-labelledby":"operationTypes",chipGroupComponent:e(w,{children:r.value.map(s=>e(g,{onClick:c=>{c.stopPropagation(),r.onChange(r.value.filter(p=>p!==s))},children:s},s))}),children:$?.map(s=>e(ne,{value:s,children:s},s.toString()))})})}),e(b,{name:"resourcePath",label:t("resourcePath")}),e(b,{name:"authRealm",label:t("realm")}),e(b,{name:"authClient",label:t("client")}),e(b,{name:"authUser",label:t("user")}),e(b,{name:"authIpAddress",label:t("ipAddress")}),e(_,{label:t("dateFrom"),fieldId:"kc-dateFrom",className:"keycloak__events_search__form_label",children:e(f,{name:"dateFrom",control:A,render:({field:r})=>e(K,{className:"pf-v5-u-w-100",value:r.value,onChange:(s,c)=>r.onChange(c),inputProps:{id:"kc-dateFrom"}})})}),e(_,{label:t("dateTo"),fieldId:"kc-dateTo",className:"keycloak__events_search__form_label",children:e(f,{name:"dateTo",control:A,render:({field:r})=>e(K,{className:"pf-v5-u-w-100",value:r.value,onChange:(s,c)=>r.onChange(c),inputProps:{id:"kc-dateTo"}})})}),o(Ee,{children:[e(G,{variant:"primary",onClick:te,"data-testid":"search-events-btn",isDisabled:!V,children:t("searchAdminEventsBtn")}),e(G,{variant:"secondary",onClick:I,isDisabled:!V,children:t("resetBtn")})]})]})})}),e(x,{children:Object.entries(v).length>0&&e("div",{className:"keycloak__searchChips pf-v5-u-ml-md",children:Object.entries(v).map(r=>{const[s,c]=r;return e(w,{className:"pf-v5-u-mt-md pf-v5-u-mr-md",categoryName:Y[s],isClosable:!0,onClick:()=>ae(s),children:typeof c=="string"?e(g,{isReadOnly:!0,children:c}):c.map(p=>e(g,{onClick:()=>n(s,p),children:p},p))},s)})})})]})}),actions:[{title:t("auth"),onRowClick:r=>F(r)},{title:t("representation"),onRowClick:r=>U(r)}],columns:[{name:"time",displayKey:"time",cellRenderer:r=>C(new Date(r.time),Se)},{name:"resourcePath",displayKey:"resourcePath",cellRenderer:pt},{name:"resourceType",displayKey:"resourceType"},{name:"operationType",displayKey:"operationType",transforms:[Re(10)]},{name:"",displayKey:"user",cellRenderer:r=>r.authDetails?.userId||""}],emptyState:e(Fe,{message:t("emptyAdminEvents"),instructions:t("emptyAdminEventsInstructions")}),isSearching:Object.keys(v).length>0},E)]})},be={client:"",dateFrom:"",dateTo:"",user:"",type:[],ipAddress:""},yt=a=>a.error?e(ve,{content:a.error,children:o("span",{children:[e(ue,{status:"warning",children:e(it,{})}),a.type]})}):o("span",{children:[e(ue,{status:"success",children:e(qe,{})}),a.type]}),Tt=a=>o(Pe,{isHorizontal:!0,className:"keycloak_eventsection_details",children:[a.details&&Object.entries(a.details).map(([t,l])=>o(M,{children:[e(H,{children:t}),e(j,{children:l})]},t)),a.error&&o(M,{children:[e(H,{children:"error"}),e(j,{children:a.error})]},"error")]}),bt=a=>{const{t}=W(),{realm:l}=B();return o(ie,{children:[a.userId&&e(oe,{to:_e({realm:l,id:a.userId,tab:"settings"}),children:a.userId},`link-${a.time}-${a.type}`),!a.userId&&t("noUserDetails")]})};function Qt(){const{adminClient:a}=fe(),{t}=W(),{realm:l}=B(),u=Ne(),[C,z]=m(0),[$,E]=m(!1),[Z,J]=m(!1),[L,Q]=m(),[k,X]=m({}),q={client:t("client"),dateFrom:t("dateFrom"),dateTo:t("dateTo"),user:t("userId"),type:t("eventType"),ipAddress:t("ipAddress")},v=ge({mode:"onChange",defaultValues:be}),{getValues:R,reset:h,formState:{isDirty:F},control:y,handleSubmit:U}=v;Ze(()=>a.realms.getConfigEvents({realm:l}),n=>Q(n),[]);function Y(n,i){return a.realms.findEvents({...k,realm:l,first:n,max:i})}const O=n=>tt(de({realm:l,tab:n})),N=O("user-events"),S=O("admin-events");function V(){E(!1),I()}function A(){h(),I()}function ee(n){const i={...R()};delete i[n],h({...be,...i}),I()}function te(n,i){const d=R(),r=d[n],s=Array.isArray(r)?r.filter(c=>c!==i):r;h({...d,[n]:s}),I()}function I(){const n=De(R(),i=>i!==""||Array.isArray(i)&&i.length>0);X(n),z(C+1)}const ae=()=>e(ke,{...v,children:o(Ae,{direction:{default:"column"},spaceItems:{default:"spaceItemsNone"},children:[e(x,{children:e(Oe,{buttonText:t("searchForUserEvent"),setSearchDropdownOpen:E,searchDropdownOpen:$,marginRight:"2.5rem",width:"15vw",children:o(Ie,{"data-testid":"searchForm",className:"keycloak__events_search__form",onSubmit:U(V),isHorizontal:!0,children:[e(b,{name:"user",label:t("userId"),"data-testid":"userId-searchField"}),e(_,{label:t("eventType"),fieldId:"kc-eventType",className:"keycloak__events_search__form_label",children:e(f,{name:"type",control:y,render:({field:n})=>e(re,{className:"keycloak__events_search__type_select","data-testid":"event-type-searchField",chipGroupProps:{numChips:1,expandedText:t("hide"),collapsedText:t("showRemaining")},variant:se.typeaheadMulti,typeAheadAriaLabel:"Select",onToggle:i=>J(i),selections:n.value,onSelect:i=>{const d=i.toString(),r=n.value.includes(d)?n.value.filter(s=>s!==d):[...n.value,d];n.onChange(r)},onClear:()=>{n.onChange([])},isOpen:Z,"aria-labelledby":"eventType",chipGroupComponent:e(w,{children:n.value.map(i=>e(g,{onClick:d=>{d.stopPropagation(),n.onChange(n.value.filter(r=>r!==i))},children:t(`eventTypes.${i}.name`)},i))}),children:L?.enabledEventTypes?.map(i=>e(ne,{value:i,children:t(`eventTypes.${i}.name`)},i))})})}),e(b,{name:"client",label:t("client"),"data-testid":"client-searchField"}),e(_,{label:t("dateFrom"),fieldId:"kc-dateFrom",className:"keycloak__events_search__form_label",children:e(f,{name:"dateFrom",control:y,render:({field:n})=>e(K,{className:"pf-v5-u-w-100",value:n.value,onChange:(i,d)=>n.onChange(d),inputProps:{id:"kc-dateFrom"}})})}),e(_,{label:t("dateTo"),fieldId:"kc-dateTo",className:"keycloak__events_search__form_label",children:e(f,{name:"dateTo",control:y,render:({field:n})=>e(K,{className:"pf-v5-u-w-100",value:n.value,onChange:(i,d)=>n.onChange(d),inputProps:{id:"kc-dateTo"}})})}),e(b,{name:"ipAddress",label:t("ipAddress"),"data-testid":"ipAddress-searchField"}),o(Ee,{children:[e(G,{"data-testid":"search-events-btn",variant:"primary",type:"submit",isDisabled:!F,children:t("searchUserEventsBtn")}),e(G,{variant:"secondary",onClick:A,isDisabled:!F,children:t("resetBtn")})]})]})})}),e(x,{children:Object.entries(k).length>0&&e("div",{className:"keycloak__searchChips pf-v5-u-ml-md",children:Object.entries(k).map(n=>{const[i,d]=n;return e(w,{className:"pf-v5-u-mt-md pf-v5-u-mr-md",categoryName:q[i],isClosable:!0,onClick:()=>ee(i),children:typeof d=="string"?e(g,{isReadOnly:!0,children:d}):d.map(r=>e(g,{onClick:()=>te(i,r),children:t(`eventTypes.${r}.name`)},r))},i)})})})]})});return o(ie,{children:[e(at,{titleKey:"titleEvents",subKey:o(nt,{i18nKey:"eventExplain",children:["If you want to configure user events, Admin events or Event listeners, please enter",e(oe,{to:Je({realm:l,tab:"events"}),children:t("eventConfig")}),"page realm settings to configure."]}),helpUrl:Qe.eventsUrl,divider:!1}),e(Xe,{variant:"light",className:"pf-v5-u-p-0",children:o(et,{isBox:!0,defaultLocation:de({realm:l,tab:"user-events"}),children:[e(pe,{title:e(me,{children:t("userEvents")}),...N,children:e("div",{className:"keycloak__events_table",children:e(Ce,{loader:Y,detailColumns:[{name:"details",enabled:n=>n.details!==void 0,cellRenderer:Tt}],isPaginated:!0,ariaLabelKey:"titleEvents",toolbarItem:ae(),columns:[{name:"time",displayKey:"time",cellRenderer:n=>u(new Date(n.time),Se)},{name:"userId",displayKey:"user",cellRenderer:bt},{name:"type",displayKey:"eventType",cellRenderer:yt},{name:"ipAddress",displayKey:"ipAddress",transforms:[Re(10)]},{name:"clientId",displayKey:"client"}],emptyState:e(Fe,{message:t("emptyUserEvents"),instructions:t("emptyUserEventsInstructions")}),isSearching:Object.keys(k).length>0},C)})}),e(pe,{title:e(me,{children:t("adminEvents")}),"data-testid":"admin-events-tab",...S,children:e(ht,{})})]})})]})}export{Qt as default};
//# sourceMappingURL=EventsSection-adj_uOe1.js.map
