import{jsx as a,jsxs as S,Fragment as B}from"react/jsx-runtime";import{u as H,j as $,b as G,d as U,a as Q,$ as R,C as z,B as J,p as V,fk as x,I as W,x as X,D as k,P as Y,m as Z,Q as v,J as _,K as ee,N as ae,c6 as te,c7 as re,ai as oe,A as ne,f as L,n as pe,o as se}from"./main-C047jAp3.js";import{useState as y}from"react";import{u as ie}from"./ConfirmDialog-d09hGFUk.js";import{c as de,D as le}from"./DynamicComponents-CCNvrlYx.js";import{F as ce}from"./FormAccess-CEFqBG2E.js";import{V as me}from"./ViewHeader-Y2Z8ln-o.js";import{u as ue}from"./useParams-6mfeCu18.js";import"react-dom";import"./ClientSelect-mboGti-R.js";import"./FileUpload-2t3HfN2b.js";import"./CodeEditor--AHMF_Ho.js";import"./copy-icon-D1BxihC2.js";import"./GroupPickerDialog-CRtxj-P-.js";import"./DataListItemRow-BUcm7LGX.js";import"./KeySelect-DvFB2tXI.js";import"./useToggle-K3Kx99tM.js";import"./MultiLineInput-lQlb7SN3.js";import"./AddRoleMappingModal-BqwO7G2x.js";import"./translationFormatter-CkqjPJdy.js";import"./useLocaleSort-O4LGWO8i.js";import"./filter-icon-BeqpAxqe.js";function Ee(){const{adminClient:l}=H(),p=$(),[i,M]=y(),[c,P]=y(),{id:f,mapperId:o}=ue(),m=G(),{realm:g}=U(),{t:e}=Q(),{addAlert:h,addError:T}=R(),[D,w]=y(!1),[C,K]=y(0),O=()=>K(C+1);z(async()=>{const r=await l.components.listSubComponents({id:f,type:"org.keycloak.storage.ldap.mappers.LDAPStorageMapper"});if(o&&o!=="new"){const t=await l.components.findOne({id:o});return{components:r,fetchedMapper:t}}return{components:r}},({components:r,fetchedMapper:t})=>{if(M(t),P(r),o!=="new"&&!t)throw new Error(e("notFound"));t&&b(t)},[]);const b=r=>{pe(r,p.setValue)},E=async r=>{const t=se(r),n={...t,config:Object.entries(t.config||{}).reduce((u,[q,I])=>(u[q]=Array.isArray(I)?I:[I],u),{})};try{o==="new"?(await l.components.create(n),m(x({realm:g,id:r.parentId,tab:"mappers"}))):await l.components.update({id:o},n),b(n),h(e(o==="new"?"mappingCreatedSuccess":"mappingUpdatedSuccess"),V.success)}catch(u){T(o==="new"?"mappingCreatedError":"mappingUpdatedError",u)}},F=async r=>{try{const t=await l.userStorageProvider.mappersSync({parentId:i?.parentId||"",id:o,direction:r});h(e("syncLDAPGroupsSuccessful",{result:t.status}))}catch(t){T("syncLDAPGroupsError",t)}O()},[j,N]=ie({titleKey:"deleteMappingTitle",messageKey:"deleteMappingConfirm",continueButtonLabel:"delete",continueButtonVariant:J.danger,onConfirm:async()=>{try{await l.components.del({id:i.id}),h(e("mappingDeletedSuccess"),V.success),m(x({id:f,realm:g,tab:"mappers"}))}catch(r){T("mappingDeletedError",r)}}}),A=W({control:p.control,name:"providerId"});if(!c)return a(X,{});const d=o==="new",s=c.find(r=>r.id===A);return S(B,{children:[a(N,{}),a(me,{titleKey:i?i.name:e("createNewMapper"),dropdownItems:d?void 0:[a(k,{onClick:j,children:e("delete")},"delete"),...s?.metadata.fedToKeycloakSyncSupported?[a(k,{onClick:()=>F("fedToKeycloak"),children:e(s.metadata.fedToKeycloakSyncMessage)},"fedSync")]:[],...s?.metadata.keycloakToFedSyncSupported?[a(k,{onClick:()=>{F("keycloakToFed")},children:e(s.metadata.keycloakToFedSyncMessage)},"ldapSync")]:[]]},C),a(Y,{variant:"light",isFilled:!0,children:a(Z,{...p,children:S(ce,{role:"manage-realm",isHorizontal:!0,onSubmit:p.handleSubmit(()=>E(p.getValues())),children:[!d&&a(v,{name:"id",label:e("id"),isDisabled:!0}),a(v,{name:"name",label:e("name"),labelIcon:e("mapperNameHelp"),isDisabled:!d,rules:{required:e("required")}}),a("input",{type:"hidden",defaultValue:d?f:i?i.parentId:"","data-testid":"ldap-mapper-parentId",...p.register("parentId")}),a("input",{type:"hidden",defaultValue:"org.keycloak.storage.ldap.mappers.LDAPStorageMapper","data-testid":"ldap-mapper-provider-type",...p.register("providerType")}),d?a(_,{label:e("mapperType"),labelIcon:a(ee,{helpText:s?.helpText?s.helpText:e("mapperTypeHelp"),fieldLabelId:"mapperType"}),fieldId:"kc-providerId",isRequired:!0,children:a(ae,{name:"providerId",defaultValue:"",control:p.control,"data-testid":"ldap-mapper-type-select",render:({field:r})=>a(te,{toggleId:"kc-providerId",typeAheadAriaLabel:e("mapperType"),onToggle:()=>w(!D),isOpen:D,onSelect:t=>{b({providerId:t,...Object.fromEntries(c.find(n=>n.id===t)?.properties.filter(n=>n.type==="List").map(n=>[de(n.name),n.options?.[0]])||[])}),w(!1)},selections:r.value,variant:re.typeahead,"aria-label":e("selectMapperType"),children:c.map(t=>a(oe,{value:t.id,children:t.id},t.id))})})}):a(v,{name:"providerId",label:e("mapperType"),labelIcon:s?.helpText?s.helpText:e("mapperTypeHelp"),rules:{required:e("required")},isDisabled:!d}),!!A&&a(le,{properties:s?.properties}),S(ne,{children:[a(L,{isDisabled:!p.formState.isDirty,variant:"primary",type:"submit","data-testid":"ldap-mapper-save",children:e("save")}),a(L,{variant:"link",onClick:()=>m(d?-1:`/${g}/user-federation/ldap/${i.parentId}/mappers`),"data-testid":"ldap-mapper-cancel",children:e("cancel")})]})]})})})]})}export{Ee as default};
//# sourceMappingURL=LdapMapperDetails-rSMraonC.js.map
