import{jsxs as m,Fragment as S,jsx as r}from"react/jsx-runtime";import{a as O,Q as F,W as B,J as L,K as N,N as j,c6 as k,c7 as E,ai as K,u as U,j as q,$ as H,b as $,d as G,B as Q,p as P,dL as I,C as W,x as z,P as J,D as R,m as X,A as Y,f as T,L as Z,o as _,dN as ee,n as re}from"./main-C047jAp3.js";import{useState as C}from"react";import{u as ae}from"./ConfirmDialog-d09hGFUk.js";import{D as te}from"./DynamicComponents-CCNvrlYx.js";import{F as ie}from"./FormAccess-CEFqBG2E.js";import{V as oe}from"./ViewHeader-Y2Z8ln-o.js";import{u as se,m as pe}from"./useLocaleSort-O4LGWO8i.js";import{u as ne}from"./useParams-6mfeCu18.js";import"react-dom";import"./ClientSelect-mboGti-R.js";import"./FileUpload-2t3HfN2b.js";import"./CodeEditor--AHMF_Ho.js";import"./copy-icon-D1BxihC2.js";import"./GroupPickerDialog-CRtxj-P-.js";import"./DataListItemRow-BUcm7LGX.js";import"./KeySelect-DvFB2tXI.js";import"./useToggle-K3Kx99tM.js";import"./MultiLineInput-lQlb7SN3.js";import"./AddRoleMappingModal-BqwO7G2x.js";import"./translationFormatter-CkqjPJdy.js";import"./filter-icon-BeqpAxqe.js";const de=({mapperTypes:p,mapperType:a,form:d,id:f,updateMapperType:u})=>{const{t:o}=O(),{control:M}=d,[g,l]=C(!1),t=["inherit","import","legacy","force"];return m(S,{children:[r(F,{name:"name",label:o("name"),labelIcon:o("addIdpMapperNameHelp"),readOnly:!!f,rules:{required:o("required")}}),r(B,{name:"config.syncMode",label:o("syncModeOverride"),labelIcon:o("syncModeOverrideHelp"),options:t.map(i=>({key:i.toUpperCase(),value:o(`syncModes.${i}`)})),controller:{defaultValue:t[0].toUpperCase()}}),r(L,{label:o("mapperType"),labelIcon:r(N,{helpText:a.helpText,fieldLabelId:"mapperType"}),fieldId:"identityProviderMapper",children:r(j,{name:"identityProviderMapper",defaultValue:p[0].id,control:M,render:({field:i})=>r(k,{toggleId:"identityProviderMapper","data-testid":"idp-mapper-select",isDisabled:!!f,onToggle:()=>l(!g),onSelect:e=>{const y=e;u(y),i.onChange(y.id),l(!1)},selections:a.name,variant:E.single,"aria-label":o("mapperType"),isOpen:g,children:p.map(e=>r(K,{selected:e===i.value,"datatest-id":e.id,value:e,children:e.name},e.name))})})})]})};function xe(){const{adminClient:p}=U(),{t:a}=O(),d=q({shouldUnregister:!0}),{handleSubmit:f}=d,{addAlert:u,addError:o}=H(),M=$(),g=se(),{realm:l}=G(),{id:t,providerId:i,alias:e}=ne(),[y,V]=C(),[v,h]=C(),A=async s=>{const b=_(s),c={...b,config:{...b.config},identityProviderAlias:e};if(t)try{await p.identityProviders.updateMapper({id:t,alias:e},{...c,id:t}),u(a("mapperSaveSuccess"),P.success)}catch(n){o("mapperSaveError",n)}else try{const n=await p.identityProviders.createMapper({identityProviderMapper:c,alias:e});u(a("mapperCreateSuccess"),P.success),M(ee({realm:l,alias:e,providerId:i,id:n.id}))}catch(n){o("mapperCreateError",n)}},[D,w]=ae({titleKey:"deleteProviderMapper",messageKey:a("deleteMapperConfirm",{mapper:v?.name}),continueButtonLabel:"delete",continueButtonVariant:Q.danger,onConfirm:async()=>{try{await p.identityProviders.delMapper({alias:e,id:t}),u(a("deleteMapperSuccess"),P.success),M(I({providerId:i,alias:e,tab:"mappers",realm:l}))}catch(s){o("deleteErrorIdentityProvider",s)}}});W(()=>Promise.all([t?p.identityProviders.findOneMapper({alias:e,id:t}):null,p.identityProviders.findMapperTypes({alias:e})]),([s,b])=>{const c=g(Object.values(b),pe("name"));s?(h(c.find(({id:n})=>n===s.identityProviderMapper)),x(s)):h(c[0]),V(c)},[t]);const x=s=>{re(s,d.setValue)};return!y||!v?r(z,{}):m(J,{variant:"light",children:[r(w,{}),r(oe,{className:"kc-add-mapper-title",titleKey:t?a("editIdPMapper",{providerId:i[0].toUpperCase()+i.substring(1)}):a("addIdPMapper",{providerId:i[0].toUpperCase()+i.substring(1)}),dropdownItems:t?[r(R,{onClick:D,children:a("delete")},"delete")]:void 0,divider:!0}),m(ie,{role:"manage-identity-providers",isHorizontal:!0,onSubmit:f(A),className:"pf-v5-u-mt-lg",children:[m(X,{...d,children:[t&&r(F,{name:"id",label:a("id"),readOnly:!0,rules:{required:a("required")}}),v.properties&&m(S,{children:[r(de,{form:d,id:t,mapperTypes:y,updateMapperType:h,mapperType:v}),r(te,{properties:v.properties})]})]}),m(Y,{children:[r(T,{"data-testid":"new-mapper-save-button",variant:"primary",type:"submit",children:a("save")}),r(T,{"data-testid":"new-mapper-cancel-button",variant:"link",component:s=>r(Z,{...s,to:I({realm:l,providerId:i,alias:e,tab:"mappers"})}),children:a("cancel")})]})]})]})}export{xe as default};
//# sourceMappingURL=AddMapper-BdiLghwf.js.map
