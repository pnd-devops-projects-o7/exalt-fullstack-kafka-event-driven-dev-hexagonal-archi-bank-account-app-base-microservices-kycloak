import{jsxs as u,Fragment as M,jsx as o}from"react/jsx-runtime";import{u as R,a as X,b as q,$ as Q,e as U,j as W,C as Y,P as Z,J as _,K as k,N as ee,c6 as te,c7 as oe,ai as re,m as ce,A as ae,f as g,L as V,eX as h,p as ie}from"./main-C047jAp3.js";import{useState as l}from"react";import{D as se}from"./DynamicComponents-CCNvrlYx.js";import{F as ne}from"./FormAccess-CEFqBG2E.js";import{V as le}from"./ViewHeader-Y2Z8ln-o.js";import{u as C}from"./useParams-6mfeCu18.js";import"react-dom";import"./ClientSelect-mboGti-R.js";import"./FileUpload-2t3HfN2b.js";import"./CodeEditor--AHMF_Ho.js";import"./copy-icon-D1BxihC2.js";import"./GroupPickerDialog-CRtxj-P-.js";import"./DataListItemRow-BUcm7LGX.js";import"./KeySelect-DvFB2tXI.js";import"./useToggle-K3Kx99tM.js";import"./MultiLineInput-lQlb7SN3.js";import"./AddRoleMappingModal-BqwO7G2x.js";import"./translationFormatter-CkqjPJdy.js";import"./useLocaleSort-O4LGWO8i.js";import"./ConfirmDialog-d09hGFUk.js";import"./filter-icon-BeqpAxqe.js";const F={config:{},executor:""};function Oe(){const{adminClient:P}=R(),{t:a}=X(),I=q(),{realm:d,profileName:s}=C(),{executorName:n}=C(),{addAlert:A,addError:N}=Q(),[H,T]=l(!1),p=U().componentTypes?.["org.keycloak.services.clientpolicy.executor.ClientPolicyExecutorProvider"],[m,O]=l([]),[D,G]=l([]),[v,L]=l([]),[j,B]=l([]),f=W({defaultValues:F}),{control:$,reset:y,handleSubmit:w}=f,c=!!n,E=e=>{const r=e.find(i=>i.name===s)?.executors?.find(i=>i.executor===n);r&&y({config:r.configuration})};Y(()=>P.clientPolicies.listProfiles({includeGlobalProfiles:!0}),e=>{L(e.globalProfiles),B(e.profiles),E(e.profiles),E(e.globalProfiles)},[]);const K=async()=>{const e=f.getValues(),t=j.map(r=>{if(r.name!==s)return r;const i=(r.executors??[]).concat({executor:e.executor,configuration:e.config||{}});if(c){const S=r.executors.find(J=>J.executor===n);S.configuration={...S.configuration,...e.config}}return c?r:{...r,executors:i}});try{await P.clientPolicies.createProfiles({profiles:t,globalProfiles:v}),A(a(c?"updateExecutorSuccess":"addExecutorSuccess"),ie.success),I(h({realm:d,profileName:s}))}catch(r){N(c?"updateExecutorError":"addExecutorError",r)}},x=v.find(e=>e.name===s),b=p?.find(e=>e.id===n),z=b?.properties.map(e=>{const t=c?e.defaultValue:"";return{...e,defaultValue:t}});return u(M,{children:[o(le,{titleKey:c?n:a("addExecutor"),divider:!0}),u(Z,{variant:"light",children:[u(ne,{isHorizontal:!0,role:"manage-realm",className:"pf-v5-u-mt-lg",isReadOnly:!!x,children:[o(_,{label:a("executorType"),fieldId:"kc-executorType",labelIcon:m.length>0&&m[0].helpText!==""?o(k,{helpText:m[0].helpText,fieldLabelId:"executorTypeHelpText"}):c?o(k,{helpText:b?.helpText,fieldLabelId:"executorTypeHelpText"}):void 0,children:o(ee,{name:"executor",defaultValue:"",control:$,render:({field:e})=>o(te,{toggleId:"kc-executor",placeholderText:"Select an executor",onToggle:t=>T(t),onSelect:t=>{y({...F,executor:t.toString()});const r=p?.filter(i=>i.id===t);O(r??[]),G(r?.[0].properties??[]),T(!1)},selections:c?n:e.value,variant:oe.single,"data-testid":"executorType-select","aria-label":a("executorType"),isOpen:H,maxHeight:580,isDisabled:c,children:p?.map(t=>o(re,{selected:t.id===e.value,value:t.id,description:t.helpText,children:t.id},t.id))})})}),o(ce,{...f,children:o(se,{properties:c?z:D})}),!x&&u(ae,{children:[o(g,{variant:"primary",onClick:()=>w(K)(),"data-testid":"addExecutor-saveBtn",children:a(c?"save":"add")}),o(g,{variant:"link",component:e=>o(V,{...e,to:h({realm:d,profileName:s})}),"data-testid":"addExecutor-cancelBtn",children:a("cancel")})]})]}),c&&x&&o("div",{className:"kc-backToProfile",children:o(g,{component:e=>o(V,{...e,to:h({realm:d,profileName:s})}),variant:"primary",children:a("back")})})]})]})}export{Oe as default};
//# sourceMappingURL=ExecutorForm-UxsjBaAa.js.map
