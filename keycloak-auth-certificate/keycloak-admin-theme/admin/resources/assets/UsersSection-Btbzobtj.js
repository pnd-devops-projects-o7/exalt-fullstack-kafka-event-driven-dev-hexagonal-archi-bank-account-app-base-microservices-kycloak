import{jsx as e,jsxs as l,Fragment as v}from"react/jsx-runtime";import{V as Ce}from"./ViewHeader-Y2Z8ln-o.js";import{a as D,bl as me,ag as he,bm as be,D as W,$ as pe,j as Ue,fA as Te,E as z,G as L,H as M,bs as xe,cd as fe,ce as H,a0 as ne,f as w,f2 as Ne,N as Se,cW as De,A as Ie,B as J,p as q,c6 as Fe,c7 as Ee,ai as we,db as ie,b_ as ge,T as E,bv as Ke,dC as Pe,fB as Ve,u as Re,d as X,b as Oe,C as _e,x as Be,S as Le,a5 as qe,a6 as Ge,a8 as $e,k as je,bx as Q,L as Me,cA as We,bk as ye,ao as le,cz as ze,bK as He,fC as Qe,fD as Je,aw as Xe,U as Ye,V as Ze,bC as et,bD as tt,ak as rt,P as at,eu as oe}from"./main-C047jAp3.js";import{P as st}from"./PermissionTab-D1RTtpaA.js";import{useState as p}from"react";import{u as ce}from"./ConfirmDialog-d09hGFUk.js";import{a as nt}from"./AddRoleMappingModal-BqwO7G2x.js";import{F as it}from"./filter-icon-BeqpAxqe.js";import{D as lt}from"./DropdownPanel-BZ5vtrQT.js";import{W as Ae}from"./warning-triangle-icon-CIFXPQ_1.js";import{R as ot,u as ct}from"./RoutableTabs-BpMBzAU0.js";/* empty css                     */import{a as ue,b as de}from"./Tabs-Dt-AxIu8.js";import"react-dom";import"./useLocaleSort-O4LGWO8i.js";import"./Trans-C8a1WrTl.js";import"./translationFormatter-CkqjPJdy.js";import"./PageHandler-BsZt2gxJ.js";import"./DynamicComponents-CCNvrlYx.js";import"./ClientSelect-mboGti-R.js";import"./FileUpload-2t3HfN2b.js";import"./CodeEditor--AHMF_Ho.js";import"./copy-icon-D1BxihC2.js";import"./GroupPickerDialog-CRtxj-P-.js";import"./DataListItemRow-BUcm7LGX.js";import"./KeySelect-DvFB2tXI.js";import"./useToggle-K3Kx99tM.js";import"./MultiLineInput-lQlb7SN3.js";import"./useParams-6mfeCu18.js";import"./constants-BclHbWtx.js";const ut=({searchType:r,onSelect:a})=>{const{t:c}=D(),[m,b]=p(!1),s=i=>e(W,{onClick:()=>{a(i),b(!1)},children:c(`searchType.${i}`)},i),y=[s("default"),s("attribute")];return e(me,{className:"keycloak__users__searchtype",onOpenChange:i=>b(i),toggle:i=>e(he,{"data-testid":"user-search-toggle",ref:i,id:"toggle-id",onClick:()=>b(!m),icon:e(it,{}),children:c(`searchType.${r}`)}),isOpen:m,children:e(be,{children:y})})};function dt({activeFilters:r,setActiveFilters:a,profile:c,createAttributeSearchChips:m,searchUserWithAttributes:b}){const{t:s}=D(),{addAlert:y}=pe(),[i,x]=p(!1),I={name:"",displayName:"",value:""},{getValues:o,register:k,reset:N,formState:{errors:h},setValue:K,setError:S,clearErrors:V,control:u}=Ue({mode:"onChange",defaultValues:I}),d=()=>r.userAttribute.some(t=>t.name===o().name),C=()=>{let t=!1;return o().name.length?r.userAttribute.some(A=>A.name===o().name)?S("name",{type:"conflict",message:s("searchUserByAttributeKeyAlreadyInUseError")}):t=!0:S("name",{type:"empty",message:s("searchUserByAttributeMissingKeyError")}),t},U=()=>{let t=!1;return o().value.length?t=!0:S("value",{type:"empty",message:s("searchUserByAttributeMissingValueError")}),t},R=()=>C()&&U(),T=()=>{R()?(a({exact:o().exact,userAttribute:[...r.userAttribute,{...o()}]}),N({exact:o().exact})):(h.name?.message&&y(h.name.message,q.danger),h.value?.message&&y(h.value.message,q.danger))},P=()=>{const t=[...r.userAttribute].filter(A=>A.name!==A.name);a({exact:o().exact,userAttribute:t})},O=()=>c?e(Fe,{"data-testid":"search-attribute-name-select",variant:Ee.typeahead,onToggle:t=>x(t),selections:o().displayName,onSelect:t=>{K("displayName",t.toString()),d()?S("name",{type:"conflict"}):V("name")},isOpen:i,placeholderText:s("selectAttribute"),validated:h.name&&"error",maxHeight:300,...k("displayName",{required:!0,validate:C}),children:c.attributes?.map(t=>e(we,{value:ie(s,t.displayName,t.name),onClick:A=>{A.stopPropagation(),x(!1),K("name",t.name)},children:ie(s,t.displayName,t.name)},t.name))}):e(ne,{id:"name",placeholder:s("keyPlaceholder"),validated:h.name&&"error",onKeyDown:t=>t.key==="Enter"&&T(),...k("name",{required:!0,validate:C})});return l(Te,{className:"user-attribute-search-form","data-testid":"user-attribute-search-form",children:[e(z,{className:"user-attribute-search-form-headline",children:e(L,{component:M.h2,children:s("selectAttributes")})}),e(xe,{isInline:!0,className:"user-attribute-search-form-alert",variant:"info",title:s("searchUserByAttributeDescription"),component:"h3"}),l(z,{className:"user-attribute-search-form-key-value",children:[e("div",{className:"user-attribute-search-form-left",children:e(L,{component:M.h3,children:s("key")})}),e("div",{className:"user-attribute-search-form-right",children:e(L,{component:M.h3,children:s("value")})})]}),e("div",{className:"user-attribute-search-form-left",children:O()}),e("div",{className:"user-attribute-search-form-right",children:l(fe,{children:[e(H,{children:e(ne,{id:"value",placeholder:s("valuePlaceholder"),validated:h.value&&"error",onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),T())},...k("value",{required:!0,validate:U})})}),e(H,{children:e(w,{"data-testid":"user-attribute-search-add-filter-button",variant:"control",icon:e(Ne,{}),onClick:T,"aria-label":s("addToFilter")})})]})}),m(),e("div",{className:"pf-v5-u-pt-lg",children:e(Se,{name:"exact",defaultValue:!1,control:u,render:({field:t})=>e(De,{id:"exact","data-testid":"exact",label:s("exactSearch"),isChecked:t.value,onChange:t.onChange})})}),l(Ie,{className:"user-attribute-search-form-action-group",children:[e(w,{"data-testid":"search-user-attribute-btn",variant:"primary",type:"submit",isDisabled:!r.userAttribute.length,onClick:b,children:s("search")}),e(w,{variant:J.link,onClick:()=>{N(),P()},children:s("reset")})]})]})}function mt({searchDropdownOpen:r,setSearchDropdownOpen:a,realm:c,hasSelectedRows:m,toggleDeleteDialog:b,toggleUnlockUsersDialog:s,goToCreate:y,searchType:i,setSearchType:x,searchUser:I,setSearchUser:o,activeFilters:k,setActiveFilters:N,refresh:h,profile:K,clearAllFilters:S,createAttributeSearchChips:V,searchUserWithAttributes:u}){const{t:d}=D(),[C,U]=p(!1),{hasAccess:R}=ge(),T=R("query-users"),P=()=>e(E,{children:l(fe,{children:[e(H,{children:e(ut,{searchType:i,onSelect:f=>{S(),x(f)}})}),i==="default"&&O(),i==="attribute"&&t()]})}),O=()=>e(E,{children:e(Pe,{"data-testid":"table-search-input",placeholder:d("searchForUser"),"aria-label":d("search"),value:I,onSearch:(f,_,$)=>{o($.haswords),h()},onKeyDown:f=>{if(f.key==="Enter"){const _=f.target;o(_.value),h()}},onClear:()=>{o(""),h()}})}),t=()=>l(v,{children:[e(lt,{"data-testid":"select-attributes-dropdown",buttonText:d("selectAttributes"),setSearchDropdownOpen:a,searchDropdownOpen:r,width:"15vw",children:e(dt,{activeFilters:k,setActiveFilters:N,profile:K,createAttributeSearchChips:V,searchUserWithAttributes:()=>{u(),a(!1)}})}),e(w,{icon:e(Ve,{}),variant:"control",onClick:()=>{u(),a(!1)},"aria-label":d("searchAttributes")})]}),A=c.bruteForceProtected?e(E,{children:e(me,{onOpenChange:f=>U(f),toggle:f=>e(he,{ref:f,isExpanded:C,variant:"plain",onClick:()=>U(!C),children:e(Ke,{})}),isOpen:C,shouldFocusToggleOnSelect:!0,children:l(be,{children:[e(W,{component:"button",isDisabled:m,onClick:()=>{b(),U(!1)},children:d("deleteUser")},"deleteUser"),e(W,{component:"button",onClick:()=>{s(),U(!1)},children:d("unlockAllUsers")},"unlock")]})})}):e(E,{children:e(w,{variant:J.link,onClick:b,"data-testid":"delete-user-btn",isDisabled:m,children:d("deleteUser")})}),G=l(v,{children:[e(E,{children:e(w,{"data-testid":"add-user",onClick:y,children:d("addUser")})}),A]});return l(v,{children:[P(),T?G:null]})}const ht=r=>{const{t:a}=D(),{realm:c}=X();return l(v,{children:[l(Me,{to:We({realm:c,id:r.id,tab:"settings"}),children:[r.username,e(bt,{user:r})]}),r.attributes?.is_temporary_admin[0]==="true"&&e(ye,{content:a("temporaryAdmin"),children:e(Ae,{className:"pf-v5-u-ml-sm",id:"temporary-admin-label"})})]})},bt=({user:r})=>{const{t:a}=D();return l(v,{children:[!r.enabled&&e(le,{color:"red",icon:e(ze,{}),children:a("disabled")}),r.bruteForceStatus?.disabled&&e(le,{color:"orange",icon:e(Ae,{}),children:a("temporaryLocked")})]})},pt=r=>{const{t:a}=D();return l(v,{children:[!r.emailVerified&&e(ye,{content:a("notVerified"),children:e(He,{className:"keycloak__user-section__email-verified"})})," ",Q()(r.email)]})};function ft(){const{adminClient:r}=Re(),{t:a}=D(),{addAlert:c,addError:m}=pe(),{realm:b,realmRepresentation:s}=X(),y=Oe(),[i,x]=p({}),[I,o]=p(""),[k,N]=p([]),[h,K]=p("default"),[S,V]=p(!1),[u,d]=p({exact:!1,userAttribute:[]}),[C,U]=p({}),[R,T]=p(""),[P,O]=p(0),t=()=>O(P+1);_e(async()=>{try{return await Promise.all([Qe(r),r.users.getProfile()])}catch{return[{},{}]}},([n,g])=>{x(n),U(g)},[]);const A=async(n,g,ae)=>{const F={first:n,max:g,q:R,exact:u.exact},B=ae||I||"";if(B&&(F.search=B),!Z&&!(F.search||F.q))return[];try{return await nt(r,{briefRepresentation:!0,...F})}catch(se){return i.userProfileProvidersEnabled?m("noUsersFoundErrorStorage",se):m("noUsersFoundError",se),[]}},[G,f]=ce({titleKey:"unlockAllUsers",messageKey:"unlockUsersConfirm",continueButtonLabel:"unlock",onConfirm:async()=>{try{await r.attackDetection.delAll(),t(),c(a("unlockUsersSuccess"),q.success)}catch(n){m("unlockUsersError",n)}}}),[_,$]=ce({titleKey:"deleteConfirmUsers",messageKey:a("deleteConfirmDialog",{count:k.length}),continueButtonLabel:"delete",continueButtonVariant:J.danger,onConfirm:async()=>{try{for(const n of k)await r.users.del({id:n.id});N([]),j(),c(a("userDeletedSuccess"),q.success)}catch(n){m("userDeletedError",n)}}}),Y=()=>y(Je({realm:b}));if(!i||!s)return e(Be,{});const Z=!i.userProfileProvidersEnabled,j=()=>{d({exact:!1,userAttribute:[]}),o(""),T(""),t()},ee=n=>n.userAttribute.map(g=>`${g.name}:${g.value}`).join(" "),ve=()=>{const n=ee(u);T(n),t()},te=()=>e(Xe,{children:u.userAttribute.length>0&&e(v,{children:Object.values(u.userAttribute).map(n=>e(Ye,{className:"pf-v5-u-mt-md pf-v5-u-mr-md","data-testid":"user-attribute-search-chips-group",categoryName:n.displayName.length?n.displayName:n.name,isClosable:!0,onClick:g=>{g.stopPropagation();const F={userAttribute:[...u.userAttribute].filter(B=>B.name!==n.name),exact:u.exact};d(F),T(ee(F)),t()},children:e(Ze,{isReadOnly:!0,children:n.value},n.name)},n.name))})}),re=()=>e(mt,{searchDropdownOpen:S,setSearchDropdownOpen:V,realm:s,hasSelectedRows:k.length===0,toggleDeleteDialog:_,toggleUnlockUsersDialog:G,goToCreate:Y,searchType:h,setSearchType:K,searchUser:I,setSearchUser:o,activeFilters:u,setActiveFilters:d,refresh:t,profile:C,clearAllFilters:j,createAttributeSearchChips:te,searchUserWithAttributes:ve}),ke=()=>{if(u.userAttribute.length)return l("div",{className:"user-attribute-search-form-subtoolbar",children:[e(E,{children:te()}),e(E,{children:e(w,{variant:"link",onClick:()=>{j()},children:a("clearAllFilters")})})]})};return l(v,{children:[e($,{}),e(f,{}),e(Le,{isSearching:I!==""||u.userAttribute.length!==0,loader:A,isPaginated:!0,ariaLabelKey:"titleUsers",canSelectAll:!0,onSelect:n=>N([...n]),emptyState:Z?e(je,{message:a("noUsersFound"),instructions:a("emptyInstructions"),primaryActionText:a("createNewUser"),onPrimaryAction:Y}):l(v,{children:[e(qe,{children:e(Ge,{children:re()})}),e($e,{"data-testid":"empty-state",variant:"lg",children:e(z,{className:"kc-search-users-text",children:e(L,{children:a("searchForUserDescription")})})})]}),toolbarItem:re(),subToolbar:ke(),actionResolver:n=>{const g=n.data;return g.access?.manage?[{title:a("delete"),onClick:()=>{N([g]),_()}}]:[]},columns:[{name:"username",displayKey:"username",cellRenderer:ht},{name:"email",displayKey:"email",cellRenderer:pt},{name:"lastName",displayKey:"lastName",cellFormatters:[Q()]},{name:"firstName",displayKey:"firstName",cellFormatters:[Q()]}]},P)]})}function zt(){const{t:r}=D(),{realm:a}=X(),{hasAccess:c}=ge(),b=et()(tt.AdminFineGrainedAuthz)&&c("manage-authorization","manage-users","manage-clients"),s=x=>ct(oe({realm:a,tab:x})),y=s("list"),i=s("permissions");return l(v,{children:[e(Ce,{titleKey:"titleUsers",subKey:"usersExplain",helpUrl:rt.usersUrl,divider:!1}),e(at,{"data-testid":"users-page",variant:"light",className:"pf-v5-u-p-0",children:l(ot,{"data-testid":"user-tabs",defaultLocation:oe({realm:a,tab:"list"}),isBox:!0,mountOnEnter:!0,children:[e(ue,{id:"list","data-testid":"listTab",title:e(de,{children:r("userList")}),...y,children:e(ft,{})}),b&&e(ue,{id:"permissions","data-testid":"permissionsTab",title:e(de,{children:r("permissions")}),...i,children:e(st,{type:"users"})})]})})]})}export{zt as default};
//# sourceMappingURL=UsersSection-Btbzobtj.js.map
