import{jsx as e,jsxs as c,Fragment as L}from"react/jsx-runtime";import{a as w,J as N,cx as ae,cy as B,u as ge,d as ye,Y as F,I as $,C as U,x as Ie,m as te,K as P,a0 as ce,a4 as we,bs as De,f as O,W as xe,a7 as X,R as z,N as j,c6 as Z,c7 as ue,ai as ee,q as Re,cW as me,e as ve,j as fe,M as Pe,l as Ee,F as Te,B as Le,ab as Oe,c0 as He,c1 as Ge,c2 as pe,c3 as Y,c4 as Me,c5 as Q,G as We,H as ze,b as $e,$ as je,P as Be,bY as Ke,L as Ue,f7 as ke,f1 as Fe,p as _e,n as Je,ff as Ye}from"./main-C047jAp3.js";import{useState as T,useEffect as Ne,useMemo as Qe}from"react";import{F as ne,a as Xe}from"./FormAccess-CEFqBG2E.js";import{V as Ze}from"./ViewHeader-Y2Z8ln-o.js";import{u as ea}from"./useLocale-D_QRvci7.js";import{u as le}from"./useParams-6mfeCu18.js";/* empty css                               */import{U as aa}from"./UserProfileContext-DnL-Q4sd.js";import{K as ta}from"./KeyValueInput-B35agFBw.js";import{D as na}from"./SwitchControl-87mhceN2.js";import{u as ie}from"./useToggle-K3Kx99tM.js";import{u as la}from"./ConfirmDialog-d09hGFUk.js";import{D as ia}from"./DynamicComponents-CCNvrlYx.js";import{A as ra,G as sa}from"./AddTranslationsDialog-CR9Cxwfn.js";import{i as oa}from"./isEqual-deZv8OsO.js";import"react-dom";import"./copy-icon-D1BxihC2.js";import"./KeySelect-DvFB2tXI.js";import"./ClientSelect-mboGti-R.js";import"./FileUpload-2t3HfN2b.js";import"./CodeEditor--AHMF_Ho.js";import"./GroupPickerDialog-CRtxj-P-.js";import"./DataListItemRow-BUcm7LGX.js";import"./MultiLineInput-lQlb7SN3.js";import"./AddRoleMappingModal-BqwO7G2x.js";import"./translationFormatter-CkqjPJdy.js";import"./useLocaleSort-O4LGWO8i.js";import"./filter-icon-BeqpAxqe.js";const da=()=>{const{t}=w();return e(ne,{role:"manage-realm",isHorizontal:!0,children:e(N,{hasNoPaddingTop:!0,label:t("annotations"),fieldId:"kc-annotations",className:"kc-annotations-label",children:e(ae,{className:"kc-annotations",children:e(B,{children:e(ta,{name:"annotations",label:t("annotations"),defaultKeyValue:[{key:"inputType",label:t("inputType"),values:["text","textarea","select","select-radiobuttons","multiselect","multiselect-checkboxes","html5-email","html5-tel","html5-url","html5-number","html5-range","html5-datetime-local","html5-date","html5-month","html5-week","html5-time"]},{key:"inputHelperTextBefore",label:t("inputHelperTextBefore")},{key:"inputHelperTextAfter",label:t("inputHelperTextAfter")},{key:"inputOptionLabelsI18nPrefix",label:t("inputOptionLabelsI18nPrefix")},{key:"inputTypePlaceholder",label:t("inputTypePlaceholder")},{key:"inputTypeSize",label:t("inputTypeSize")},{key:"inputTypeCols",label:t("inputTypeCols")},{key:"inputTypeRows",label:t("inputTypeRows")},{key:"inputTypeStep",label:t("inputTypeStep")},{key:"kcNumberFormat",label:t("kcNumberFormat")},{key:"kcNumberUnFormat",label:t("kcNumberUnFormat")}]})})})})})},he=[{label:"requiredForLabel.both",value:["admin","user"]},{label:"requiredForLabel.users",value:["user"]},{label:"requiredForLabel.admins",value:["admin"]}],ca=({onHandlingTranslationData:t,onHandlingGeneratedDisplayName:u})=>{const{adminClient:d}=ge(),{t:a}=w(),{realmRepresentation:n}=ye(),l=F(),[h,f]=T(),[C,s]=T(),[b,H]=T(!1),[v,V]=T(!1),[E,G]=ie(),{attributeName:M}=le(),x=!!M,[W,g]=T(""),[m,i]=T(""),[A,S]=T(),[k,D]=T({key:"",translations:[]}),p=/\$\{([^}]+)\}/,y=(r,o)=>{g(o);const q=o!==""&&n?.internationalizationEnabled?`\${profile.attributes.${o}}`:"";i(q)},I=$({control:l.control,name:"hasSelector"}),_=$({control:l.control,name:"hasRequiredScopes"}),Ce=$({control:l.control,name:"isRequired",defaultValue:!1}),K=$({control:l.control,name:"displayName"}),qe=p.test(K);U(()=>d.clientScopes.find(),f,[]),U(()=>d.users.getProfile(),s,[]);const re=r=>{t(r)},se=r=>{u(r)};if(Ne(()=>{re(k),se(m)},[k,m]),!h)return e(Ie,{});function oe(r){l.setValue("hasSelector",r)}function de(r){l.setValue("hasRequiredScopes",r)}const Ve=r=>{D(r)},Se=()=>{G(),re(k),se(m)},Ae=K?.substring(2,K.length-1);return c(L,{children:[E&&e(ra,{translationKey:x?Ae:`profile.attributes.${W}`,translations:k,type:A??"displayName",onTranslationsAdded:Ve,toggleDialog:Se,onCancel:()=>{G()}}),e(ne,{role:"manage-realm",isHorizontal:!0,children:c(te,{...l,children:[c(N,{label:a("attributeName"),labelIcon:e(P,{helpText:a("upAttributeNameHelp"),fieldLabelId:"attributeName"}),fieldId:"kc-attribute-name",isRequired:!0,children:[e(ce,{isRequired:!0,id:"kc-attribute-name",defaultValue:"","data-testid":"attribute-name",isDisabled:x,validated:l.formState.errors.name?"error":"default",...l.register("name",{required:!0}),onChange:y}),l.formState.errors.name&&e(we,{message:a("validateAttributeName")})]}),e(N,{label:a("attributeDisplayName"),labelIcon:e(P,{helpText:a("attributeDisplayNameHelp"),fieldLabelId:"attributeDisplayName"}),fieldId:"kc-attribute-display-name",children:c(ae,{hasGutter:!0,children:[c(B,{span:n?.internationalizationEnabled?11:12,children:[e(ce,{id:"kc-attribute-display-name","data-testid":"attribute-display-name",isDisabled:n?.internationalizationEnabled&&W!==""||x&&qe,value:x?K:n?.internationalizationEnabled?m:void 0,...l.register("displayName")}),m&&e(De,{className:"pf-v5-u-mt-sm",variant:"info",isInline:!0,isPlain:!0,title:a("addAttributeTranslationInfo")})]}),n?.internationalizationEnabled&&e(B,{span:1,children:e(O,{variant:"link",className:"pf-m-plain kc-attribute-display-name-iconBtn","data-testid":"addAttributeTranslationBtn","aria-label":a("addAttributeTranslationBtn"),isDisabled:!W&&!x,onClick:()=>{S("displayName"),G()},icon:e(sa,{})})})]})}),e(na,{name:"multivalued",label:a("multivalued"),labelIcon:a("multivaluedHelp")}),e(xe,{name:"group",label:a("attributeGroup"),labelIcon:a("attributeGroupHelp"),controller:{defaultValue:""},options:[{key:"",value:a("none")},...C?.groups?.map(r=>({key:r.name,value:r.name}))||[]]}),!ba.includes(M)&&c(L,{children:[e(X,{}),c(N,{label:a("enabledWhen"),labelIcon:e(P,{helpText:a("enabledWhenTooltip"),fieldLabelId:"enabled-when"}),fieldId:"enabledWhen",hasNoPaddingTop:!0,children:[e(z,{id:"always","data-testid":"always",isChecked:!I,name:"enabledWhen",label:a("always"),onChange:()=>oe(!1),className:"pf-v5-u-mb-md"}),e(z,{id:"scopesAsRequested","data-testid":"scopesAsRequested",isChecked:I,name:"enabledWhen",label:a("scopesAsRequested"),onChange:()=>oe(!0),className:"pf-v5-u-mb-md"})]}),I&&e(N,{fieldId:"kc-scope-enabled-when",children:e(j,{name:"selector.scopes",control:l.control,defaultValue:[],render:({field:r})=>e(Z,{"data-testid":"enabled-when-scope-field",variant:ue.typeaheadMulti,typeAheadAriaLabel:"Select",chipGroupProps:{numChips:3,expandedText:a("hide"),collapsedText:a("showRemaining")},onToggle:o=>H(o),selections:r.value,onSelect:o=>{const q=o.toString();let R=[""];r.value?R=r.value.includes(q)?r.value.filter(J=>J!==q):[...r.value,q]:R=[q],r.onChange(R)},onClear:()=>{r.onChange([])},isOpen:b,"aria-labelledby":"scope",children:h.map(o=>e(ee,{value:o.name,children:o.name},o.name))})})})]}),M!=="username"&&c(L,{children:[e(X,{}),e(N,{label:a("required"),labelIcon:e(P,{helpText:a("requiredHelp"),fieldLabelId:"required"}),fieldId:"kc-required",hasNoPaddingTop:!0,children:e(j,{name:"isRequired","data-testid":"required",defaultValue:!1,control:l.control,render:({field:r})=>e(Re,{id:"kc-required",onChange:r.onChange,isChecked:r.value,label:a("on"),labelOff:a("off"),"aria-label":a("required")})})}),Ce&&c(L,{children:[e(N,{label:a("requiredFor"),fieldId:"requiredFor",hasNoPaddingTop:!0,children:e(j,{name:"required.roles","data-testid":"requiredFor",defaultValue:he[0].value,control:l.control,render:({field:r})=>e("div",{className:"kc-requiredFor",children:he.map(o=>e(z,{id:o.label,"data-testid":o.label,isChecked:oa(r.value,o.value),name:"roles",onChange:()=>{r.onChange(o.value)},label:a(o.label),className:"kc-requiredFor-option"},o.label))})})}),c(N,{label:a("requiredWhen"),labelIcon:e(P,{helpText:a("requiredWhenTooltip"),fieldLabelId:"required-when"}),fieldId:"requiredWhen",hasNoPaddingTop:!0,children:[e(z,{id:"requiredAlways","data-testid":"requiredAlways",isChecked:!_,name:"requiredWhen",label:a("always"),onChange:()=>de(!1),className:"pf-v5-u-mb-md"}),e(z,{id:"requiredScopesAsRequested","data-testid":"requiredScopesAsRequested",isChecked:_,name:"requiredWhen",label:a("scopesAsRequested"),onChange:()=>de(!0),className:"pf-v5-u-mb-md"})]}),_&&e(N,{fieldId:"kc-scope-required-when",children:e(j,{name:"required.scopes",control:l.control,defaultValue:[],render:({field:r})=>e(Z,{"data-testid":"required-when-scope-field",variant:ue.typeaheadMulti,typeAheadAriaLabel:"Select",chipGroupProps:{numChips:3,expandedText:a("hide"),collapsedText:a("showRemaining")},onToggle:o=>V(o),selections:r.value,onSelect:o=>{const q=o.toString();let R=[""];r.value?R=r.value.includes(q)?r.value.filter(J=>J!==q):[...r.value,q]:R=[q],r.onChange(R)},onClear:()=>{r.onChange([])},isOpen:v,"aria-labelledby":"scope",children:h.map(o=>e(ee,{value:o.name,children:o.name},o.name))})})})]})]})]})})]})},be=({name:t})=>{const{t:u}=w(),{control:d}=F();return e(ae,{children:e(j,{name:`permissions.${t}`,control:d,defaultValue:[],render:({field:a})=>c(L,{children:[e(B,{lg:4,sm:6,children:e(me,{id:`user-${t}`,label:u("user"),value:"user","data-testid":`user-${t}`,isChecked:a.value.includes("user"),onChange:()=>{const n="user",l=a.value.includes(n)?a.value.filter(h=>h!==n):[...a.value,n];a.onChange(l)}})}),e(B,{lg:8,sm:6,children:e(me,{id:`admin-${t}`,label:u("admin"),value:"admin","data-testid":`admin-${t}`,isChecked:a.value.includes("admin"),onChange:()=>{const n="admin",l=a.value.includes(n)?a.value.filter(h=>h!==n):[...a.value,n];a.onChange(l)}})})]})})})},ua=()=>{const{t}=w();return c(ne,{role:"manage-realm",isHorizontal:!0,children:[e(N,{hasNoPaddingTop:!0,label:t("whoCanEdit"),labelIcon:e(P,{helpText:t("whoCanEditHelp"),fieldLabelId:"whoCanEdit"}),fieldId:"kc-who-can-edit",children:e(be,{name:"edit"})}),e(N,{hasNoPaddingTop:!0,label:t("whoCanView"),labelIcon:e(P,{helpText:t("whoCanViewHelp"),fieldLabelId:"whoCanView"}),fieldId:"kc-who-can-view",children:e(be,{name:"view"})})]})},ma=({selectedValidators:t,onChange:u})=>{const{t:d}=w(),a=ve().componentTypes?.["org.keycloak.validate.Validator"]||[],n=Qe(()=>a.filter(({id:s})=>!t.includes(s)),[t]),[l,h]=ie(),[f,C]=T();return e(N,{label:d("validatorType"),fieldId:"validator",children:e(Z,{toggleId:"validator",onToggle:h,onSelect:s=>{const b=s;u(b),C(b),h()},selections:f?.id,variant:"single","aria-label":d("selectOne"),isOpen:l,placeholderText:d("choose"),menuAppendTo:"parent",maxHeight:300,children:n.map(s=>e(ee,{selected:f?.id===s.id,value:s,description:s.helpText,children:s.id},s.id))})})},pa=({selectedValidators:t,toggleDialog:u,onConfirm:d})=>{const{t:a}=w(),[n,l]=T(),h=ve().componentTypes?.["org.keycloak.validate.Validator"].length===t.length,f=fe(),{handleSubmit:C}=f,s=b=>{d({...b,id:n?.id}),u()};return e(Pe,{variant:Ee.small,title:a("addValidator"),isOpen:!0,onClose:u,actions:[e(O,{"data-testid":"save-validator-role-button",variant:"primary",type:"submit",form:"add-validator",children:a("save")},"save"),e(O,{"data-testid":"cancel-validator-role-button",variant:"link",onClick:u,children:a("cancel")},"cancel")],children:h?a("emptyValidators"):c(Te,{id:"add-validator",onSubmit:C(s),children:[e(ma,{selectedValidators:t.map(b=>b.key),onChange:l}),n&&e(te,{...f,children:e(ia,{properties:n.properties})})]})})},ha=()=>{const{t}=w(),[u,d]=ie(),[a,n]=T(),{setValue:l,control:h,register:f,getValues:C}=F(),s=$({name:"validations",control:h,defaultValue:[]});Ne(()=>{f("validations")},[f]);const[b,H]=la({titleKey:t("deleteValidatorConfirmTitle"),messageKey:t("deleteValidatorConfirmMsg",{validatorName:a}),continueButtonLabel:"delete",continueButtonVariant:Le.danger,onConfirm:async()=>{const v=s.filter(V=>V.key!==a);l("validations",[...v])}});return c(L,{children:[u&&e(pa,{selectedValidators:s,onConfirm:v=>{const V=C("annotations");v.id==="options"&&!V.find(E=>E.key==="inputType")&&l("annotations",[...V,{key:"inputType",value:"select"}]),l("validations",[...s,{key:v.id,value:v.config}])},toggleDialog:d}),e(H,{}),c("div",{className:"kc-attributes-validations",children:[e(O,{id:"addValidator",onClick:()=>d(),variant:"link","data-testid":"addValidator",className:"kc--attributes-validations--add-validation-button",icon:e(Oe,{}),children:t("addValidator")}),e(X,{}),s.length!==0?c(He,{children:[e(Ge,{children:c(pe,{children:[e(Y,{children:t("validatorColNames.colName")}),e(Y,{children:t("validatorColNames.colConfig")}),e(Y,{"aria-hidden":"true"})]})}),e(Me,{children:s.map(v=>c(pe,{children:[e(Q,{dataLabel:t("validatorColNames.colName"),children:v.key}),e(Q,{dataLabel:t("validatorColNames.colConfig"),children:JSON.stringify(v.value)}),e(Q,{className:"kc--attributes-validations--action-cell",children:e(O,{variant:"link","data-testid":"deleteValidator",onClick:()=>{b(),n(v.key)},children:t("delete")},"validator")})]},v.key))})]}):e(We,{className:"kc-emptyValidators",component:ze.p,children:t("emptyValidators")})]})]})},ba=["username","email"],ga=({onHandlingTranslationsData:t,onHandlingGeneratedDisplayName:u,save:d})=>{const{t:a}=w(),n=F(),{realm:l,attributeName:h}=le(),f=!!h,C=b=>{t(b)},s=b=>{u(b)};return c(aa,{children:[e(Ke,{label:a("jumpToSection"),sections:[{title:a("generalSettings"),panel:e(ca,{onHandlingTranslationData:C,onHandlingGeneratedDisplayName:s})},{title:a("permission"),panel:e(ua,{})},{title:a("validations"),panel:e(ha,{})},{title:a("annotations"),panel:e(da,{})}]}),e(Te,{onSubmit:n.handleSubmit(d),children:c(Xe,{name:"attribute-settings",children:[e(O,{variant:"primary",type:"submit","data-testid":"attribute-create",children:a(f?"save":"create")}),e(Ue,{to:ke({realm:l,tab:"attributes"}),"data-testid":"attribute-cancel",className:"kc-attributeCancel",children:a("cancel")})]})})]})};function Ua(){const{adminClient:t}=ge(),{realm:u,attributeName:d}=le(),{realmRepresentation:a}=ye(),n=fe(),{t:l}=w(),h=ea(),f=$e(),{addAlert:C,addError:s}=je(),[b,H]=T(null),v=!!d,[V,E]=T({key:"",translations:[]}),[G,M]=T("");U(async()=>{const g=[];return await Promise.all(h.map(async m=>{try{const i=await t.realms.getRealmLocalizationTexts({realm:u,selectedLocale:m}),A=n.getValues(),S=A.displayName?.substring(2,A.displayName.length-1)||"",k=Object.entries(i).filter(([D])=>D===S).map(([D,p])=>({locale:m,value:p}));k.length>0&&g.push({key:S,translations:k})}catch(i){s("errorSavingTranslations",i)}})),g},g=>{if(g&&g.length>0){const m=g.flatMap(i=>i.translations);E({key:g[0].key,translations:m}),n.setValue("translations",m)}},[h,u,n]),U(()=>t.users.getProfile(),g=>{H(g);const{annotations:m,validations:i,permissions:A,selector:S,required:k,multivalued:D,...p}=g.attributes.find(y=>y.name===d)||{permissions:{edit:["admin"]}};Je({...p,hasSelector:typeof S<"u",hasRequiredScopes:typeof k?.scopes<"u"},n.setValue),Object.entries(Ye({permissions:A,selector:S,required:k},{safe:!0})).map(([y,I])=>n.setValue(y,I)),n.setValue("annotations",Object.entries(m||{}).map(([y,I])=>({key:y,value:I}))),n.setValue("validations",Object.entries(i||{}).map(([y,I])=>({key:y,value:I}))),n.setValue("isRequired",k!==void 0),n.setValue("multivalued",D===!0)},[]);const x=async()=>{try{const g=V.translations.filter(m=>m.value.trim()!=="").map(async m=>{try{await t.realms.addLocalization({realm:u,selectedLocale:m.locale,key:V.key},m.value)}catch(i){s(l("errorSavingTranslations"),i)}});await Promise.all(g)}catch(g){console.error(`Error saving translations: ${g}`)}},W=async({hasSelector:g,hasRequiredScopes:m,...i})=>{g||delete i.selector,m||delete i.required?.scopes;const A=i.validations.reduce((p,y)=>(p[y.key]=y.value||{},p),{}),S=i.annotations.reduce((p,y)=>Object.assign(p,{[y.key]:y.value}),{}),k=()=>(b?.attributes||[]).map(p=>p.name!==d?p:(delete p.required,Object.assign({...p,name:d,displayName:i.displayName,selector:i.selector,permissions:i.permissions,multivalued:i.multivalued,annotations:S,validations:A},i.isRequired?{required:i.required}:void 0,i.group?{group:i.group}:{group:null}))),D=()=>(b?.attributes||[]).concat([Object.assign({name:i.name,displayName:i.displayName||G,required:i.isRequired?i.required:void 0,selector:i.selector,permissions:i.permissions,multivalued:i.multivalued,annotations:S,validations:A},i.isRequired?{required:i.required}:void 0,i.group?{group:i.group}:void 0)]);if(a?.internationalizationEnabled&&!V.translations.some(y=>y.value.trim()!=="")){s("createAttributeError",l("translationError"));return}try{const p=v?k():D();await t.users.updateProfile({...b,attributes:p,realm:u}),await x(),Fe.reloadResources(),f(ke({realm:u,tab:"attributes"})),C(l("createAttributeSuccess"),_e.success)}catch(p){s("createAttributeError",p)}};return c(te,{...n,children:[e(Ze,{titleKey:v?d:l("createAttribute"),subKey:v?"":l("createAttributeSubTitle")}),e(Be,{variant:"light",children:e(ga,{save:()=>n.handleSubmit(W)(),onHandlingTranslationsData:E,onHandlingGeneratedDisplayName:M})})]})}export{ba as USERNAME_EMAIL,Ua as default};
//# sourceMappingURL=NewAttributeSettings-CeOG5BzR.js.map
