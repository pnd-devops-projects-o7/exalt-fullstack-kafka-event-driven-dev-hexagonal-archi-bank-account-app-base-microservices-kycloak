import{jsx as e,jsxs as f,Fragment as K}from"react/jsx-runtime";import{u as M,d as $,b as ge,a as D,$ as w,I as ee,Y as Q,B,eC as he,N as ie,D as H,d4 as pe,C as _,x as be,J as ye,K as fe,af as ve,ag as re,d5 as Ce,d6 as ke,U as Ie,V as Pe,d7 as Oe,f as T,d8 as Se,ah as Me,a4 as De,ai as te,j as J,n as Le,M as oe,l as se,ap as X,m as Y,F as le,W as Te,bE as ae,o as we,c as ze,P as E,k as W,eD as Ae,S as de,T as R,q as Ee,Q as G,bl as Fe,bm as xe,L as Ve,cA as Ue,A as Ke,de as Re,cU as Be}from"./main-C047jAp3.js";import{F as Ne}from"./FormAccess-CEFqBG2E.js";import{A as qe}from"./AttributeForm-Cprekebv.js";import{R as Ge,u as He}from"./RoutableTabs-BpMBzAU0.js";import{u as ce}from"./useParams-6mfeCu18.js";import{V as We}from"./ViewHeader-Y2Z8ln-o.js";import{u as j}from"./ConfirmDialog-d09hGFUk.js";import{useState as I,useRef as je,useCallback as $e,useEffect as Qe}from"react";import{M as _e}from"./ManageOrderDialog-922B-N3z.js";import{u as F}from"./useToggle-K3Kx99tM.js";import{D as ne}from"./SwitchControl-87mhceN2.js";import{s as Je}from"./sortBy-o2QtVcO3.js";import{M as Xe}from"./MembersModal-C1L3p6YX.js";import{O as Ye,c as Ze}from"./OrganizationForm-CiZy-_uG.js";import{a as V,b as U}from"./Tabs-Dt-AxIu8.js";import"react-dom";import"./copy-icon-D1BxihC2.js";import"./KeyValueInput-B35agFBw.js";import"./KeySelect-DvFB2tXI.js";import"./PageHandler-BsZt2gxJ.js";import"./DynamicComponents-CCNvrlYx.js";import"./ClientSelect-mboGti-R.js";import"./FileUpload-2t3HfN2b.js";import"./CodeEditor--AHMF_Ho.js";import"./GroupPickerDialog-CRtxj-P-.js";import"./DataListItemRow-BUcm7LGX.js";import"./MultiLineInput-lQlb7SN3.js";import"./AddRoleMappingModal-BqwO7G2x.js";import"./translationFormatter-CkqjPJdy.js";import"./useLocaleSort-O4LGWO8i.js";import"./filter-icon-BeqpAxqe.js";import"./constants-BclHbWtx.js";import"./Droppable-BCYJDQYz.js";const et=({save:t})=>{const{adminClient:a}=M(),{realm:l}=$(),h=ge(),{t:i}=D(),{addAlert:n,addError:d}=w(),m=ee({name:"id"}),o=ee({name:"name"}),{setValue:b}=Q(),[v,g]=j({titleKey:"disableConfirmOrganizationTitle",messageKey:"disableConfirmOrganization",continueButtonLabel:"disable",onConfirm:()=>{b("enabled",!1),t()}}),[y,r]=j({titleKey:"organizationDelete",messageKey:"organizationDeleteConfirm",continueButtonLabel:"delete",continueButtonVariant:B.danger,onConfirm:async()=>{try{await a.organizations.delById({id:m}),n(i("organizationDeletedSuccess")),h(he({realm:l}))}catch(s){d("organizationDeleteError",s)}}});return e(ie,{name:"enabled",render:({field:{value:s,onChange:C}})=>f(K,{children:[e(r,{}),e(g,{}),e(We,{titleKey:o||"",divider:!1,dropdownItems:[e(H,{"data-testid":"delete-client",onClick:y,children:i("delete")},"delete")],isEnabled:s,onToggle:P=>{P?(C(P),t()):v()}})]})})},tt=({name:t,label:a,helpText:l,defaultValue:h,isRequired:i,variant:n="typeahead",isDisabled:d})=>{const{adminClient:m}=M(),{t:o}=D(),{control:b,getValues:v,formState:{errors:g}}=Q(),y=v(t),[r,s,C]=F(),[P,O]=I(""),p=je(),[c,N]=I([]),[x,Z]=I(""),me=$e(pe(Z,1e3),[]);_(async()=>{const u={max:20,realmOnly:!0};return x&&(u.search=x),await m.identityProviders.find(u)},N,[x]);const ue=u=>{const L=u.map(k=>e(te,{value:k,selected:y?.includes(k.alias),children:k.alias},k.alias));return L.length===0?e(te,{value:"",children:o("noResultsFound")}):L};return c?f(ye,{label:o(a),isRequired:i,labelIcon:l?e(fe,{helpText:l,fieldLabelId:a}):void 0,fieldId:t,children:[e(ie,{name:t,defaultValue:h,control:b,rules:{validate:u=>i&&u.filter(L=>L!==void 0).length===0?o("required"):void 0},render:({field:u})=>e(ve,{id:t,onOpenChange:s,toggle:L=>e(re,{"data-testid":t,ref:L,variant:"typeahead",onClick:s,isExpanded:r,isFullWidth:!0,isDisabled:d,status:g[t]?"danger":void 0,children:f(Ce,{isPlain:!0,children:[e(ke,{value:P||u.value,onClick:s,onChange:(k,A)=>{C(!0),O(A),me(A)},autoComplete:"off",innerRef:p,placeholderText:o("selectAUser"),...u.value&&{"aria-activedescendant":u.value},role:"combobox",isExpanded:r,"aria-controls":"select-create-typeahead-listbox",children:n==="typeaheadMulti"&&Array.isArray(u.value)&&e(Ie,{"aria-label":"Current selections",children:u.value.map((k,A)=>e(Pe,{onClick:S=>{S.stopPropagation(),u.onChange(u.value.filter(z=>z!==k))},children:k},A))})}),e(Oe,{children:!!x&&e(T,{variant:"plain",onClick:()=>{O(""),Z(""),u.onChange([]),p?.current?.focus()},"aria-label":o("clear"),children:e(Se,{"aria-hidden":!0})})})]})}),isOpen:r,selected:u.value,onSelect:(L,k)=>{const S=k.alias;if(n!=="typeaheadMulti"){const z=u.value.includes(S);z?u.onChange([]):u.onChange([S]),O(z?"":S||""),C(!1)}else{const z=u.value.find(q=>q===S)?u.value.filter(q=>q!==S):[...u.value,S];u.onChange(z)}},"aria-label":o(t),children:e(Me,{children:ue(c)})})}),g[t]&&e(De,{message:o("required")})]}):e(be,{})},at=({orgId:t,identityProvider:a,onClose:l})=>{const{adminClient:h}=M(),{t:i}=D(),{addAlert:n,addError:d}=w(),m=J({mode:"onChange"}),{handleSubmit:o,formState:b,setValue:v}=m,{getValues:g}=Q();Qe(()=>Le({...a,alias:[a?.alias],hideOnLogin:a?.hideOnLogin},v),[]);const y=async r=>{try{const s=await h.identityProviders.findOne({alias:r.alias[0]});if(!s)throw new Error(i("notFound"));const{config:C}=we(r);s.config={...s.config,...C},s.hideOnLogin=r.hideOnLogin,await h.identityProviders.update({alias:r.alias[0]},s),a||await h.organizations.linkIdp({orgId:t,alias:r.alias[0]}),n(i(a?"linkUpdatedSuccessful":"linkSuccessful")),l()}catch(s){d(a?"linkUpdatedError":"linkError",s)}};return e(oe,{variant:se.small,title:i("linkIdentityProvider"),isOpen:!0,onClose:l,actions:[e(X,{formState:b,"data-testid":"confirm",form:"form",allowInvalid:!0,allowNonDirty:!0,children:i("save")},"confirm"),e(T,{id:"modal-cancel","data-testid":"cancel",variant:B.link,onClick:l,children:i("cancel")},"cancel")],children:e(Y,{...m,children:f(le,{id:"form",onSubmit:o(y),children:[e(tt,{name:"alias",label:i("identityProvider"),defaultValue:[],isRequired:!0,isDisabled:!!a}),e(Te,{name:ae("config.kc.org.domain"),label:i("domain"),controller:{defaultValue:""},options:[{key:"",value:i("none")},...g("domains").map(r=>({key:r,value:r}))],menuAppendTo:"parent"}),e(ne,{name:"hideOnLogin",label:i("hideOnLoginPage"),labelIcon:i("hideOnLoginPageHelp"),defaultValue:!0}),e(ne,{name:ae("config.kc.org.broker.redirect.mode.email-matches"),label:i("redirectWhenEmailMatches"),labelIcon:i("redirectWhenEmailMatchesHelp"),stringify:!0})]})})})},nt=({row:t,refresh:a})=>{const{adminClient:l}=M(),{addAlert:h,addError:i}=w(),{t:n}=D(),d=async m=>{try{await l.identityProviders.update({alias:t.alias},{...t,hideOnLogin:m}),h(n("linkUpdatedSuccessful")),a()}catch(o){i("linkUpdatedError",o)}};return e(Ee,{label:n("on"),labelOff:n("off"),isChecked:t.hideOnLogin,onChange:(m,o)=>d(o)})},it=()=>{const{adminClient:t}=M(),{t:a}=D(),{id:l}=ze(),{addAlert:h,addError:i}=w(),[n,d]=I(0),m=()=>d(n+1),[o,b]=I(!1),[v,g]=I(!1),[y,r]=I(),[s,C]=F();_(async()=>t.identityProviders.find({max:1}),c=>{g(c.length===1)},[]);const P=async()=>{const c=await t.organizations.listIdentityProviders({orgId:l});return Je(c,"alias")},[O,p]=j({titleKey:"identityProviderUnlink",messageKey:"identityProviderUnlinkConfirm",continueButtonLabel:"unLinkIdentityProvider",continueButtonVariant:B.danger,onConfirm:async()=>{try{await t.organizations.unLinkIdp({orgId:l,alias:y.alias}),r(void 0),h(a("unLinkSuccessful")),m()}catch(c){i("unLinkError",c)}}});return f(K,{children:[o&&e(_e,{orgId:l,onClose:()=>{b(!1),m()}}),f(E,{variant:"light",children:[e(p,{}),s&&e(at,{orgId:l,identityProvider:y,onClose:()=>{C(),m()}}),v?e(de,{loader:P,ariaLabelKey:"identityProviders",searchPlaceholderKey:"searchProvider",toolbarItem:f(K,{children:[e(R,{children:e(T,{onClick:()=>{r(void 0),C()},children:a("linkIdentityProvider")})}),e(R,{children:e(T,{"data-testid":"manageDisplayOrder",variant:"link",onClick:()=>b(!0),children:a("manageDisplayOrder")})})]}),actions:[{title:a("edit"),onRowClick:c=>{r(c),C()}},{title:a("unLinkIdentityProvider"),onRowClick:c=>{r(c),O()}}],columns:[{name:"alias"},{name:"config['kc.org.domain']",displayKey:"domain"},{name:"providerId",displayKey:"providerDetails"},{name:"hideOnLogin",displayKey:"hideOnLoginPage",cellRenderer:c=>e(nt,{row:c,refresh:m})}],emptyState:e(W,{message:a("emptyIdentityProviderLink"),instructions:a("emptyIdentityProviderLinkInstructions"),primaryActionText:a("linkIdentityProvider"),onPrimaryAction:C})},n):e(W,{icon:Ae,message:a("noIdentityProvider"),instructions:a("noIdentityProviderInstructions")})]})]})},rt=({orgId:t,onClose:a})=>{const{adminClient:l}=M(),{addAlert:h,addError:i}=w(),{t:n}=D(),d=J(),{handleSubmit:m,formState:o}=d,b=async v=>{try{const g=new FormData;for(const y in v)g.append(y,v[y]);await l.organizations.invite({orgId:t},g),h(n("inviteSent")),a()}catch(g){i("inviteSentError",g)}};return e(oe,{variant:se.small,title:n("inviteMember"),isOpen:!0,onClose:a,actions:[e(X,{formState:o,"data-testid":"save",form:"form",allowInvalid:!0,allowNonDirty:!0,children:n("send")},"confirm"),e(T,{id:"modal-cancel","data-testid":"cancel",variant:B.link,onClick:a,children:n("cancel")},"cancel")],children:e(Y,{...d,children:f(le,{id:"form",onSubmit:m(b),children:[e(G,{name:"email",label:n("email"),rules:{required:n("required")},autoFocus:!0}),e(G,{name:"firstName",label:n("firstName")}),e(G,{name:"lastName",label:n("lastName")})]})})})},ot=t=>{const{realm:a}=$();return e(Ve,{to:Ue({realm:a,id:t.id,tab:"settings"}),children:t.username})},st=()=>{const{t}=D(),{adminClient:a}=M(),{id:l}=ce(),{addAlert:h,addError:i}=w(),[n,d]=I(0),m=()=>d(n+1),[o,b]=F(),[v,g]=F(),[y,r]=F(),[s,C]=I([]),P=(p,c,N)=>a.organizations.listMembers({orgId:l,first:p,max:c,search:N}),O=async p=>{try{await Promise.all(p.map(c=>a.organizations.delMember({orgId:l,userId:c.id}))),h(t("organizationUsersLeft",{count:p.length}))}catch(c){i("organizationUsersLeftError",c)}m()};return f(E,{variant:"light",children:[v&&e(Xe,{membersQuery:()=>a.organizations.listMembers({orgId:l}),onAdd:async p=>{try{await Promise.all(p.map(c=>a.organizations.addMember({orgId:l,userId:c.id}))),h(t("organizationUsersAdded",{count:p.length}))}catch(c){i("organizationUsersAddedError",c)}},onClose:()=>{g(),m()}}),y&&e(rt,{orgId:l,onClose:r}),e(de,{loader:P,isPaginated:!0,ariaLabelKey:"membersList",searchPlaceholderKey:"searchMember",onSelect:p=>C([...p]),canSelectAll:!0,toolbarItem:f(K,{children:[e(R,{children:e(Fe,{onOpenChange:b,toggle:p=>e(re,{ref:p,onClick:b,isExpanded:o,variant:"primary",children:t("addMember")}),isOpen:o,children:f(xe,{children:[e(H,{onClick:()=>{g(),b()},children:t("addRealmUser")}),e(H,{onClick:()=>{r(),b()},children:t("inviteMember")})]})})}),e(R,{children:e(T,{variant:"plain",isDisabled:s.length===0,onClick:()=>O(s),children:t("removeMember")})})]}),actions:[{title:t("remove"),onRowClick:async p=>{await O([p])}}],columns:[{name:"username",cellRenderer:ot},{name:"email"},{name:"firstName"},{name:"lastName"}],emptyState:e(W,{message:t("emptyMembers"),instructions:t("emptyMembersInstructions"),secondaryActions:[{text:t("addRealmUser"),onClick:g},{text:t("inviteMember"),onClick:r}]})},n)]})};function qt(){const{adminClient:t}=M(),{addAlert:a,addError:l}=w(),{realm:h}=$(),{id:i}=ce(),{t:n}=D(),d=J(),m=async r=>{try{const s=Ze(r);await t.organizations.updateById({id:i},s),a(n("organizationSaveSuccess"))}catch(s){l("organizationSaveError",s)}};_(()=>t.organizations.findOne({id:i}),r=>{if(!r)throw new Error(n("notFound"));d.reset({...r,domains:r.domains?.map(s=>s.name),attributes:Be(r.attributes)})},[i]);const o=r=>He(Re({realm:h,id:i,tab:r})),b=o("settings"),v=o("attributes"),g=o("members"),y=o("identityProviders");return e(E,{variant:"light",className:"pf-v5-u-p-0",children:f(Y,{...d,children:[e(et,{save:()=>m(d.getValues())}),f(Ge,{"data-testid":"organization-tabs","aria-label":n("organization"),isBox:!0,mountOnEnter:!0,children:[e(V,{id:"settings","data-testid":"settingsTab",title:e(U,{children:n("settings")}),...b,children:e(E,{children:f(Ne,{role:"anyone",onSubmit:d.handleSubmit(m),isHorizontal:!0,children:[e(Ye,{readOnly:!0}),f(Ke,{children:[e(X,{formState:d.formState,"data-testid":"save",children:n("save")}),e(T,{onClick:()=>d.reset(),"data-testid":"reset",variant:"link",children:n("reset")})]})]})})}),e(V,{id:"attributes","data-testid":"attributeTab",title:e(U,{children:n("attributes")}),...v,children:e(E,{variant:"light",children:e(qe,{form:d,save:m,reset:()=>d.reset({...d.getValues()}),name:"attributes"})})}),e(V,{id:"members","data-testid":"membersTab",title:e(U,{children:n("members")}),...g,children:e(st,{})}),e(V,{id:"identityProviders","data-testid":"identityProvidersTab",title:e(U,{children:n("identityProviders")}),...y,children:e(it,{})})]})]})})}export{qt as default};
//# sourceMappingURL=DetailOrganization-B2eYyNRD.js.map
