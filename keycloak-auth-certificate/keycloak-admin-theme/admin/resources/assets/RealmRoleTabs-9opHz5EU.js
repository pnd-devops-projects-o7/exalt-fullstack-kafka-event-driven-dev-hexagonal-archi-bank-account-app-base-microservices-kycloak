import{jsx as e,jsxs as R,Fragment as ue}from"react/jsx-runtime";import{u as W,b as $,d as j,a as Q,aj as pe,P as z,S as be,y as fe,f as b,k as he,bx as v,cP as Re,bC as ye,j as ge,$ as Ce,b_ as ve,I as M,C as V,by as U,cQ as we,B as Te,p as N,x as ke,D as Ie,m as Ae,bM as L,cR as O,bD as De,cj as Fe,cS as Ne,cT as Se,cC as Ee,cU as Pe}from"./main-C047jAp3.js";import{useState as w}from"react";import{u as xe}from"./ConfirmDialog-d09hGFUk.js";import{A as Be}from"./AttributeForm-Cprekebv.js";import{P as Ke}from"./PermissionTab-D1RTtpaA.js";import{R as Me}from"./RoleForm-X_WUY0Ej.js";import{A as Ve,R as Ue}from"./AddRoleMappingModal-BqwO7G2x.js";import{R as Le,u as Oe}from"./RoutableTabs-BpMBzAU0.js";import{V as We}from"./ViewHeader-Y2Z8ln-o.js";import{u as G}from"./useParams-6mfeCu18.js";import{Q as $e}from"./question-circle-icon-CJxJ4SYK.js";import{a as f,b as h}from"./Tabs-Dt-AxIu8.js";import"react-dom";import"./FormAccess-CEFqBG2E.js";import"./copy-icon-D1BxihC2.js";import"./KeyValueInput-B35agFBw.js";import"./KeySelect-DvFB2tXI.js";import"./useToggle-K3Kx99tM.js";import"./useLocaleSort-O4LGWO8i.js";import"./Trans-C8a1WrTl.js";import"./translationFormatter-CkqjPJdy.js";import"./filter-icon-BeqpAxqe.js";import"./PageHandler-BsZt2gxJ.js";import"./DynamicComponents-CCNvrlYx.js";import"./ClientSelect-mboGti-R.js";import"./FileUpload-2t3HfN2b.js";import"./CodeEditor--AHMF_Ho.js";import"./GroupPickerDialog-CRtxj-P-.js";import"./DataListItemRow-BUcm7LGX.js";import"./MultiLineInput-lQlb7SN3.js";import"./constants-BclHbWtx.js";const je=()=>{const{adminClient:n}=W(),m=$(),{realm:a}=j(),{t:s}=Q(),{id:y,clientId:T}=G(),k=async(r,l)=>{const i=await n.roles.findOneById({id:y});if(!i)throw new Error(s("notFound"));return i.clientRole?n.clients.findUsersWithRole({roleName:i.name,id:T,briefRepresentation:!0,first:r,max:l}):n.roles.findUsersWithRole({name:i.name,briefRepresentation:!0,first:r,max:l})},{enabled:g}=pe();return e(z,{"data-testid":"users-page",variant:"light",children:e(be,{isPaginated:!0,loader:k,ariaLabelKey:"roleList",searchPlaceholderKey:"","data-testid":"users-in-role-table",toolbarItem:g&&e(fe,{"aria-label":"Basic popover",position:"bottom",bodyContent:R("div",{children:[s("whoWillAppearPopoverTextRoles"),e(b,{className:"kc-groups-link",variant:"link",onClick:()=>m(`/${a}/groups`),children:s("groups")}),s("or"),R(b,{className:"kc-users-link",variant:"link",onClick:()=>m(`/${a}/users`),children:[s("users"),"."]})]}),footerContent:s("whoWillAppearPopoverFooterText"),children:e(b,{variant:"link",className:"kc-who-will-appear-button",icon:e($e,{}),children:s("whoWillAppearLinkTextRoles")},"who-will-appear-button")}),emptyState:e(he,{hasIcon:!0,message:s("noDirectUsers"),instructions:R("div",{children:[s("noUsersEmptyStateDescription"),e(b,{className:"kc-groups-link-empty-state",variant:"link",onClick:()=>m(`/${a}/groups`),children:s("groups")}),s("or"),e(b,{className:"kc-users-link-empty-state",variant:"link",onClick:()=>m(`/${a}/users`),children:s("users")}),s("noUsersEmptyStateDescriptionContinued")]})}),columns:[{name:"username",displayKey:"userName",cellFormatters:[v()]},{name:"email",displayKey:"email",cellFormatters:[v()]},{name:"lastName",displayKey:"lastName",cellFormatters:[v()]},{name:"firstName",displayKey:"firstName",cellFormatters:[Re(),v()]}]})})};function wt(){const{adminClient:n}=W(),m=ye(),{t:a}=Q(),s=ge({mode:"onChange"}),{control:y,reset:T,setValue:k}=s,g=$(),{id:r,clientId:l}=G(),{realm:i,realmRepresentation:C}=j(),[S,_]=w(0),[q,E]=w(),H=()=>_(S+1),{addAlert:I,addError:A}=Ce(),{hasAccess:J}=ve(),X=J("query-clients","manage-authorization"),[Y,Z]=w(!1),[ee,te]=w(!1),ae=t=>{const{attributes:o,...F}=t;return{attributes:Pe(o),...F}},c=M({control:y,defaultValue:void 0,name:"name"}),se=M({control:y,defaultValue:!1,name:"composite"});V(async()=>n.roles.findOneById({id:r}),t=>{if(!t)throw new Error(a("notFound"));const o=ae(t);T(o),E(o.attributes)},[S]),V(async()=>n.clients.findOne({id:l}),t=>{l&&Z(t?.access?.manage)},[]);const P=async t=>{try{const{attributes:o,...F}=t,p=F;p.name=p.name?.trim(),p.attributes=Fe(o),l?await n.clients.updateRole({id:l,roleName:t.name},p):await n.roles.updateById({id:r},p),E(o),I(a("roleSaveSuccess"),N.success)}catch(o){A("roleSaveError",o)}},x=U(Ne.path),d=U(we.path),oe=()=>{if(x)return O({realm:i});if(d)return L({realm:i,clientId:d.params.clientId,tab:"roles"});throw new Error("Roles overview route could not be determined.")},D=t=>{if(x)return Se({realm:i,id:r,tab:t});if(d)return Ee({realm:i,id:r,clientId:d.params.clientId,tab:t});throw new Error("Route could not be determined.")},u=t=>Oe(D(t)),re=u("details"),ne=u("associated-roles"),ie=u("attributes"),le=u("users-in-role"),ce=u("permissions"),[me,de]=xe({titleKey:"roleDeleteConfirm",messageKey:a("roleDeleteConfirmDialog",{selectedRoleName:c||a("createRole")}),continueButtonLabel:"delete",continueButtonVariant:Te.danger,onConfirm:async()=>{try{l?await n.clients.delRole({id:l,roleName:c}):await n.roles.delById({id:r}),I(a("roleDeletedSuccess"),N.success),g(oe())}catch(t){A("roleDeleteError",t)}}}),B=async t=>{try{await n.roles.createComposite({roleId:r,realm:C.realm},t),H(),g(D("associated-roles")),I(a("addAssociatedRolesSuccess"),N.success)}catch(o){A("addAssociatedRolesError",o)}},K=t=>C?.defaultRole&&C.defaultRole.name===t;return C?R(ue,{children:[e(de,{}),ee&&e(Ve,{id:r,type:"roles",name:c,onAssign:t=>B(t.map(o=>o.role)),onClose:()=>te(!1)}),e(We,{titleKey:c,badges:[{id:"composite-role-badge",text:se?a("composite"):"",readonly:!0}],actionsDropdownId:"roles-actions-dropdown",dropdownItems:[e(Ie,{component:"button",onClick:()=>{me()},children:a("deleteRole")},"delete-role")],divider:!1}),e(z,{variant:"light",className:"pf-v5-u-p-0",children:e(Ae,{...s,children:R(Le,{isBox:!0,mountOnEnter:!0,defaultLocation:D("details"),children:[e(f,{title:e(h,{children:a("details")}),...re,children:e(Me,{form:s,onSubmit:P,role:d?"manage-clients":"manage-realm",cancelLink:d?L({realm:i,clientId:l,tab:"roles"}):O({realm:i}),editMode:!0})}),e(f,{"data-testid":"associatedRolesTab",title:e(h,{children:a("associatedRolesText")}),...ne,children:e(Ue,{name:c,id:r,type:"roles",isManager:!0,save:t=>B(t.map(o=>o.role))})}),!K(c)&&e(f,{"data-testid":"attributesTab",className:"kc-attributes-tab",title:e(h,{children:a("attributes")}),...ie,children:e(Be,{form:s,save:P,fineGrainedAccess:Y,reset:()=>k("attributes",q,{shouldDirty:!1})})}),!K(c)&&e(f,{title:e(h,{children:a("usersInRole")}),...le,children:e(je,{"data-cy":"users-in-role-tab"})}),m(De.AdminFineGrainedAuthz)&&X&&e(f,{title:e(h,{children:a("permissions")}),...ce,children:e(Ke,{id:r,type:"roles"})})]})})})]}):e(ke,{})}export{wt as default};
//# sourceMappingURL=RealmRoleTabs-9opHz5EU.js.map
