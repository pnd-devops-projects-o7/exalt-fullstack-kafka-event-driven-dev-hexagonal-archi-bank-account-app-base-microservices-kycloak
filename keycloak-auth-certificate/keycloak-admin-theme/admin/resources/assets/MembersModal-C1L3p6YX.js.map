{"version":3,"file":"MembersModal-C1L3p6YX.js","sources":["../../../../../../../src/groups/MembersModal.tsx"],"sourcesContent":["import type UserRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/userRepresentation\";\nimport { Button, Modal, ModalVariant, Label } from \"@patternfly/react-core\";\nimport { InfoCircleIcon } from \"@patternfly/react-icons\";\nimport { differenceBy } from \"lodash-es\";\nimport { useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useAdminClient } from \"../admin-client\";\nimport { useAlerts } from \"@keycloak/keycloak-ui-shared\";\nimport { ListEmptyState } from \"@keycloak/keycloak-ui-shared\";\nimport { KeycloakDataTable } from \"@keycloak/keycloak-ui-shared\";\nimport { emptyFormatter } from \"../util\";\n\ntype MemberModalProps = {\n  membersQuery: (first?: number, max?: number) => Promise<UserRepresentation[]>;\n  onAdd: (users: UserRepresentation[]) => Promise<void>;\n  onClose: () => void;\n};\n\nconst UserDetail = (user: UserRepresentation) => {\n  const { t } = useTranslation();\n  return (\n    <>\n      {user.username}{\" \"}\n      {!user.enabled && (\n        <Label color=\"red\" icon={<InfoCircleIcon />}>\n          {t(\"disabled\")}\n        </Label>\n      )}\n    </>\n  );\n};\n\nexport const MemberModal = ({\n  membersQuery,\n  onAdd,\n  onClose,\n}: MemberModalProps) => {\n  const { adminClient } = useAdminClient();\n\n  const { t } = useTranslation();\n  const { addError } = useAlerts();\n  const [selectedRows, setSelectedRows] = useState<UserRepresentation[]>([]);\n\n  const loader = async (first?: number, max?: number, search?: string) => {\n    const members = await membersQuery(first, max);\n    const params: { [name: string]: string | number } = {\n      first: first!,\n      max: max! + members.length,\n      search: search || \"\",\n    };\n\n    try {\n      const users = await adminClient.users.find({ ...params });\n      return differenceBy(users, members, \"id\").slice(0, max);\n    } catch (error) {\n      addError(\"noUsersFoundError\", error);\n      return [];\n    }\n  };\n\n  return (\n    <Modal\n      variant={ModalVariant.large}\n      title={t(\"addMember\")}\n      isOpen\n      onClose={onClose}\n      actions={[\n        <Button\n          data-testid=\"add\"\n          key=\"confirm\"\n          variant=\"primary\"\n          onClick={async () => {\n            await onAdd(selectedRows);\n            onClose();\n          }}\n        >\n          {t(\"add\")}\n        </Button>,\n        <Button\n          data-testid=\"cancel\"\n          key=\"cancel\"\n          variant=\"link\"\n          onClick={onClose}\n        >\n          {t(\"cancel\")}\n        </Button>,\n      ]}\n    >\n      <KeycloakDataTable\n        loader={loader}\n        isPaginated\n        ariaLabelKey=\"titleUsers\"\n        searchPlaceholderKey=\"searchForUser\"\n        canSelectAll\n        onSelect={(rows) => setSelectedRows([...rows])}\n        emptyState={\n          <ListEmptyState\n            message={t(\"noUsersFound\")}\n            instructions={t(\"emptyInstructions\")}\n          />\n        }\n        columns={[\n          {\n            name: \"username\",\n            displayKey: \"username\",\n            cellRenderer: UserDetail,\n          },\n          {\n            name: \"email\",\n            displayKey: \"email\",\n            cellFormatters: [emptyFormatter()],\n          },\n          {\n            name: \"lastName\",\n            displayKey: \"lastName\",\n            cellFormatters: [emptyFormatter()],\n          },\n          {\n            name: \"firstName\",\n            displayKey: \"firstName\",\n            cellFormatters: [emptyFormatter()],\n          },\n        ]}\n      />\n    </Modal>\n  );\n};\n"],"names":["UserDetail","user","t","useTranslation","jsxs","Fragment","jsx","Label","InfoCircleIcon","MemberModal","membersQuery","onAdd","onClose","adminClient","useAdminClient","addError","useAlerts","selectedRows","setSelectedRows","useState","loader","first","max","search","members","params","users","differenceBy","error","Modal","ModalVariant","Button","KeycloakDataTable","rows","ListEmptyState","emptyFormatter"],"mappings":"yNAkBA,MAAMA,EAAcC,GAA6B,CACzC,KAAA,CAAE,EAAAC,GAAMC,IACd,OAEKC,EAAAC,EAAA,CAAA,SAAA,CAAKJ,EAAA,SAAU,IACf,CAACA,EAAK,SACLK,EAACC,EAAM,CAAA,MAAM,MAAM,KAAOD,EAAAE,EAAA,CAAA,CAAe,EACtC,SAAAN,EAAE,UAAU,EACf,CAEJ,CAAA,CAAA,CAEJ,EAEaO,EAAc,CAAC,CAC1B,aAAAC,EACA,MAAAC,EACA,QAAAC,CACF,IAAwB,CAChB,KAAA,CAAE,YAAAC,GAAgBC,IAElB,CAAE,EAAAZ,GAAMC,IACR,CAAE,SAAAY,GAAaC,IACf,CAACC,EAAcC,CAAe,EAAIC,EAA+B,CAAE,CAAA,EAEnEC,EAAS,MAAOC,EAAgBC,EAAcC,IAAoB,CACtE,MAAMC,EAAU,MAAMd,EAAaW,EAAOC,CAAG,EACvCG,EAA8C,CAClD,MAAAJ,EACA,IAAKC,EAAOE,EAAQ,OACpB,OAAQD,GAAU,EAAA,EAGhB,GAAA,CACI,MAAAG,EAAQ,MAAMb,EAAY,MAAM,KAAK,CAAE,GAAGY,EAAQ,EACxD,OAAOE,EAAaD,EAAOF,EAAS,IAAI,EAAE,MAAM,EAAGF,CAAG,QAC/CM,EAAO,CACd,OAAAb,EAAS,oBAAqBa,CAAK,EAC5B,EACT,CAAA,EAIA,OAAAtB,EAACuB,EAAA,CACC,QAASC,EAAa,MACtB,MAAO5B,EAAE,WAAW,EACpB,OAAM,GACN,QAAAU,EACA,QAAS,CACPN,EAACyB,EAAA,CACC,cAAY,MAEZ,QAAQ,UACR,QAAS,SAAY,CACnB,MAAMpB,EAAMM,CAAY,EAChBL,GACV,EAEC,WAAE,KAAK,CAAA,EAPJ,SAQN,EACAN,EAACyB,EAAA,CACC,cAAY,SAEZ,QAAQ,OACR,QAASnB,EAER,WAAE,QAAQ,CAAA,EAJP,QAKN,CACF,EAEA,SAAAN,EAAC0B,EAAA,CACC,OAAAZ,EACA,YAAW,GACX,aAAa,aACb,qBAAqB,gBACrB,aAAY,GACZ,SAAWa,GAASf,EAAgB,CAAC,GAAGe,CAAI,CAAC,EAC7C,WACE3B,EAAC4B,EAAA,CACC,QAAShC,EAAE,cAAc,EACzB,aAAcA,EAAE,mBAAmB,CAAA,CACrC,EAEF,QAAS,CACP,CACE,KAAM,WACN,WAAY,WACZ,aAAcF,CAChB,EACA,CACE,KAAM,QACN,WAAY,QACZ,eAAgB,CAACmC,GAAgB,CACnC,EACA,CACE,KAAM,WACN,WAAY,WACZ,eAAgB,CAACA,GAAgB,CACnC,EACA,CACE,KAAM,YACN,WAAY,YACZ,eAAgB,CAACA,GAAgB,CACnC,CACF,CAAA,CACF,CAAA,CAAA,CAGN"}