import{jsxs as f,Fragment as z,jsx as e}from"react/jsx-runtime";import{u as J,a as U,$ as q,b as M,d as Q,c as W,e as X,j as Y,C as Z,P as _,J as ii,K as oi,N as ni,c6 as ei,c7 as ti,ai,m as si,A as ri,f as g,eU as P,L as ci,p as di}from"./main-C047jAp3.js";import{useState as r}from"react";import{D as li}from"./DynamicComponents-CCNvrlYx.js";import{F as pi}from"./FormAccess-CEFqBG2E.js";import{V as mi}from"./ViewHeader-Y2Z8ln-o.js";import{c as I}from"./camelCase-DAUzA25U.js";import"react-dom";import"./ClientSelect-mboGti-R.js";import"./FileUpload-2t3HfN2b.js";import"./CodeEditor--AHMF_Ho.js";import"./copy-icon-D1BxihC2.js";import"./GroupPickerDialog-CRtxj-P-.js";import"./DataListItemRow-BUcm7LGX.js";import"./KeySelect-DvFB2tXI.js";import"./useToggle-K3Kx99tM.js";import"./MultiLineInput-lQlb7SN3.js";import"./AddRoleMappingModal-BqwO7G2x.js";import"./translationFormatter-CkqjPJdy.js";import"./useLocaleSort-O4LGWO8i.js";import"./ConfirmDialog-d09hGFUk.js";import"./filter-icon-BeqpAxqe.js";import"./capitalize-brOSHTpf.js";import"./_baseSlice-F8doVSIJ.js";function ji(){const{adminClient:v}=J(),{t:n}=U(),{addAlert:N,addError:x}=q(),h=M(),{realm:C}=Q(),[D,T]=r(!1),[d,F]=r(!1),[w,b]=r([]),[G,V]=r([]),[H,O]=r(),[p,$]=r(""),[k,S]=r([]),{policyName:c,conditionName:t}=W(),j=X(),m=Y(),A=j.componentTypes?.["org.keycloak.services.clientpolicy.condition.ClientPolicyConditionProvider"],B=a=>{m.reset({config:a.configuration||{}})};Z(()=>v.clientPolicies.listPolicies({includeGlobalPolicies:!0}),a=>{if(b(a.policies??[]),t){let i=a.policies?.find(o=>o.name===c);i===void 0&&(i=a.globalPolicies?.find(o=>o.name===c),F(i!==void 0));const l=i?.conditions?.find(o=>o.condition===t),u=A?.find(o=>o.id===t);O(l),S(u?.properties),B(l)}},[]);const E=async a=>{const i=a.config,l=()=>k.reduce((o,s)=>(o[s.name]=i[s.name],o),{}),u=w.map(o=>{if(o.name!==c)return o;let s=o.conditions??[];if(t){const L={condition:H?.condition,configuration:l()},y=s.findIndex(R=>t===R.condition);if(y===-1)return;const K=[...s.slice(0,y),L,...s.slice(y+1)];return{...o,conditions:K}}return s=s.concat({condition:G[0].condition,configuration:l()}),{...o,conditions:s}});try{await v.clientPolicies.updatePolicy({policies:u}),b(u),h(P({realm:C,policyName:c})),N(n(t?"updateClientConditionSuccess":"createClientConditionSuccess"),di.success)}catch(o){x("createClientConditionError",o)}};return f(z,{children:[e(mi,{titleKey:n(t?d?"viewCondition":"editCondition":"addCondition"),divider:!0}),f(_,{variant:"light",children:[f(pi,{isHorizontal:!0,role:"manage-realm",isReadOnly:d,className:"pf-v5-u-mt-lg",onSubmit:m.handleSubmit(E),children:[e(ii,{label:n("conditionType"),fieldId:"conditionType",labelIcon:e(oi,{helpText:p?`${I(p.replace(/-/g," "))}Help`:"conditionsHelp",fieldLabelId:"conditionType"}),children:e(ni,{name:"conditions",defaultValue:"any-client",control:m.control,render:({field:a})=>e(ei,{placeholderText:n("selectACondition"),className:"kc-conditionType-select","data-testid":"conditionType-select",toggleId:"provider",isDisabled:!!t,onToggle:i=>T(i),onSelect:i=>{a.onChange(i),S(i.properties),$(i.id),V([{condition:i.id}]),T(!1)},selections:t||p,variant:ti.single,"aria-label":n("conditionType"),isOpen:D,children:A?.map(i=>e(ai,{selected:i.id===a.value,description:n(I(i.id.replace(/-/g," "))),value:i,children:i.id},i.id))})})}),e(si,{...m,children:e(li,{properties:k})}),!d&&f(ri,{children:[e(g,{variant:"primary",type:"submit","data-testid":"addCondition-saveBtn",isDisabled:p===""&&!t&&d,children:n(t?"save":"add")}),e(g,{variant:"link","data-testid":"addCondition-cancelBtn",onClick:()=>h(P({realm:C,policyName:c})),children:n("cancel")})]})]}),d&&e("div",{className:"kc-backToProfile",children:e(g,{component:a=>e(ci,{...a,to:P({realm:C,policyName:c})}),variant:"primary",children:n("back")})})]})]})}export{ji as default};
//# sourceMappingURL=NewClientPolicyCondition-Cog-Xc63.js.map
