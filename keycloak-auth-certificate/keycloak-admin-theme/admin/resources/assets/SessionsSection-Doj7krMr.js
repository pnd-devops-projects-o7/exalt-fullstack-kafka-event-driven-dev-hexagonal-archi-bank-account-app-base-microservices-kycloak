import{jsxs as y,jsx as e,Fragment as D}from"react/jsx-runtime";import{u as T,a as R,$ as k,d as L,j as O,M as x,l as I,f as v,B as U,E as q,F as V,J as M,a0 as P,p as d,D as N,ak as $,P as j,c6 as K,ai as A,dE as G}from"./main-C047jAp3.js";import{useState as S}from"react";import{u as H}from"./ConfirmDialog-d09hGFUk.js";import{V as z}from"./ViewHeader-Y2Z8ln-o.js";import{u as J}from"./useToggle-K3Kx99tM.js";import{S as Q}from"./SessionsTable-BLXrizvi.js";import{F as W}from"./filter-icon-BeqpAxqe.js";import"react-dom";import"./useFormatDate-Bn-bRoLD.js";import"./ListItem-CzCWGkg6.js";const X=({handleModalToggle:n,save:l})=>{const{adminClient:a}=T(),{t}=R(),{addAlert:s,addError:c}=k(),{realm:r,realmRepresentation:u,refresh:g}=L(),{register:m,handleSubmit:C}=O(),b=(o,p)=>{const i=o.successRequests?.length||0,h=o.failedRequests?.length||0;i===0&&h===0?s(t("noAdminUrlSet"),d.warning):h>0?(s(t(""+p+"Success",{successNodes:o.successRequests}),d.success),s(t(""+p+"Fail",{failedNodes:o.failedRequests}),d.danger)):s(t(""+p+"Success",{successNodes:o.successRequests}),d.success)},w=async()=>{try{await a.realms.update({realm:r},{realm:r,notBefore:Date.now()/1e3}),s(t("notBeforeSuccess"),d.success)}catch(o){c("setToNowError",o)}},f=async()=>{try{await a.realms.update({realm:r},{realm:r,notBefore:0}),s(t("notBeforeClearedSuccess"),d.success),g()}catch(o){c("notBeforeError",o)}},B=async()=>{const o=await a.realms.pushRevocation({realm:r});b(o,"notBeforePush"),g()};return y(x,{variant:I.small,title:t("revocation"),isOpen:!0,onClose:n,actions:[e(v,{"data-testid":"set-to-now-button",variant:"tertiary",onClick:()=>{w(),n()},form:"revocation-modal-form",children:t("setToNow")},"set-to-now"),e(v,{"data-testid":"clear-not-before-button",variant:"tertiary",onClick:()=>{f(),n()},form:"revocation-modal-form",children:t("clear")},"clear"),e(v,{"data-testid":"modal-test-connection-button",variant:"secondary",onClick:()=>{B(),n()},form:"revocation-modal-form",children:t("push")},"push"),e(v,{id:"modal-cancel","data-testid":"cancel",variant:U.link,onClick:()=>{n()},children:t("cancel")},"cancel")],children:[e(q,{className:"kc-revocation-description-text",children:t("revocationDescription")}),e(V,{id:"revocation-modal-form",isHorizontal:!0,onSubmit:C(l),children:e(M,{className:"kc-revocation-modal-form-group",label:t("notBefore"),name:"notBefore",fieldId:"not-before",children:e(P,{"data-testid":"not-before-input",autoFocus:!0,readOnly:!0,value:u?.notBefore===0?t("none"):new Date(u?.notBefore*1e3).toString(),type:"text",id:"not-before",...m("notBefore")})})})]})},Y=({filterType:n,onChange:l})=>{const{t:a}=R(),[t,s]=J();return y(K,{"data-testid":"filter-session-type-select",isOpen:t,onToggle:s,toggleIcon:e(W,{}),onSelect:c=>{l(c),s()},selections:n,children:[e(A,{"data-testid":"all-sessions-option",value:"ALL",children:a("sessionsType.allSessions")}),e(A,{"data-testid":"regular-sso-option",value:"REGULAR",children:a("sessionsType.regularSSO")}),e(A,{"data-testid":"offline-option",value:"OFFLINE",children:a("sessionsType.offline")})]})};function ce(){const{adminClient:n}=T(),{t:l}=R(),[a,t]=S(0),s=()=>t(a+1),{addError:c}=k(),{realm:r}=L(),[u,g]=S(!1),[m,C]=S("ALL"),[b,w]=S(!1),f=()=>{g(!u)},B=async(i,h,E)=>{const F=await G(n,"ui-ext/sessions",{first:`${i}`,max:`${h}`,type:m,search:E||""});return w(F.length===0),F},[o,p]=H({titleKey:"logoutAllSessions",messageKey:"logoutAllDescription",continueButtonLabel:"confirm",onConfirm:async()=>{try{await n.realms.logoutAll({realm:r}),s()}catch(i){c("logoutAllSessionsError",i)}}});return y(D,{children:[e(p,{}),e(z,{dropdownItems:[e(N,{"data-testid":"revocation",component:"button",onClick:()=>f(),children:l("revocation")},"toggle-modal"),e(N,{"data-testid":"logout-all",component:"button",isDisabled:b,onClick:o,children:l("signOutAllActiveSessions")},"delete-role")],titleKey:"titleSessions",subKey:"sessionExplain",helpUrl:$.sessionsUrl}),y(j,{variant:"light",className:"pf-v5-u-p-0",children:[u&&e(X,{handleModalToggle:f,save:()=>{f()}}),e(Q,{loader:B,isSearching:m!=="ALL",isPaginated:!0,filter:e(Y,{filterType:m,onChange:i=>{C(i),s()}})},a)]})]})}export{ce as default};
//# sourceMappingURL=SessionsSection-Doj7krMr.js.map
