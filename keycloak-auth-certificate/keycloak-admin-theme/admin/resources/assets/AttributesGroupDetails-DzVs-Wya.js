import{jsxs as m,Fragment as ma,jsx as t}from"react/jsx-runtime";import{u as ya,a as ba,d as fa,b as Da,c as ga,j as ha,$ as Ha,C as Ta,I as S,P as Ga,m as Aa,Q as va,J as $,K as V,cx as j,cy as N,a0 as R,bs as B,f as x,E as ka,G as Ea,A as Na,L as xa,f7 as O,f1 as Ia}from"./main-C047jAp3.js";import{useState as h,useMemo as za,useEffect as U}from"react";import{F as $a}from"./FormAccess-CEFqBG2E.js";import{K as wa}from"./KeyValueInput-B35agFBw.js";import{V as Pa}from"./ViewHeader-Y2Z8ln-o.js";import{u as Fa}from"./useLocale-D_QRvci7.js";import{u as La}from"./useToggle-K3Kx99tM.js";/* empty css                               */import{u as Ca,U as Ka}from"./UserProfileContext-DnL-Q4sd.js";import{A as Ma,G as q}from"./AddTranslationsDialog-CR9Cxwfn.js";import"react-dom";import"./copy-icon-D1BxihC2.js";import"./KeySelect-DvFB2tXI.js";function Sa(y){return Object.entries(y).reduce((e,[p,s])=>typeof s=="string"?[...e,{key:p,value:s}]:[...e],[])}function Va(y){return Object.fromEntries(y.filter(e=>e.key.length>0).map(e=>[e.key,e.value]))}const Q={annotations:[],displayDescription:"",displayHeader:"",name:""};function ja(){const{adminClient:y}=ya(),{t:e}=ba(),{realm:p,realmRepresentation:s}=fa(),{config:g,save:J}=Ca(),W=Da(),w=Fa(),I=ga(),r=ha({defaultValues:Q}),{addError:X}=Ha(),c=!!I.name,[b,Y]=h(""),[H,Z]=h(""),[T,_]=h(""),[aa,G]=La(),ta=/\$\{([^}]+)\}/,[f,P]=h(),[l,z]=h({displayHeader:{key:"",translations:[]},displayDescription:{key:"",translations:[]}}),o=za(()=>g?.groups?.find(({name:i})=>i===I.name),[g?.groups,I.name]);U(()=>{if(!o)return;const i=o.annotations?Sa(o.annotations):[];r.reset({...Q,...o,annotations:i})},[o,r]),U(()=>{r.setValue("displayHeader",o?.displayHeader||H||""),r.setValue("displayDescription",o?.displayDescription||T||"")},[H,T,o,r]),Ta(async()=>{const i=[],a=[];await Promise.all(w.map(async n=>{try{const u=await y.realms.getRealmLocalizationTexts({realm:p,selectedLocale:n}),k=r.getValues(),E=ua=>{const M=ua?.match(/\$\{(.*?)\}/);return M?M[1]:""},D=E(k.displayHeader)||"",L=E(k.displayDescription)||"",C=u[D]||"",K=u[L]||"";C&&i.push({key:D,translations:[{locale:n,value:C}]}),K&&a.push({key:L,translations:[{locale:n,value:K}]})}catch(u){console.error(`Error fetching translations for ${n}:`,u)}}));const d={displayHeader:{key:i.length>0?i[0].key:"",translations:i.flatMap(n=>n.translations)},displayDescription:{key:a.length>0?a[0].key:"",translations:a.flatMap(n=>n.translations)}};z(d)},()=>{},[w,p,r]);const ea=async()=>{const i=async(a,d,n)=>{try{await y.realms.addLocalization({realm:p,selectedLocale:d,key:a},n)}catch(u){console.error(`Error saving translation for locale ${d}: ${u}`)}};try{if(l&&l.displayHeader.translations.length>0)for(const a of l.displayHeader.translations)a.locale&&a.value&&await i(l.displayHeader.key,a.locale,a.value);if(l&&l.displayDescription.translations.length>0)for(const a of l.displayDescription.translations)a.locale&&a.value&&await i(l.displayDescription.key,a.locale,a.value)}catch(a){console.error(`Error while processing translations: ${a}`)}},ia=async i=>{if(!g)return;const a=[...g.groups??[]],d=o?a.indexOf(o):-1,n={...i,annotations:Va(i.annotations)};if(d===-1?a.push(n):a[d]=n,s?.internationalizationEnabled){const k=l.displayHeader.translations.some(D=>D.value.trim()!==""),E=l.displayDescription.translations.some(D=>D.value.trim()!=="");if(!k||!E){X("createAttributeError",e("translationError"));return}}await J({...g,groups:a})&&(await ea(),Ia.reloadResources(),W(O({realm:p,tab:"attributes-group"})))},A=S({control:r.control,name:"displayHeader"}),v=S({control:r.control,name:"displayDescription"}),na=(i,a)=>{const d=a!==""&&s?.internationalizationEnabled?`\${profile.attribute-group.${a}}`:"",n=a!==""&&s?.internationalizationEnabled?`\${profile.attribute-group-description.${a}}`:"";Y(a),Z(d),_(n)},F=ta.test(A||v),sa=A?.substring(2,A.length-1),ra=v?.substring(2,v.length-1),oa=i=>{z(a=>({...a,displayHeader:i}))},la=i=>{z(a=>({...a,displayDescription:i}))},da=()=>{G()},pa=f==="displayHeader"?sa:`profile.attribute-group.${b}`,ca=f==="displayDescription"?ra:`profile.attribute-group-description.${b}`;return m(ma,{children:[aa&&t(Ma,{translationKey:f==="displayHeader"?pa:ca,type:f==="displayHeader"?"displayHeader":"displayDescription",translations:f==="displayHeader"?l.displayHeader:l.displayDescription,onTranslationsAdded:f==="displayHeader"?oa:la,toggleDialog:da,onCancel:()=>{G()}}),t(Pa,{titleKey:o?"editGroupText":"createGroupText",divider:!0}),t(Ga,{variant:"light",onSubmit:r.handleSubmit(ia),children:t($a,{isHorizontal:!0,role:"manage-realm",children:m(Aa,{...r,children:[t(va,{name:"name",label:e("nameField"),labelIcon:e("nameHintHelp"),isDisabled:!!o||c,rules:{required:e("required"),onChange:i=>{na(i,i.target.value)}}}),!!o&&t("input",{type:"hidden",...r.register("name")}),t($,{label:e("displayHeaderField"),labelIcon:t(V,{helpText:e("displayHeaderHintHelp"),fieldLabelId:"displayHeaderField"}),fieldId:"kc-attributes-group-display-header",children:m(j,{hasGutter:!0,children:[m(N,{span:s?.internationalizationEnabled?11:12,children:[t(R,{id:"kc-attributes-group-display-header","data-testid":"attributes-group-display-header",isDisabled:s?.internationalizationEnabled&&b!==""||c&&F,value:c?A:s?.internationalizationEnabled?H:void 0,...r.register("displayHeader")}),H&&t(B,{className:"pf-v5-u-mt-sm",variant:"info",isInline:!0,isPlain:!0,title:e("addAttributesGroupTranslationInfo")})]}),s?.internationalizationEnabled&&t(N,{span:1,children:t(x,{variant:"link",className:"pf-m-plain","data-testid":"addAttributeDisplayNameTranslationBtn","aria-label":e("addAttributeDisplayNameTranslation"),isDisabled:!b&&!c,onClick:()=>{P("displayHeader"),G()},icon:t(q,{})})})]})}),t($,{label:e("displayDescriptionField"),labelIcon:t(V,{helpText:e("displayDescriptionHintHelp"),fieldLabelId:"displayDescriptionField"}),fieldId:"kc-attributes-group-display-description",children:m(j,{hasGutter:!0,children:[m(N,{span:s?.internationalizationEnabled?11:12,children:[t(R,{id:"kc-attributes-group-display-description","data-testid":"attributes-group-display-description",isDisabled:s?.internationalizationEnabled&&b!==""||c&&F,value:c?v:s?.internationalizationEnabled?T:void 0,...r.register("displayDescription")}),T&&t(B,{className:"pf-v5-u-mt-sm",variant:"info",isInline:!0,isPlain:!0,title:e("addAttributesGroupTranslationInfo")})]}),s?.internationalizationEnabled&&t(N,{span:1,children:t(x,{variant:"link",className:"pf-m-plain","data-testid":"addAttributeDisplayDescriptionTranslationBtn","aria-label":e("addAttributeDisplayDescriptionTranslation"),isDisabled:!b&&!c,onClick:()=>{P("displayDescription"),G()},icon:t(q,{})})})]})}),t(ka,{children:t(Ea,{component:"h2",children:e("annotationsText")})}),t($,{label:e("annotationsText"),fieldId:"kc-annotations",children:t(wa,{label:e("annotationsText"),name:"annotations"})}),m(Na,{children:[t(x,{variant:"primary",type:"submit","data-testid":"saveGroupBtn",children:e("save")}),t(x,{variant:"link",component:i=>t(xa,{...i,to:O({realm:p,tab:"attributes-group"})}),children:e("cancel")})]})]})})})]})}const et=()=>t(Ka,{children:t(ja,{})});export{et as default};
//# sourceMappingURL=AttributesGroupDetails-DzVs-Wya.js.map
